// ==UserScript==
// @name ALE Improvements
// @description Changes to make ALE better.
// @version 12.8
// @author mici1234, wanted2001, gcp5o
// @match *://www.plazmaburst2.com/level_editor/map_edit.php*
// @connect github.com
// @connect githubusercontent.com
// @downloadURL https://github.com/LisABC/ALEI/raw/main/alei.user.js
// @grant GM.xmlHttpRequest
// @icon https://github.com/LisABC/ALEI/blob/main/icon.png?raw=true
// @run-at document-start
// @updateURL https://github.com/LisABC/ALEI/raw/main/alei.user.js
// ==/UserScript==

(()=>{"use strict";var __webpack_modules__={338:(e,t,o)=>{function r(e){let t=0;return(!isNaN(Number(e))&&" "!==e||"."==e)&&(t=1),t}function i(e){return"+-*/%^SCANRF".includes(e)}function n(e){return"()".includes(e)}function a(e){let t=0;return"+-".includes(e)&&(t=1),"*/%".includes(e)&&(t=2),"^SCANRF".includes(e)&&(t=3),t}function l(e,t,o){let r;return e=Number(e),o=Number(o),"+"==t&&(r=e+o),"-"==t&&(r=e-o),"*"==t&&(r=e*o),"/"==t&&(r=e/o),"%"==t&&(r=e%o),"^"==t&&(r=e**o),"S"==t&&(r=Math.sin(e)*o),"C"==t&&(r=Math.cos(e)*o),"A"==t&&(r=Math.atan2(e,o)),"N"==t&&(r=o?Math.floor(Math.random()*e):Math.random()*e),"R"==t&&(r=Math.round(e/o)*o),"F"==t&&(r=Math.floor(e/o)*o),r}function s(e,t){""==e&&(e="0"),"-"==e[0]&&(e="0"+e),function(e){let t="";for(let o=0;o<e.length;o++)r(e[o])?t+=e[o]:0!=t.length&&(e.splice(o-t.length,t.length,t),o-=t.length-1,t="");0!=t.length&&e.splice(e.length-t.length,t.length,t)}(e=function(e){return e.replaceAll(" ","").split("")}(e)),function(e,t){for(let o=0;o<e.length;o++)for(let r=0;r<t.length;r++)e[o]==t[r].from&&(e[o]=t[r].to)}(e,[{from:"p",to:String(Math.PI)},{from:"x",to:String(t[0])},{from:"y",to:String(t[1])},{from:"w",to:String(t[2])},{from:"h",to:String(t[3])},{from:"i",to:String(t[4])}]);try{!function(e){for(let t=0;t<e.length;t++)"-"==e[t]&&"("==e[t-1]&&e.splice(t,0,"0")}(e),function(e){for(let t=0;t<e.length;t++)"("==e[t-1]&&")"==e[t+1]&&e.splice(t,0,"0","+")}(e),function(e){for(let t=0;t<e.length;t++)e[t]={chr:e[t]}}(e),function(e){let t=1;for(let o=0;o<e.length;o++)"("==e[o].chr&&t++,")"==e[o].chr&&t--,e[o].groupOrder=t}(e),function(e){for(let t=0;t<e.length;t++)n(e[t].chr)&&(e.splice(t,1),t--)}(e),function(e){for(let t=0;t<e.length;t++)if(i(e[t].chr)){let o=a(e[t].chr);e[t].operatorOrder=o,e[t+1].groupOrder==e[t].groupOrder&&(e[t+1].operatorOrder=o),(!e[t-1].operatorOrder||e[t-1].operatorOrder<e[t].operatorOrder&&e[t-1].groupOrder==e[t].groupOrder)&&(e[t-1].operatorOrder=o)}}(e),function(e){for(let t=0;t<e.length;t++)e[t].order=10*e[t].groupOrder+e[t].operatorOrder}(e),function(e){let t=function(e){let t=[];for(let o=0;o<e.length;o++)t.push(e[o].order);return t}(e),o=function(e){let t=[],o=1;e.sort(((e,t)=>t-e)),t.push({from:e[0],to:o});for(let r=1;r<e.length;r++)e[r]!=e[r-1]&&o++,t.push({from:e[r],to:o});return t}(t);for(let t=0;t<e.length;t++)for(let r=0;r<o.length;r++)e[t].order==o[r].from&&(e[t].order=o[r].to)}(e),function(e){let t=function(e){let t=0;for(let o=0;o<e.length;o++)e[o].order>t&&(t=e[o].order);return t}(e);for(let o=1;o<=t;o++){let t=0,r=1;for(;r;){r=0;let i,n,a=[],s=-1;for(;t<e.length;t++)if(e[t].order==o)a.push(e[t]),-1==s&&(s=t);else if(0!=a.length){r=1;break}if(i=a.length,i){for(;1!=a.length;)a.splice(0,3,{chr:l(a[0].chr,a[1].chr,a[2].chr)});n=e[s].order,e.splice(s,i,a[0]),t-=i-1,e[s]={chr:e[s].chr,order:n+1}}}}}(e)}catch{return"error"}return Number(Number(e[0].chr).toFixed(10))}o.d(t,{q:()=>s})}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](o,o.exports,__webpack_require__),o.exports}__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__={},_alescript_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(338);let window=unsafeWindow,isNative;try{GM_info,isNative=!0,window.nativeALEIRunning=!0}catch(e){isNative=!1}function $id(e){return document.getElementById(e)}function $query(e){return document.querySelector(e)}isNative||1!=window.nativeALEIRunning||Hello_IgnoreThisError_ItIsIntentional;let ROOT_ELEMENT=document.documentElement,stylesheets=document.styleSheets,VAL_TABLE={},displayOperationCompleteNotes=!0,REGION_EXECUTE_PARAM_ID;const INFO=0,DEBUG=1,DEBUG2=2,WARN=-1,ANSI_RESET="[0m",ANSI_RED="[31m",ANSI_GREY="[37m",ANSI_YELLOW="[93m",ANSI_GREEN="[92m",ANSI_CYAN="[96m";function readStorage(e,t,o){return void 0===localStorage[e]?t:o(localStorage[e])}null!=localStorage.RIGHT_PANEL_WIDTH&&(localStorage.ALEI_RightPanelWidth=localStorage.RIGHT_PANEL_WIDTH,localStorage.removeItem("RIGHT_PANEL_WIDTH"));let aleiSettings={rightPanelSize:readStorage("ALEI_RightPanelWidth","30vw",(e=>e)),triggerEditTextSize:readStorage("ALEI_EditTextSize","12px",(e=>e+"px")),starsImage:readStorage("ALEI_StarImage","stars2.jpg",(e=>e)),logLevel:readStorage("ALEI_LogLevel",0,parseInt),showTriggerIDs:readStorage("ALEI_ShowTriggerIDs",!1,(e=>"true"===e)),enableTooltips:readStorage("ALEI_ShowTooltips",!1,(e=>"true"===e)),showSameParameters:readStorage("ALEI_ShowSameParameters",!0,(e=>"true"===e)),rematchUID:readStorage("ALEI_RemapUID",!1,(e=>"true"===e)),showIDs:readStorage("ALEI_ShowIDs",!1,(e=>"true"===e)),blackTheme:readStorage("ALEI_BlackTheme",!1,(e=>"true"===e)),gridBasedOnSnapping:readStorage("ALEI_gridBasedOnSnapping",!0,(e=>"true"===e)),showZIndex:readStorage("ALEI_ShowZIndex",!1,(e=>"true"===e)),renderObjectNames:readStorage("ALEI_RenderObjectNames",!0,(e=>"true"===e)),textAffectedByZoom:readStorage("ALEI_TextAffectedByZoom",!1,(e=>"true"===e))};function writeStorage(e,t){try{localStorage[e]=t}catch(e){NewNote("ALEI: There was some issue trying to save into storage. You might need to clear your datas.",note_bad),console.error(e)}}window.aleiSettings=aleiSettings;let levelToNameMap={0:`${ANSI_CYAN}INFO${ANSI_RESET}`,1:`${ANSI_GREEN}DEBUG${ANSI_RESET}`,2:`${ANSI_GREEN}DEBUG2${ANSI_RESET}`};function aleiLog(e,t){e===WARN?(console.warn(`[ALEI:WARNING]: ${t}`),NewNote("ALEI: Please check console.","#FFFF00")):e<=aleiSettings.logLevel&&console.log(`[${ANSI_GREEN}ALEI:${levelToNameMap[e]}]: ${t}`)}aleiLog(INFO,"Starting up...");let JS_setTimeout=window.setTimeout,JS_eval=window.eval,ALE_Render,aleiSessionID=null,aleiSessionList=[];function updateParameters(){function e(e,t,o,r){param_type[param_type.length]=[e,t,o,"",r]}e("moving","bool","Is Moving?","door"),e("tarx","value","Target X","door"),e("tary","value","Target Y","door"),e("__id","value","ID","*"),e("__zIndex","value","Z-Index","*"),e("execute","bool","Executes directly?","trigger"),e("uses_timer","bool","Calls timer?","region"),e("text","string","Placeholder text","decor"),e("attach","door+none","Attach to","water"),param_type[0]=["uid","string","Name","Object Name","*"];for(let e=0;e<param_type.length;e++){let t=param_type[e],o=t[0],r=t[4];"use_target"==o&&"region"==r&&(REGION_EXECUTE_PARAM_ID=e)}VAL_TABLE["timer+none"]=new Array,VAL_TABLE["timer+none"][-1]="- No timer -",VAL_TABLE["timer+none"]["[listof]"]="timer"}function updateSounds(){let e=VAL_TABLE.sound;e.am_base="Indoor Ambience",e.am_wind="Outdoor Ambience",e.android2_die="DT-148 - Death",e.android2_hurt="DT-148 - Hurt",e.android2_welcome2="DT-148 - Alerted",e.arrin_death1="Arrin - Death",e.arrin_dying="Arrin - Dying",e.arrin_hurt1="Arrin - Hurt 1",e.arrin_hurt2="Arrin - Hurt 2",e.arrin_welcome1="Arrin - Alerted 1",e.arrin_welcome2="Arrin - Alerted 2",e.arrin_welcome3="Arrin - Alerted 3",e.bounce_bullet="Falkonian PSI Cutter - Shot Bounce",e.dart4="Medic Pistol",e.exp_event_stop="EXP - Stop",e.exp_level="EXP - Level Up",e.exp_tick="EXP - Gain",e.gameplay_song="Katharsys - Erges",e.gravitator2="Floor gravitator noice",e.helm_proxy_alert_over_hereB="Proxy - Over here!",e.helm_proxy_alert_take_coverB="Proxy - Take cover!",e.helm_proxy_alert_up_thereA="Proxy - Up there!",e.helm_proxy_death3="Proxy - Death 1",e.helm_proxy_death4="Proxy - Death 2",e.helm_proxy_death5="Proxy - Death 3",e.helm_proxy_death6="Proxy - Death 4",e.helm_proxy_dyingC="Proxy - Help! 1",e.helm_proxy_dyingF="Proxy - Help! 2",e.helm_proxy_enemy_down_fantasticA="Proxy - Fantastic.",e.helm_proxy_enemy_down_got_oneD="Proxy - Got one.",e.helm_proxy_enemy_down_niceA="Proxy - Nice. 1",e.helm_proxy_enemy_down_niceC="Proxy - Nice. 2",e.helm_proxy_hurt11="Proxy - Hurt 1",e.helm_proxy_hurt12="Proxy - Hurt 2",e.helm_proxy_hurt13="Proxy - Hurt 3",e.helm_proxy_hurt14="Proxy - Hurt 4",e.helm_proxy_hurt15="Proxy - Hurt 5",e.helm_proxy_hurt17="Proxy - Hurt 6",e.helm_proxy_hurt4="Proxy - Hurt 7",e.helm_proxy_hurt5="Proxy - Hurt 8",e.helm_proxy_hurt8="Proxy - Hurt 9",e.helm_proxy_hurt9="Proxy - Hurt 10",e.hexagon_death1="Hexagon - Death 1",e.hexagon_death2="Hexagon - Death 2",e.hexagon_pain1="Hexagon - Hurt 1",e.hexagon_pain2="Hexagon - Hurt 2",e.hexagon_pain3="Hexagon - Hurt 3",e.hexagon_pain4="Hexagon - Hurt 4",e.hexagon_welcome1="Hexagon - Alerted 1",e.hexagon_welcome2="Hexagon - Alerted 2",e.hexagon_welcome3="Hexagon - Alerted 3",e.main_song="NPhonix - Antigravity",e.orakin_death1="Orakin - Death 1",e.orakin_death2="Orakin - Death 2",e.orakin_hurt="Orakin - Hurt",e.orakin_welcome="Orakin - Alerted",e.proxy_alert_over_hereB="No Helm Proxy - Over here!",e.proxy_alert_take_coverB="No Helm Proxy - Take cover!",e.proxy_alert_up_thereA="No Helm Proxy - Up there!",e.proxy_death3="No Helm Proxy - Death 1",e.proxy_death4="No Helm Proxy - Death 2",e.proxy_death5="No Helm Proxy - Death 3",e.proxy_death6="No Helm Proxy - Death 4",e.proxy_dyingC="No Helm Proxy - Help! 1",e.proxy_dyingF="No Helm Proxy - Help! 2 ",e.proxy_enemy_down_fantasticA="No Helm Proxy - Fantastic.",e.proxy_enemy_down_got_oneD="No Helm Proxy - Got one.",e.proxy_enemy_down_niceA="No Helm Proxy - Nice. 1",e.proxy_enemy_down_niceC="No Helm Proxy - Nice. 2",e.proxy_hurt11="No Helm Proxy - Hurt 1",e.proxy_hurt12="No Helm Proxy - Hurt 2",e.proxy_hurt13="No Helm Proxy - Hurt 3",e.proxy_hurt14="No Helm Proxy - Hurt 4",e.proxy_hurt15="No Helm Proxy - Hurt 5",e.proxy_hurt17="No Helm Proxy - Hurt 6",e.proxy_hurt4="No Helm Proxy - Hurt 7",e.proxy_hurt5="No Helm Proxy - Hurt 8",e.proxy_hurt8="No Helm Proxy - Hurt 9",e.proxy_hurt9="No Helm Proxy - Hurt 10",e.silk_alert_contactA="Silk - Contact!",e.silk_alert_i_see_oneA="Silk - I see one.",e.silk_alert_there_is_oneA="Silk - There is one...!",e.silk_death1B="Silk - Death 1",e.silk_death2B="Silk - Death 2",e.silk_dyingB="Silk - Not good...",e.silk_enemy_down_brilliantC="Silk - Brilliant.",e.silk_enemy_down_eliminatedB="Silk - Eliminated.",e.silk_enemy_down_hell_yeahB="Silk - Hell yeah!",e.silk_enemy_down_ive_got_oneB="Silk - I got one!",e.silk_enemy_down_minus_oneB="Silk - -1.",e.silk_enemy_down_no_kicking_for_youB="Silk - No kicking for you.",e.silk_hurt1B="Silk - Hurt 1",e.silk_hurt2B="Silk - Hurt 2",e.silk_hurt5="Silk - Hurt 3",e.silk_hurt6="Silk - Hurt 4",e.silk_hurt9B="Silk - Hurt 5",e.wea_crossfire2="Crossfire CR-145 Vortex",e.wea_ditzy_cs_ik="Assault Rifle CS-IK",e.wea_glhf="Grenade Launcher CS-GLHF",e.wea_incompetence_archetype_27xx_fire="Archetype 27XX",e.wea_lazyrain_gravy_rl="Falkonian Anti-Grav Rocket Launcher",e.wea_m202="Rocket Launcher CS-Barrage",e.wea_moonhawk_railgun="Crossfire CR-34 Marauder",e.wea_ph01="Crossfire CR-54 Viper",e.wea_plasma_shotgun="Plasma Shotgun",e.wea_rail_alt2="Falkonian PSI Cutter",e.wea_thetoppestkek_shotgun_nxs25="Shotgun NXS-25",e.xin_celebrate="Xin - Celebrating",e.xin_death="Xin - Death",e.xin_enemy_spotted="Xin - Alerted",e.xin_hit="Xin - Hurt";let t={Grosk:["Grosk",["death","Death",2],["dying","Dying",2],["edown","Celebrating",3],["welcome","Alerted",5],["hurt","Hurt",3]],drohnentroop:["Drohnen Trooper",["welcome","Alerted",3],["hurt","Hurt",3],["edown","Celebrating",3],["dying","Dying",1],["death","Death",3]],drohnenfem:["Drohnen Female",["welcome","Alerted",3],["hurt","Hurt",3],["edown","Celebrating",3],["dying","Dying",1],["death","Death",3]],elurra:["Elurra",["welcome","Alerted",3],["hurt","Hurt",2],["edown","Celebrating",2],["dying","Dying",1],["death","Death",1]],ferro:["Lt. Ferro",["welcome","Alerted",3],["hurt","Hurt",2],["edown","Celebrating",3],["death","Death",2]],serkova:["Serkova",["welcome","Alerted",3],["hurt","Hurt",1],["edown","Celebrating",2],["death","Death",1]],phantom:["Phantom",["edown","Celebrating",1],["welcome","Alerted",2],["death","Death",1]]};for(let o of Object.entries(t)){let t=o[0],r=o[1],i=r[0];for(let o=1;o<r.length;o++){let n=r[o];for(let o=1;o<=n[2];o++)e[`${t}_${n[0]}${o}`]=`${i} - ${n[1]} ${o}`}}}function updateVoicePresets(){let e=VAL_TABLE.voice_preset;e.proxy_helmetless="Proxy (helmetless)",e.silk="Silk",e.orakin="Orakin",e.arrin="Arrin",e.civilian_male="Civilian Male",e.vulture="Vulture",e.crossfire_sentinel="Crossfire Sentinel",e.xin="Xin",e.grosk="Grosk",e.elurra="Elurra",e.drohnenfem="Drohnen Female",e.serkova="Serkova",e.ferro="Lt. Ferro",e.drohnentroop="Drohnen Trooper",e.phantom="Phantom"}function updateStyles(){for(let e=0;e<stylesheets.length;e++){let t=stylesheets[e];for(let e=0;e<t.rules.length;e++){let o=t.rules[e];switch(o.selectorText){case".p_i":o.style.setProperty("display","flex");break;case".rightui":o.style.setProperty("width",aleiSettings.rightPanelSize);break;case".pa1":o.style.setProperty("flex-grow",0),o.style.setProperty("flex-shrink",0);break;case".pa2":o.style.setProperty("width","100%");break;case".opcode_field":o.style.setProperty("font-size",aleiSettings.triggerEditTextSize);break;case"#rparams":o.style.setProperty("height","var(--ALEI_RPARAMS_HEIGHT)")}}}$id("stars").style.setProperty("background-image",`url(${aleiSettings.starsImage})`);let e=THEME;ThemeSet(THEME_BLUE),ThemeSet(e)}function updateSkins(){let e=[[10,"Head Gib"],[20,"Arm Gib"],[30,"Leg Gib"],[50,"Heavy Hero (Only Head and Arms)"],[60,"Proxy (Only Head and Arms)"],[62,"Proxy (No Limbs)"],[38,"GoldenKnife Noir Lime"],[39,"RootZ Noir Lime"],[151,"Purple Xin"],[152,"Golden Xin"],[153,"Blue Xin"],[154,"Red Xin"],[155,"Amber Xin"],[156,"Nirvana Noir Lime"],[157,"Purple Gallynew"],[158,"Golden Gallynew"],[159,"Blue Gallynew"],[160,"Red Gallynew"],[161,"Amber Gallynew"],[162,"Pinkine"],[163,"Raider (by Serpent)"],[164,"Blue Heavy Hero"],[165,"Red Heavy Hero"],[166,"Orakin"],[167,"Husk"],[168,"Hex"],[169,"Arrin"],[170,"Heavy Usurpation Soldier"],[171,"Cyber Grub by S1lk"],[172,"Grosk"],[173,"Futuristic Knight"],[174,"Uncivil Proxy"],[175,"Serkova Insertion Unit"],[176,"Xenos Scout"],[177,"Armored Trooper"],[178,"Newgen Marine"],[179,"Elurra (by Lin)"],[180,"Phantom Proxy (Unofficial Name)"],[181,"Huntsman (Night)"],[182,"Huntsman (Swamp)"],[183,"Lt. Ferro (by Serpent)"],[184,"Xenos Titan"],[185,"Elurra (Masked) (by Lin)"],[186,"Drohnen Heavy (by Ark633)"],[187,"Cromastakan"],[188,"Sgt. Davais"],[189,"Maroon (by Francis localhost)"],[190,"Drohnen Skirmisher (by Ark633)"],[191,"Serkova Recon Unit"],[192,"Drohnen Drifter (by Ark633)"],[193,"Xenos Marine"],[194,"Phantom Android SLC-56 (Unofficial Name)"],[195,"Wraith (by Ark633)"],[196,"Serkova Armored Unit"],[197,"Phantom"],[198,"Blue Civil Security Heavy"],[199,"Red Civil Security Heavy"],[200,"Xenos Welder"],[201,"Xenos Engineer"],[202,"Serkova Assault Unit"],[203,"Serkova Gunner Unit"],[204,"Serkova Grenader Unit"],[205,"Serkova Team Leader"],[206,"Serkova Resource Unit"],[207,"Serkova Technician Unit"],[208,"Serkova Grub"],[209,"Serkova Reinforced Grub"],[210,"Serkova Devastator Grub"],[211,"XBT-117 Android"],[212,"Teneguilae"],[213,"Walker (by Serpent)"],[214,"Space Grub (by Broforce1)"],[215,"Phantom (Blue)"],[216,"Phantom (Red)"]];for(let t=0;t<e.length;t++){let o=e[t][0],r=o.toString().padStart(4,"0"),i=e[t][1],n="https://www.plazmaburst2.com/level_editor/chars_full/char"+r+".png";VAL_TABLE.char[o]=_turnLinkIntoSkinSpan(n,i),img_chars_full[o]=new Image,img_chars_full[o].src="chars_full/char"+r+".png"}let t=Object.keys(VAL_TABLE.char);t=t.map((e=>parseInt(e))),fetchSkinsFrom(Math.max(...t)+1)}function _turnLinkIntoSkinSpan(e,t){return"<span style='background:url("+e+"); width: 16px; height: 16px; display: inline-block; background-position: center; background-position-x: 30%; background-position-y: 26%; background-size: 67px;vertical-align: -4px;'></span> "+t}async function fetchSkinsFrom(e){if(!isNative)return void NewNote("ALEI: Will not check for any undetected skins as the function requires tampermonkey-specific function.","#FFFF00");let t=!0,o=[];async function r(e){let r="https://www.plazmaburst2.com/level_editor/chars_full/char"+e.toString().padStart(4,"0")+".png";404!=(await GM.xmlHttpRequest({url:r}).catch((e=>console.error(e)))).status?(VAL_TABLE.char[e]=_turnLinkIntoSkinSpan(r,`Unknown Skin #${e}`),o.push(e)):t=!1}async function i(e){let t=[];for(let o=0;o<5;o++)t.push(r(e+o));await Promise.all(t)}let n=e;for(;t;)await i(n),n+=5;o.length>0&&(NewNote(`ALEI: There are ${o.length} unregistered skins, please inform ALEI developer(s) about this. Check logs for more information`,"#00FFFF"),aleiLog(INFO,`Unregistered skins: ${o}`))}function optimize(){window.setTimeout=(e,t)=>{if(e!=ani)return JS_setTimeout(e,t);window.requestAnimationFrame(ani)};let e=window.BrowseImages,t={};window.BrowseImages=function(o="bg_model",r="",i=null){null==t[o]&&(t[o]="[ALEI] Loading...",aleiLog(INFO,`Will cache response of ${o}`));let n=window.setTimeout;window.setTimeout=(e,r)=>{window.setTimeout=n,window.ServerRequest=(e,r,i=null)=>{window.ServerRequest=ALEI_ServerRequest,ServerRequest(e,r,i).then((()=>{t[o]=image_list.innerHTML}))},e()},e(o,r,i),image_list.innerHTML=t[o]}}function updateVehicles(){let e=VAL_TABLE.vehicle_model,t=[["veh_hh","Grabbable Ledge","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACLSURBVEhLYxhxgBFE2M3/r/vvH0MQWISGgImJYd2hRMbLIDbYYpu5/+t/MzEEf2diuALi0wJw/mPQYf3HsPZIMmMjiA+3+BMLg/olIYblID4tgN47hki+Pww3YRYzgUUHAIxaTDcwajHdwKjFdAOjFtMNjFpMNzBqMd3AqMV0AwPbrh6InsQAAQYGAA8CLDKAAcpOAAAAAElFTkSuQmCC"]];for(let o=0;o<t.length;o++){let r=t[o],i=r[0],n=r[1],a=r[2];e[i]=`<img src='${a}' border=0 height=12 style=vertical-align:middle title='${n}' > ${n}`,img_vehicles[i]=new Image,img_vehicles[i].src=a}}function updateGuns(){let e=[["gun_rl0","BETA Rocket Launcher","data:image/png;base64,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"]];for(let t=0;t<e.length;t++){let o=e[t],r=o[0],i=o[1],n=o[2];VAL_TABLE.gun_model[r]=`<img src='${n}' border=0 width=80 height=20 style=vertical-align:baseline title='${i}'>`,img_guns[r]=new Image,img_guns[r].src=n}}function updateDecors(){window.img_decors=CACHED_DECORS;let e=[["hakase","Hakase","data:image/png;base64,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"]];for(let t=0;t<e.length;t++){let o=e[t],r=o[0],i=o[1],n=o[2];VAL_TABLE.decor_model[r]=i,img_decors[r]=new Image,img_decors[r].src=n,CACHED_DECORS[r]=img_decors[r],CUSTOM_IMAGES_APPROVED[r]=!0}window.ALEI_decors=e}function updateOffsets(){let e=window.ThinkOfOffsetClass;window.ThinkOfOffsetClass=function(o,r){return"vehicle"==o&&null!=t[r.pm.model]||"decor"==o&&null!=t[r.pm.model]?"alei_"+r.pm.model:e(o,r)};let t={veh_hh:{x:-15,y:-15,w:30,h:30},hakase:{x:-18,y:-57,w:40,h:60}};for(let e in t){let o=t[e];lo_x["alei_"+e]=o.x,lo_y["alei_"+e]=o.y,lo_w["alei_"+e]=o.w,lo_h["alei_"+e]=o.h}}function updateTriggers(){addTrigger(175,"Gun &#8250; Change gun 'A' projectile model to 'B'","gun","ALEI_projectileModels"),addTrigger(378,"Gun &#8250; Add hex color 'B' to gun 'A'","gun","string"),addTrigger(332,"Var &#8250; Set variable 'A' to value 1 if Gun 'B' is in owner's active slot, set to value 0 in else case","string","gun")}function updateObjects(){updateGuns(),updateVehicles(),updateDecors(),updateTriggers()}function updateButtons(){let e=$id("top_panel"),t=e.children;t[16].value="Eagle's Manual",t[16].setAttribute("onclick","window.open('https://eaglepb2.gitbook.io/pb2-editor-manual/', '_blank');");let o=e.removeChild(t[t.length-1]).outerHTML;function r(t,o,r){let i=document.createElement("input");i.setAttribute("class","field_btn"),i.setAttribute("type","button"),i.setAttribute("value",t),i.setAttribute("onclick",`aleiButtonClicks['${o}']()`),window.aleiButtonClicks[o]=r;let n=document.createElement("div");n.setAttribute("class","q"),e.appendChild(i),e.appendChild(n)}o=e.removeChild(t[t.length-1]).outerHTML+o,e.removeChild(t[t.length-1]),window.aleiButtonClicks={};let i=document.createElement("div");i.setAttribute("class","q3"),e.appendChild(i),r("Download XML","downloadXMLButton",exportXML),r("Insert XML","insertXMLButton",(()=>{if(confirm("File (OK) or text (Cancel) ?")){let e=document.createElement("input");e.type="file",e.onchange=function(){if(e.files[0])if("xml"==e.files[0].name.split(".")[1]){let t=new FileReader;t.onload=function(){insertXML(t.result),e.remove()},t.readAsText(e.files[0])}else alert("Invalid file extension.")},e.click()}else{let e=prompt("Enter XML:","");null!==e&&insertXML(e)}})),r("ALEI Settings","openALEISettings",showSettings),e.innerHTML+=o,window.mapid_field=$id("mapid_field"),mapid_field.value=mapid}function addClipboardSync(){let e=new BroadcastChannel("ale_clipboard");e.onmessage=t=>{let o=t.data,r=o.kind;if("send"==r){let e=o.recipient,t=o.clip_name,r=o.clip_data;null!=e&&e!=aleiSessionID||(aleiLog(DEBUG,"/ale_clipboard/ got data for "+t),sessionStorage[t]=r)}if("get"==r){if(aleiSessionID>Math.min(...aleiSessionList))return;let t=o.session_id;aleiLog(DEBUG,"/ale_clipboard/ syncing to "+t);for(let o=0;o<=10;o++){let r="clipboard"+(0==o?"":"_slot"+(o-1)),i=sessionStorage[r];null!=i&&e.postMessage({kind:"send",recipient:t,clip_name:r,clip_data:i})}}},aleiLog(DEBUG,"/ale_clipboard/ requesting"),e.postMessage({kind:"get",session_id:aleiSessionID});let t=window.CopyToClipBoard;window.CopyToClipBoard=o=>{t(o);let r=sessionStorage[o];e.postMessage({kind:"send",clip_name:o,clip_data:r})}}async function addSessionSync(){let e=new BroadcastChannel("ale_session");e.onmessage=t=>{let o=t.data,r=o.kind;if("start"==r){if(null==aleiSessionID)return;e.postMessage({kind:"greet",id:aleiSessionID}),aleiLog(DEBUG,"/ale_session/ recieved start")}if("greet"==r){let e=o.id;aleiSessionList.includes(e)||aleiSessionList.push(e),aleiLog(DEBUG,"/ale_session/ received greet by "+e)}if("close"==r){let e=o.id;aleiSessionList.splice(aleiSessionList.indexOf(e),1),aleiLog(DEBUG,"/ale_session/ received close by "+e)}},e.postMessage({kind:"start"}),aleiLog(DEBUG,"/ale_session/ probing"),await new Promise((e=>{JS_setTimeout(e,200)})),aleiSessionID=0==aleiSessionList.length?0:Math.max(...aleiSessionList)+1,aleiLog(DEBUG,"/ale_session/ session ID "+aleiSessionID),window.addEventListener("beforeunload",(t=>{e.postMessage({kind:"close",id:aleiSessionID})})),addClipboardSync()}function addPropertyPanelResize(){let e=!1;const t=document.createElement("div"),o=document.documentElement;t.style.position="absolute",t.style.width="5px",t.style.top="50px",t.style.height="100%",t.style.cursor="w-resize",$id("floattag").appendChild(t),t.addEventListener("mousedown",(t=>{e=!0})),o.addEventListener("mouseup",(t=>{e=!1,writeStorage("ALEI_RightPanelWidth",right_panel.clientWidth+"px")})),o.addEventListener("mousemove",(r=>{e&&function(e){let r=Math.min(o.clientWidth-100,Math.max(100,o.clientWidth-e.clientX));right_panel.style.width=r+"px",t.style.right=r+"px",ROOT_ELEMENT.style.setProperty("--param_panel_size",t.style.right),updateBoxSplitterSize()}(r)})),t.style.right=aleiSettings.rightPanelSize,ROOT_ELEMENT.style.setProperty("--param_panel_size",t.style.right),window.splitter=t}function addTriggerIDs(){if(!aleiSettings.showTriggerIDs)return;let e=VAL_TABLE.trigger_type;for(let t in e)e[t]=t+" "+e[t]}function patchShowHideButton(){let e=window.ShowHideObjectBox;window.ShowHideObjectBox=function(){e();let t=$id("rparams"),o={true:270,false:155}[ObjectBox_visible];null!=t&&(o=Math.round(t.getBoundingClientRect().top+13)),document.documentElement.style.setProperty("--ALEI_RPARAMS_HEIGHT",`calc(100vh - ${o}px)`)},ShowHideObjectBox(),ShowHideObjectBox()}function addSnappingOptions_helper(){$query('a[onmousedown="GridSnappingSet(50);"]').remove(),$query('a[onmousedown="GridSnappingSet(100);"]').remove();let e="",t=[1,2,5,10,20,40,50,100,"C"];for(let o in t){let r=t[o];o%3==0&&0!=o&&(e+="<br>");let i=document.createElement("a");i.innerHTML="C"!=r?r/10:"C";let n="tool_btn";GRID_SNAPPING==r&&(n="tool_btn2"),t.includes(GRID_SNAPPING)||"C"!=r||(n="tool_btn2"),i.setAttribute("class",`${n} tool_wid`),i.setAttribute("style","width: 21px;"),"C"!=r?i.setAttribute("onmousedown",`GridSnappingSet(${r}); Render();`):i.setAttribute("onmousedown","ALEI_CustomSnapping(); Render();"),e+=i.outerHTML}$query('a[onmousedown="GridSnappingSet(10);"]').outerHTML=e}function addRematchUIOptions_helper(){$query("a[onmousedown=\"EvalSet('param_panel_size',800);SaveBrowserSettings();UpdateCSS();\"]").remove();let e=document.evaluate("//span[contains(., 'Param')]",left_panel,null,XPathResult.ANY_TYPE,null);e.iterateNext(),e.iterateNext().innerHTML="Remap UID";for(let e of[[!0,"Yes",0],[!1,"No",200]]){let t=document.createElement("a");t.innerHTML=e[1];let o="tool_btn";aleiSettings.rematchUID==e[0]&&(o="tool_btn2"),t.setAttribute("class",`${o} tool_wid`),t.setAttribute("style","width: 64px;"),t.setAttribute("onmousedown",`ALEI_UpdateRematchUIDSetting(${e[0]})`),$query(`a[onmousedown="EvalSet('param_panel_size',${e[2]});SaveBrowserSettings();UpdateCSS();"]`).outerHTML=t.outerHTML}}function addPreviewNamesOptions_helper(){let e=$query('a[onmousedown="ShowTexturesSet(true);"]'),t=document.createElement("span");t.setAttribute("class","gui_sel_info"),t.innerHTML="Object Names";let o="";function r(e,t){let r=document.createElement("a"),i="tool_btn";t==aleiSettings.renderObjectNames&&(i="tool_btn2"),r.setAttribute("class",`tool_wid ${i}`),r.setAttribute("style","width: 32px"),r.setAttribute("onmousedown",`ALEI_UpdateNameRenderSetting(${t});`),r.innerHTML=e,o+=r.outerHTML}r("Show",!0),r("Hide",!1),e.outerHTML+='<br><div class="q"></div><br>'+t.outerHTML+"<br>"+o}function onToolUpdate(){addSnappingOptions_helper(),addRematchUIOptions_helper(),addPreviewNamesOptions_helper()}function patchUpdateTools(){let e=UpdateTools;window.UpdateTools=function(){e(),onToolUpdate()},UpdateTools(),aleiLog(DEBUG,"Patched updateTools.")}function tryToNumber(e){return isNaN(Number(e))?e:Number(e)}function insertXML(e){e="<map>"+e.replaceAll("&","[__Amp]")+"</map>";let t=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("*");for(let e=1;e<t.length;e++){let o=t[e];if("map"==o.tagName)continue;let r=new E(o.tagName);r.pm={};for(let e=0;e<o.attributes.length;e++){let t=o.attributes[e].name,i=o.attributes[e].value;r.pm[t]=tryToNumber(i.replaceAll("[__Amp]","&"))}es.push(r)}need_redraw=1,need_GUIParams_update=1}function exportXML(){let e=0,t="",o=document.createElement("a");for(let t=0;t<es.length;t++)es[t].selected&&(e=1);if(e){if(!confirm("Only selection will be exported."))return;for(let e=0;e<es.length;e++)es[e].selected&&(t+=compi_obj(e));mapid?o.download=mapid+" (selection).xml":o.download="newmap (selection).xml"}else{for(let e=0;e<es.length;e++)es[e].exists&&(t+=compi_obj(e));mapid?o.download=mapid+".xml":o.download="newmap.xml"}o.href="data:text,"+escape(t),""!=t?(o.href="data:text,"+escape(t),o.click()):alert("Map is empty."),o.remove()}window.ALEI_CustomSnapping=()=>{let e=prompt("Enter snapping:","");if(e){if(!isNaN(Number(e)))return e<.1?(e=.1,void NewNote("ALEI: Snapping can't be less than 0.1","#FF0000")):e>100?(e=100,void NewNote("ALEI: Snapping can't be greater than 100","#FF0000")):void GridSnappingSet(Math.round(10*e));NewNote("Invalid snapping.","#FF0000")}},window.ALEI_UpdateRematchUIDSetting=function(e){aleiSettings.rematchUID=e,writeStorage("ALEI_RemapUID",e),UpdateTools()},window.ALEI_UpdateNameRenderSetting=function(e){ENABLE_TEXT=e,aleiSettings.renderObjectNames=e,writeStorage("ALEI_RenderObjectNames",e),UpdateTools(),need_redraw=1};const _ignoredKeys=["x","y","w","h","maxcalls","command","upg","tox","toy","stab","damage","u","v","sx","sy","r","f","power","enabled","flare","uid","gun_model","model"];function updateUIDReferences(e,t){aleiLog(DEBUG2,`Updating UID references from ${ANSI_CYAN}${e}${ANSI_RESET} to ${ANSI_CYAN}${t}${ANSI_RESET}`);for(let o=0;o<es.length;o++){let r=es[o];if(!r.exists)continue;let i=r.pm;for(let o of Object.entries(i)){let r=o[0],n=o[1];if(-1!==_ignoredKeys.indexOf(r))continue;if("string"!=typeof n)continue;if(-1===n.indexOf(e))continue;if(n===e){i[r]=t;continue}let a=n.split(",");for(let o=0;o<a.length;o++){let r=a[o];r.trim()==e&&(a[o]=r.replace(e,t))}i[r]=a.join(",")}}window.need_GUIParams_update=!0}function UpdatePhysicalParam(e,t){lcz();for(var o=!1,r="",i=0;i<es.length;i++)if(es[i].exists&&es[i].selected&&es[i].pm.hasOwnProperty(e))if(MatchLayer(es[i])){"uid"==e&&aleiSettings.rematchUID&&updateUIDReferences(es[i].pm.uid,t);var n="string"==typeof e?'"'+e+'"':e;"number"==typeof t||0===t?(lnd("es["+i+"].pm["+n+"] = "+es[i].pm[e]+";"),ldn("es["+i+"].pm["+n+"] = "+t+";"),es[i].pm[e]=Number(t)):"string"==typeof t?(lnd("es["+i+"].pm["+n+'] = "'+es[i].pm[e]+'";'),ldn("es["+i+"].pm["+n+'] = "'+t+'";'),es[i].pm[e]=_encodeXMLChars(t)):alert("Unknown value type: "+typeof t),r+='Parameter "'+e+'" of object "'+(null!=es[i].pm.uid?es[i].pm.uid:es[i]._class)+'" was set to "'+t+'"<br>',"uses_timer"==e&&(-1!=[!0,"true"].indexOf(es[i].pm.uses_timer)?param_type[REGION_EXECUTE_PARAM_ID][1]="timer+none":param_type[REGION_EXECUTE_PARAM_ID][1]="trigger+none",need_GUIParams_update=!0)}else o=!0;need_redraw=!0,NewNote("Operation complete:<br><br>"+r,note_passive),o&&NewNote("Note: Some changes weren't made due to missmatch of active layer and class of selected objects",note_neutral),lfz(!1),sortObjects()}let imageContextMap={};function ImageContext(e,t,o,r,i,n=!1,a="?",l="?",s=!1){imageContextMap[e]=o,last_element=r,last_login=a,t.preventDefault();var d=document.getElementById("image_context"),c="";return i?(c+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&approve_for=${e}', 'approve_image' ); }, 1 );">Approve <img src="../images/ap.png" width="11" height="11"></div>`,c+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&reset_status_for=${e}', 'reset_approval_image' ); }, 1 );">Reset approval status</div>`,c+=`<div onclick="CloseImageContext(); setTimeout( function() { open_approved_decor_model = true; SaveFiltering(); search_phrase = '*by_login*'+last_login; UpdateImageList(); }, 1 );">Search for other approved images from &quot;${a}&quot;</div>`,c+=`<div onclick="" style="color:rgba(0,0,0,0.3)">Last status change by ${l}</div>`,c+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&disapprove_for_all='+last_login, 'disapprove_image' ); }, 1 );">Disapprove all unreviewed from &quot;${a}&quot; <img src="../images/noap.png" width="11" height="11"><img src="../images/noap.png" width="11" height="11"><img src="../images/noap.png" width="11" height="11"></div>`,c+=`<div onclick="CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&disapprove_for=${e}', 'disapprove_image' ); }, 1 );">Disapprove <img src="../images/noap.png" width="11" height="11"></div>`):(a==curlogin&&"!"!=l?(c+=`<div onclick="aleiContextRenameImage(${e})">Rename</div>`,n?(c+='<div onclick="" style="color:rgba(0,0,0,0.3)">Request Approval (already done)</div>',c+=`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&deawait_approval_for=${e}', 'await_approval_status' ); }, 1 ); ">Exclude from approval review queue</div>`):(c+="Untitled"==o?'<div onclick="alert(\'Proper name required for custom image - you will not be available to change name once image is approved.\');" style="color:rgba(0,0,0,0.3)">Request Approval (proper name required)</div>':`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&await_approval_for=${e}', 'await_approval_status' ); }, 1 ); ">Request Approval <img src="../images/ap.png" width="11" height="11"></div>`,c+='<div onclick="" style="color:rgba(0,0,0,0.3)">Exclude from approval review queue (not in queue)</div>'),c+=`<div onclick="aleiContextDeleteImage(${e})">Delete <img src="../images/noap.png" width="11" height="11"></div>`):c+=`<div onclick="CloseImageContext(); setTimeout( function() { open_approved_decor_model = true; SaveFiltering(); search_phrase = '*by_login*'+last_login; UpdateImageList(); }, 1 );">Search for other approved images from &quot;${a}&quot;</div>`,c+='<span style="display:block;">&nbsp;</span>',c+=s?`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&favorite_del=${e}', 'favorite_status' ); }, 1 ); ">Remove from favorites</div>`:`<div onclick="CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&favorite_add=${e}', 'favorite_status' ); }, 1 ); ">Add to favorites</div>`),d.innerHTML=c,d.style.left=t.clientX,d.style.top=t.clientY,d.style.display="block",image_context_cancel_pad.style.display="block",!1}function findObjects(e){let t=confirm("Exact name?"),o=1;for(let i=0;i<es.length;i++)es[i].selected=0,es[i].pm.uid&&(r=es[i].pm.uid,(t?r==e:r.includes(e))&&MatchLayer(es[i])&&(es[i].selected=1,o=0));var r;return need_GUIParams_update=1,need_redraw=1,o}function rotateObjects(){let e,t,o=getSelection(),r=[],i=[];for(let e=0;e<o.length;e++){if(o[e].pm.w&&o[e].pm.h){let t=o[e].pm.w;o[e].pm.w=o[e].pm.h,o[e].pm.h=t}r.push(o[e].pm.x),i.push(o[e].pm.y)}e=Math.min(...r),t=Math.min(...i);for(let n=0;n<o.length;n++)r[n]-=e,i[n]-=t,o[n].pm.x=e+i[n],o[n].pm.y=t+r[n]}function RandomizeName(e){for(var t,o=e,r=0;r<es.length;r++)es[r].exists&&null!=es[r].pm.uid&&es[r].pm.uid==o&&(t=!0,e=o);if(t)do{t=!1;var i=e.lastIndexOf("*"),n=Math.floor(e.substring(i+1));for(o=-1==i||isNaN(n)?e+"*1":e.substring(0,i)+"*"+(n+1),r=0;r<es.length;r++)es[r].exists&&null!=es[r].pm.uid&&es[r].pm.uid==o&&(t=!0,e=o)}while(t);return o}function patchRandomizeName(){window.RandomizeName=RandomizeName}function patchAllowedCharacters(){allowed_string_chars+="<>"}function getRuleBySelector(e){let t,o=document.styleSheets[0].rules;for(let r=0;r<o.length;r++)o[r].selectorText==e&&(t=o[r]);return t}function setStyle(e,t,o){getRuleBySelector(e).style[t]=o}function blackTheme(){ThemeSet(0),THEME=4,setStyle(".topui","backgroundSize","0px"),setStyle(".leftui","backgroundSize","0px"),setStyle(".rightui","backgroundSize","0px"),setStyle(".topui","backgroundColor","#101010"),setStyle(".leftui","backgroundColor","#101010"),setStyle(".rightui","backgroundColor","#101010"),setStyle(".field_btn","backgroundColor","#202020"),setStyle(".tool_btn","backgroundColor","#202020"),setStyle(".tool_btn","border",""),setStyle(".tool_btn2","backgroundColor","#333"),setStyle(".tool_btn2","border","1px solid #888"),setStyle(".field_btn","color","#CCC"),setStyle(".tool_btn","color","#CCC"),setStyle(".tool_btn2","color","#CCC"),setStyle(".gui_sel_info","color","#CCC"),setStyle(".c","color","#CCC"),setStyle(".pa1","color","#CCC"),setStyle(".pa2","color","#CCC"),setStyle(".field_dis_left","color","#CCC"),setStyle(".field_dis_right","color","#CCC"),setStyle(".p_u1","border",""),setStyle(".p_u2","border",""),setStyle(".pa1","backgroundColor","#202020"),setStyle(".pa2","backgroundColor","#000000"),setStyle(".objbox","backgroundColor","#000000"),setStyle(".field_dis_left","backgroundColor","#202020"),setStyle(".field_dis_right","backgroundColor","#000000"),setStyle(".selline1","backgroundColor","#202020"),setStyle(".tool_btn:hover","backgroundColor","#202020"),setStyle(".tool_btn:hover","border","1px solid #888"),setStyle(".tool_btn:hover","color","#CCC"),setStyle(".tool_btn2:hover","backgroundColor","#333"),setStyle(".tool_btn2:hover","border","1px solid #888"),setStyle(".tool_btn2:hover","color","#CCC"),setStyle(".field_btn:hover","backgroundColor","#333"),setStyle(".field_btn:hover","color","#CCC"),setStyle(".tool_btn:active","backgroundColor","#202020"),setStyle(".tool_btn:active","border","1px solid #888"),setStyle(".tool_btn:active","color","#CCC"),setStyle(".tool_btn2:active","backgroundColor","#333"),setStyle(".tool_btn2:active","border","1px solid #888"),setStyle(".tool_btn2:active","color","#CCC"),setStyle(".field_btn:active","backgroundColor","#333"),setStyle(".field_btn:active","color","#CCC"),setStyle("#mrtitle","backgroundColor","#202020"),setStyle("#mrbox","backgroundColor","#101010"),setStyle(".field_input","backgroundColor","#000"),setStyle(".field_input","color","#CCC"),setStyle(".btn","backgroundColor","#202020"),setStyle(".btn","color","#CCC"),setStyle(".btn:hover","backgroundColor","#333"),setStyle(".btn:hover","color","#CCC"),setStyle(".btn:active","backgroundColor","#333"),setStyle(".btn:active","color","#CCC"),setStyle("closebox","backgroundColor","#101010"),setStyle("closebox","color","#CCC"),setStyle(".list_group","backgroundColor","#202020"),setStyle(".list_group","borderBottom",""),setStyle(".list_group:hover","backgroundColor","#333"),setStyle(".list_group:active","backgroundColor","#333"),setStyle(".image_list_collapsable","backgroundColor","#101010"),setStyle(".img_option_selected","backgroundColor","#444"),setStyle(".rightui","borderLeft",""),setStyle(".leftui","borderRight",""),setStyle("::-webkit-scrollbar-thumb","backgroundColor","#888"),setStyle("#rparams, #gui_objbox, #tools_box, #parambox","scrollbarColor",""),setStyle("#rparams, #gui_objbox, #tools_box, #parambox","scrollbarWidth",""),setStyle("#tools_box","overflow-y","hidden"),setStyle("#tools_box","overflow-y","auto")}function getObjectBox(e){let t=0,o=0,r=e.pm.w,i=e.pm.h;return"box door region pushf bg water".includes(e._class)||(t=bo_x[e._class],o=bo_y[e._class],r=bo_w[e._class],i=bo_h[e._class]),"player enemy".includes(e._class)&&(t=-15,o=-81,r=30,i=80),"vehicle"==e._class&&(t=bo_x["vehicle_"+e.pm.model],o=bo_y["vehicle_"+e.pm.model],r=bo_w["vehicle_"+e.pm.model],i=bo_h["vehicle_"+e.pm.model],"veh_hh"==e.pm.model&&(t=lo_x.alei_veh_hh,o=lo_y.alei_veh_hh,r=lo_w.alei_veh_hh,i=lo_h.alei_veh_hh)),{x:t,y:o,w:r,h:i}}function getSelectionImage(){let e=getSelection(),t=1/0,o=1/0,r=-1/0,i=-1/0;for(let n=0;n<e.length;n++){let a=getObjectBox(e[n]),l=e[n].pm.x+a.x,s=e[n].pm.y+a.y,d=a.w,c=a.h;l<t&&(t=l),l+d>r&&(r=l+d),s<o&&(o=s),s+c>i&&(i=s+c)}window.es=[];for(let t of e)es.push(t);THEME=4,GRID_ALPHA=0,SHOW_CONNECTIONS=0,zoom=1,zoom_validate();let n=dis_to_x-dis_from_x,a=dis_to_y-dis_from_y;dis_from_x=t-10,dis_from_y=o-10,dis_to_x=t+n-10,dis_to_y=o+a-10,ConsoleTraceMessages=[],Render();let l=r-t+20,s=i-o+20;aleiLog(DEBUG2,"Before GID");let d=ctx.getImageData(0,0,l,s);aleiLog(DEBUG2,"After GID");let c=document.createElement("canvas"),p=c.getContext("2d"),g=document.createElement("canvas"),m=g.getContext("2d");c.width=l,c.height=s,p.beginPath(),p.putImageData(d,0,0),p.closePath();let u=l,h=s;if(l>100||s>100){let e=l/s;e>=1?(l=100,s=l/e):(s=100,l=s*e)}g.width=l,g.height=s,m.beginPath(),m.scale(l/u,s/h),m.drawImage(c,0,0),m.closePath();let _=g.toDataURL();return c.remove(),c=void 0,_}function createClipboardDiv(){let e=document.createElement("div"),t=document.getElementById("mrdimlights");e.id="clipboardDiv",e.className="mrpopup",e.style="width: calc(100% - 280px); height: 100%; margin: 0px; padding: 0px; top: 50%; transform: translate(0px, -50%); display: none;",e.addEventListener("contextmenu",(e=>{e.preventDefault()})),t.addEventListener("click",(t=>{e.style.display="none"})),document.body.append(e)}function clipboardItemAction(e){let t=JSON.parse(localStorage.clipboardItems);if(confirm("Rename (OK) or delete (Cancel) ?")){let o=prompt("Enter name:",t[e].name);o&&(t[e].name=o,localStorage.clipboardItems=JSON.stringify(t),updateClipboardDiv())}else confirm("Are you sure you want to delete?")&&(t.splice(e,1),localStorage.clipboardItems=JSON.stringify(t),updateClipboardDiv())}function registerClipboardItemAction(){window.clipboardItemAction=clipboardItemAction,aleiLog(DEBUG,"Registered Clipboard Item Action")}function updateClipboardDiv(){localStorage.clipboardItems||(localStorage.clipboardItems="[]");let e=JSON.parse(localStorage.clipboardItems),t=document.getElementById("clipboardDiv"),o=document.getElementById("mrdimlights");t.style.display="block",o.style.display="block";let r='\n\t\t<div id="mrtitle">\n\t\t\t<span>Object clipboard</span>\n\t\t\t<closebox onclick="document.getElementById(\'clipboardDiv\').style.display = \'none\'; document.getElementById(\'mrdimlights\').style.display = \'none\';">x</closebox>\n\t\t</div>\n\n\t\t<div id="mrbox" class="objbox" style="height: calc(100% - 32px); box-sizing: border-box;">\n\t',i=window.es,n={};n.theme=THEME,n.grid_opacity=GRID_ALPHA,n.showConnections=SHOW_CONNECTIONS,n.dtx=dis_to_x,n.dty=dis_to_y,n.dfx=dis_from_x,n.dfy=dis_from_y,n.ctm=ConsoleTraceMessages,n.zoom=zoom,window.es=[];for(let t=0;t<e.length;t++)__pasteObjectClipboard(e[t]),r+='\n\t\t\t<div class="img_option" style="width: auto;" oncontextmenu="clipboardItemAction('+t+')" onclick="pasteFromPermanentClipboard('+t+');">\n\t\t\t\t<img src="'+getSelectionImage()+'" style="max-width: 100px; max-height: 100px;">\n\t\t\t\t<div>'+e[t].name+"</div>\n\t\t\t</div>\n\t\t";t.innerHTML=r+"</div>",window.es=i,THEME=n.theme,GRID_ALPHA=n.grid_opacity,SHOW_CONNECTIONS=n.showConnections,dis_to_x=n.dtx,dis_to_y=n.dty,dis_from_x=n.dfx,dis_from_y=n.dfy,ConsoleTraceMessages=n.ctm,zoom=n.zoom,need_redraw=1,zoom_validate()}function __pasteObjectClipboard(e){sessionStorage.permanent_clipboard=e.data,PasteFromClipBoard("permanent_clipboard")}function pasteFromPermanentClipboard(e){let t=JSON.parse(localStorage.clipboardItems);sessionStorage.permanent_clipboard=t[e].data,PasteFromClipBoard("permanent_clipboard");let o=document.getElementById("clipboardDiv"),r=document.getElementById("mrdimlights");o.style.display="none",r.style.display="none",NewNote("Objects pasted from permanent clipboard.",note_passive)}function copyToPermanentClipboard(){try{if(0!=getSelection().length){CopyToClipBoard("permanent_clipboard");let e=JSON.parse(localStorage.clipboardItems);e.push({name:"Selection",data:sessionStorage.permanent_clipboard}),localStorage.clipboardItems=JSON.stringify(e),NewNote("Objects copied to permanent clipboard.",note_passive)}else updateClipboardDiv()}catch(e){console.error(e),NewNote("Can't copy objects to permanent clipboard.<br>LocalStorage error?",note_bad)}}function changeTopRightText(){let e=document.getElementById("version_rights"),t=e.childNodes[0];e.style.width="170px",t.style.width="160px",t.innerHTML="Plazma Burst 2 Level Editor v1.4<br>ALE Improvements v"+GM_info.script.version}function sortObjects(){es.sort(((e,t)=>e.pm.__zIndex-t.pm.__zIndex))}function addDecorButtons(){let e=document.getElementById("rparams"),t=getSelection();if(e&&1==t.length){let o='<a onclick="getImageSize();" class="tool_btn tool_wid" style="display: block; width: 100%; margin-top: 4px;">Get image size</a>',r='<a onclick="centerImageX();" class="tool_btn tool_wid" style="display: block; width: 100%; margin-top: 4px;">Center decoration X</a>',i='<a onclick="centerImageY();" class="tool_btn tool_wid" style="display: block; width: 100%; margin-top: 4px;">Center decoration Y</a>';"bg"==t[0]._class&&(e.innerHTML+=o),"decor"==t[0]._class&&(e.innerHTML+=o,e.innerHTML+=r,e.innerHTML+=i)}}function getImageSize(){let e,t=getSelection();if("bg"==t[0]._class&&(e=t[0].pm.m),"decor"==t[0]._class&&(e=t[0].pm.model),"string"==typeof e){let t=document.createElement("img");t.onload=function(){let e=t.width,o=t.height;t.remove(),alert("W: "+e+"\nH: "+o)},t.onerror=function(){t.remove(),alert("Image not found.")},t.src="https://www.plazmaburst2.com/mimage_cache.php?image_id="+e.slice(1)}else alert("Image not found.")}function getImageData(){return new Promise(((e,t)=>{let o,r=getSelection();if("bg"==r[0]._class&&(o=r[0].pm.m),"decor"==r[0]._class&&(o=r[0].pm.model),"string"==typeof o){let t=document.createElement("img");t.onload=function(){let o=t.width,r=t.height,i=document.createElement("canvas"),n=i.getContext("2d");i.width=t.width,i.height=t.height,n.beginPath(),n.drawImage(t,0,0),n.closePath(),e([n.getImageData(0,0,o,r).data,o])},t.onerror=function(){t.remove(),alert("Image not found."),e(1)},t.src="https://www.plazmaburst2.com/mimage_cache.php?image_id="+o.slice(1)}else alert("Image not found."),e(1)}))}function arrMin(e){let t=1/0;for(let o=0;o<e.length;o++)e[o]<t&&(t=e[o]);return t}function arrMax(e){let t=-1/0;for(let o=0;o<e.length;o++)e[o]>t&&(t=e[o]);return t}function getImagePosition(e,t){let o,r,i,n,a=[],l=[],s=0,d=0;if(1!=e){for(let o=0;o<e.length;o+=4)if(e[o+3]>=3){let e=o/4%t,r=Math.floor(o/4/t);a.push(e),l.push(r)}o=arrMin(a),r=arrMin(l),i=arrMax(a),n=arrMax(l),s=(o+i)/2,d=(r+n)/2}return{x:s,y:d}}function setDecorOffset(e,t){let o=getSelection();o[0].pm.u=e,o[0].pm.v=t}function centerImageX(){let e=getSelection();1==e.length&&"decor"==e[0]._class&&getImageData().then((t=>{1!=t&&setDecorOffset(-getImagePosition(t[0],t[1]).x,e[0].pm.v)})),need_redraw=1,need_GUIParams_update=1}function centerImageY(){let e=getSelection();1==e.length&&"decor"==e[0]._class&&getImageData().then((t=>{if(1!=t){let o=getImagePosition(t[0],t[1]).y;setDecorOffset(e[0].pm.u,-o)}})),need_redraw=1,need_GUIParams_update=1}function imageFunctions(){window.getImageSize=getImageSize,window.centerImageX=centerImageX,window.centerImageY=centerImageY}window.aleiContextRenameImage=function(e){var t=prompt("New name:",imageContextMap[e]);CloseImageContext(),null!==t&&ServerRequest(`a=get_images&for_class=${last_for_class}&set_title_for=${e}&value=${t}`,"rename_image")},window.aleiContextDeleteImage=function(e){let t=confirm(`Are you sure you want to delete ${imageContextMap[e]} ?`);CloseImageContext(),t&&(last_element.style.opacity="0.5",ServerRequest(`a=get_images&for_class=${last_for_class}&delete=${e}`,"delete_image"))};let newUpdate=0,targetElement;function doTooltip(){let e=document.createElement("p");e.style.fontSize="16px",e.style.fontFamily="monospace",e.style.color="#eee",e.style.backgroundColor="#000",e.style.padding="10px",e.style.width="fit-content",e.style.borderRadius="4px",e.style.wordBreak="break-all",e.style.position="absolute",e.style.left="100px",e.style.top="-100px",document.body.append(e),document.addEventListener("mousemove",(t=>{t.target.title&&(t.target.dataset.title=t.target.title,t.target.title=""),t.target.parentElement.title&&(t.target.parentElement.dataset.title=t.target.parentElement.title,t.target.parentElement.title="");let o=150;if(t.target.dataset.title){let r=t.target.dataset.title.length;e.style.left=r+o+t.clientX+20+"px",e.innerHTML=t.target.dataset.title,31!=e.getBoundingClientRect().height&&(e.style.left=r+o+t.clientX-20-e.getBoundingClientRect().width+"px")}else if(t.target.parentElement.dataset.title){let r=t.target.parentElement.dataset.title.length;e.style.left=r+o+t.clientX+20+"px",e.style.top=t.clientY+"px",e.innerHTML=t.target.parentElement.dataset.title,31!=e.getBoundingClientRect().height&&(e.style.left=r+o+t.clientX-20-e.getBoundingClientRect().width+"px")}else e.style.left="50px",e.style.top="-100px"})),aleiLog(DEBUG,"Added tooltip.")}function patchDecorUpload(){let e=$id("imageLoader");e.setAttribute("multiple",!0),e.removeEventListener("change",handleImage),e.addEventListener("change",(function(e){let t=e.target.files;NewNote(`ALEI: Will upload ${t.length} bg/decor(s).`,"#2595FF");for(let e of t)handleImage({target:{files:[e]}})}),!1)}function setParameter(e,t){let o=document.getElementById("rparams");e<o.childNodes.length&&(o.childNodes[e].childNodes[1].innerHTML=t)}function getSelection(){let e=[];for(let t=0;t<es.length;t++)es[t].selected&&es[t].exists&&e.push(es[t]);return e}function areObjectsOfSameType(e){let t=1;for(let o=0;o<e.length;o++)e[o]._class!=e[0]._class&&(t=0);return t}function removeSameItems(e){return Array.from(new Set(e))}function removeItems(e,t){let o=JSON.parse(JSON.stringify(e));for(let e=0;e<t.length;e++)o.splice(o.indexOf(t[e]),1);return o}function parameterNamesToIndexes(e,t){let o=[];for(let r=0;r<e.length;r++)o.push(t.indexOf(e[r]));return o}function getSameParameters(e){let t=[],o=Object.keys(e[0].pm);for(let r=0;r<e.length;r++)for(let i=0;i<o.length;i++)e[r].pm[o[i]]!=e[0].pm[o[i]]&&t.push(o[i]);return t=removeSameItems(t),t=removeItems(o,t),parameterNamesToIndexes(t,o)}function toBoolean(e){return isNaN(Number(e))?"true"==e:Boolean(e)}function fixIndex(e,t){let o=e;return"trigger"==t&&e>4&&(o=e+Math.floor((e-2)/3)),o}document.addEventListener("mousedown",(e=>{targetElement=e.target})),document.addEventListener("keydown",(e=>{if(e.ctrlKey&&"KeyS"==e.code&&(e.preventDefault(),document.getElementsByClassName("field_btn")[0].click()),e.ctrlKey&&"KeyF"==e.code){e.preventDefault();let t=prompt("Find objects:","");null!==t&&""!==t&&findObjects(t)&&alert("Nothing found.")}if("KeyR"==e.code&&"[object HTMLInputElement]"!=targetElement&&"opcode_field"!=targetElement.id&&(isOnlyTriggerSelected()||rotateObjects()),e.ctrlKey&&"KeyR"==e.code&&isOnlyTriggerSelected()&&!isNothingSelected()&&(e.preventDefault(),reverseTriggerActions(),unselectTriggerActions()),("Minus"==e.code||"NumpadSubtract"==e.code)&&e.ctrlKey&&canvas_focus&&(e.preventDefault(),zoom*=2,zoom_validate(),need_redraw=1),("Equal"==e.code||"NumpadAdd"==e.code)&&e.ctrlKey&&canvas_focus&&(e.preventDefault(),zoom*=.5,zoom_validate(),need_redraw=1),e.ctrlKey&&e.altKey&&(e.preventDefault(),zoom=1,zoom_validate(),need_redraw=1),"KeyH"==e.code&&e.ctrlKey&&(e.preventDefault(),"opcode_field"===targetElement.id)){let e=targetElement.value,t=prompt("Enter string to replace from:","");if(!t)return;let o=prompt("Enter string to replace to:",t);if(!o)return;targetElement.value=e.replaceAll(t,o)}if("Enter"==e.code&&"[object HTMLInputElement]"!=targetElement&&"opcode_field"!=targetElement.id&&canvas_focus){let e=getSelection();if(0!=e.length){let t=prompt("Enter parameter name:","");if(t){let o=prompt("Enter expression:","");if(o){t=t.toLowerCase().replace("width","w").replace("height","h");for(let r=0;r<e.length;r++){let i=e[r].pm.x,n=e[r].pm.y,a=e[r].pm.w,l=e[r].pm.h;if(void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===l&&(l=0),void 0!==e[r].pm[t]){let s=(0,_alescript_js__WEBPACK_IMPORTED_MODULE_0__.q)(o,[i,n,a,l,r]);if("number"==typeof s){for(let t=0;t<e.length;t++)e[t].selected=0;e[r].selected=1,UpdatePhysicalParam(t,s)}for(let t=0;t<e.length;t++)e[t].selected=1}}need_GUIParams_update=1}}}}if(e.altKey&&e.preventDefault(),e.altKey&&"[object HTMLInputElement]"==targetElement){let e=getSelection();if(1==e.length){let t=e[0].pm.x,o=e[0].pm.y,r=e[0].pm.w,n=e[0].pm.h;void 0===t&&(t=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===n&&(n=0);let a=(0,_alescript_js__WEBPACK_IMPORTED_MODULE_0__.q)(targetElement.value,[t,o,r,n,i]);"number"==typeof a&&(targetElement.value=a)}}if(e.ctrlKey&&"KeyP"==e.code&&(e.preventDefault(),copyToPermanentClipboard()),e.ctrlKey&&e.shiftKey&&newUpdate){let e=new Object;window.onblur=function(){setTimeout((()=>{e.close()}),1e3)},window.onfocus=function(){location.reload()},e=window.open("https://github.com/LisABC/ALEI/raw/main/alei.user.js")}}));const parameterMap={box:{m:"box_model"},door:{moving:"bool",vis:"bool"},region:{use_on:"region_activation"},decor:{f:"draw_in_front",model:"decor_model"},bg:{s:"bool",f:"draw_in_front",m:"bg_model"},water:{friction:"bool"},trigger:{enabled:"bool"},timer:{enabled:"bool"},gun:{command:"team+any",upg:"gun_upgrade",model:"gun_model"},barrel:{model:"barrel_model"},lamp:{flare:"bool"},vehicle:{model:"vehicle_model"}};function fixParameterValue(e,t,o){let r;return r=VAL_TABLE[e]?VAL_TABLE[e][t]:parameterMap[o]&&parameterMap[o][e]?VAL_TABLE[parameterMap[o][e]][t]:"actions_"==e.slice(0,8)&&"_type"==e.slice(-5)?VAL_TABLE.trigger_type[t]:t,r}function setSameParameters(){let e=getSelection();if(areObjectsOfSameType(e)&&e.length>=2){let t=getSameParameters(e),o=Object.keys(e[0].pm);for(let r=0;r<t.length;r++){let i=o[t[r]],n=e[0].pm[o[t[r]]],a=e[0]._class;setParameter(fixIndex(t[r],a),fixParameterValue(i,n,a))}}}function assignObjectIDs(){if(!aleiSettings.showIDs)return;let e={};for(let t of es)t.exists&&(void 0===e[t._class]&&(e[t._class]=-1),e[t._class]+=1,t.aleiID=e[t._class])}function assignZIndex(){for(let e=0;e<es.length;e++)void 0===es[e].pm.__zIndex&&(es[e].pm.__zIndex=1)}function patchANI(){let e=ani;window.ani=function(){let t=need_GUIParams_update;e(),t&&(assignObjectIDs(),assignZIndex(),aleiSettings.showSameParameters&&setSameParameters())},aleiLog(DEBUG,"Patched ANI")}function updateBoxSplitterSize(){let e=$id("gui_objbox").getBoundingClientRect(),t=splitter2.style;t.setProperty("width",e.width),t.setProperty("left",e.x),t.setProperty("top",e.bottom)}function addObjBoxResize(){let e=$id("gui_objbox"),t=document.createElement("div");window.splitter2=t;let o=t.style;$id("floattag").appendChild(t),o.setProperty("position","absolute"),o.setProperty("height","5px"),o.setProperty("cursor","s-resize"),updateBoxSplitterSize();let r=!1;t.onmousedown=e=>{r=!0},ROOT_ELEMENT.addEventListener("mouseup",(e=>{r=!1})),ROOT_ELEMENT.addEventListener("mousemove",(t=>{if(!r)return;let o=t.clientY-90;e.style.height=o,updateBoxSplitterSize(),ShowHideObjectBox(),ShowHideObjectBox()})),aleiLog(DEBUG,"Added splitter for object box.")}function patch_m_down(){let e=window.m_down;window.m_down=function(t){let o=es.length;if(e(t),es.length>o){assignObjectIDs(),assignZIndex(),sortObjects();let e=es[es.length-1];if(!("x"in e.pm))return;let t=e.pm,o=function(e){return Math.round(e/GRID_SNAPPING)*GRID_SNAPPING};t.x=o(t.x),t.y=o(t.y),e._isresizable&&(t.w=o(t.w),t.h=o(t.h)),window.need_GUIParams_update=!0,UpdateGUIObjectsList()}}}function patchEntityClass(){let e=E;window.E=function(t){let o=new e(t);if("water"==t)o.pm.attach=-1;else if("decor"==t)o.pm.text="Hello World!";else if("trigger"==t){let e=Object.entries(o.pm);e.splice(5,0,["execute",!1]),o.pm=Object.fromEntries(e)}else"region"==t&&(o.pm.uses_timer=!1);return o.fixPos=function(){},o},aleiLog(DEBUG,"Patched entity.")}function PasteFromClipBoard(e){var t=new Object;if(null==sessionStorage[e])return!1;t=unserialize(sessionStorage[e]),lcz();for(var o=0;o<es.length;o++)es[o].exists&&es[o].selected&&(ldn("es["+o+"].selected=false;"),lnd("es["+o+"].selected=true;"),es[o].selected=!1);var r=0,i=0,n=0,a=0;o=0;for(var l=es.length;void 0!==t[o];){var s=es.length;for(param in ldn("es["+s+"].exists=true;"),lnd("es["+s+"].exists=false;"),es[s]=new E(t[o]._class),t[o])es[s][param]=t[o][param];void 0!==es[s].pm.x&&void 0!==es[s].pm.y&&(0==o?(r=es[s].pm.x,n=es[s].pm.y,i=es[s].pm.x,a=es[s].pm.y,void 0!==es[s].pm.w&&void 0!==es[s].pm.h&&(r+=es[s].pm.w/2,i+=es[s].pm.w/2,n+=es[s].pm.h/2,a+=es[s].pm.h/2)):(r=Math.min(r,es[s].pm.x),n=Math.min(n,es[s].pm.y),i=Math.max(i,es[s].pm.x),a=Math.max(a,es[s].pm.y),void 0!==es[s].pm.w&&void 0!==es[s].pm.h&&(i=Math.max(i,es[s].pm.x+es[s].pm.w),a=Math.max(a,es[s].pm.y+es[s].pm.h)))),o++}ldn("m_drag_selected=true;"),ldn("paint_draw_mode=true;"),ldn("quick_pick_ignore_one_click=true;"),lnd("m_drag_selected=false;"),lnd("paint_draw_mode=false;"),lnd("quick_pick_ignore_one_click=false;"),ldis=!0,paint_draw_mode=!0,quick_pick_ignore_one_click=!0,lmdrwa=lmwa,lmdrwb=lmwb;let d=lmwa,c=lmwb;m_drag_x=mouse_x,m_drag_y=mouse_y,m_down_x=d,m_down_y=c;for(var p=Math.round(d/GRID_SNAPPING)*GRID_SNAPPING,g=Math.round(c/GRID_SNAPPING)*GRID_SNAPPING,m=Math.round((p-(r+i)/2)/GRID_SNAPPING)*GRID_SNAPPING,u=Math.round((g-(n+a)/2)/GRID_SNAPPING)*GRID_SNAPPING,h=l;h<es.length;h++){if(void 0!==es[h].pm.uid){var _=es[h].pm.uid;es[h].exists=!1,es[h].pm.uid=RandomizeName(es[h].pm.uid),es[h].exists=!0;for(var f=l;f<es.length;f++)for(param in es[f].pm)"string"==typeof es[f].pm[param]&&es[f].pm[param]==_&&(es[f].pm[param]=es[h].pm.uid)}void 0!==es[h].pm.x&&void 0!==es[h].pm.y&&(lnd("es["+h+"].pm.x="+es[h].pm.x+";"),lnd("es["+h+"].pm.y="+es[h].pm.y+";"),es[h].pm.x+=m,es[h].pm.y+=u,es[h].fixPos(),ldn("es["+h+"].pm.x="+es[h].pm.x+";"),ldn("es["+h+"].pm.y="+es[h].pm.y+";"))}for(p=Math.round((d-m_down_x)/GRID_SNAPPING)*GRID_SNAPPING,g=Math.round((c-m_down_y)/GRID_SNAPPING)*GRID_SNAPPING,o=0;o<es.length;o++)es[o]._isphysical&&es[o].exists&&es[o].selected&&(MatchLayer(es[o])||paint_draw_mode)&&(es[o].pm.x+=p,es[o].pm.y+=g);return m_down_x+=p,m_down_y+=g,lfz(!1),!0}function ServerRequest_handleMapData(e){aleiLog(DEBUG,"Parsing map source now.");const t=/(\w+)=((-?\d+(\.\d+)?)|("[ -~]*")|true|false)/,o=/q=es\[\d+\]=new E\("(\w+)"\)/;let r=e.split(";\n"),i=null;window.es=new Array;let n=2;for(;n<r.length;n++){let e=r[n];if(0==e.replaceAll("\n","").replaceAll("\t","").length)continue;if(-1!=e.indexOf("mapid = '")){window.mapid=e.split(" = ")[1].slice(1,-1),mapid_field.value=mapid;continue}if("\t\tmapid_field.value = mapid"==e)continue;if(-1!=e.indexOf("maprights.innerHTML='")){let t=e.split(";")[0].split(".innerHTML=")[1].slice(1,-1);maprights.value=t,NewNote(`Map '${mapid}' has been successfully loaded.`,note_good),assignZIndex(),sortObjects();continue}if(-1!=e.indexOf(";q=q.pm;")){let t=o.exec(e);i=new E(t[1]),es[es.length]=i;let r=e.split(";");if(r.length>3){aleiLog(WARN,`Expected 3 items, got ${r.length} - ${r}`);continue}e=r[2]}let a=t.exec(e);if(null===a){aleiLog(WARN,`Unable to figure out what kind of code is "${e}", you MIGHT have issues.`);continue}let l=a[1],s=a[2].replaceAll("\\/","/");s='"'!=s[0]?"true"==s||"false"!=s&&(-1!=s.indexOf(".")?parseFloat(s):parseInt(s)):s.slice(1,-1).replaceAll("\\'","'"),i.pm[l]=s}}function handleServerRequestResponse(e,t,o){if(-1!=o.indexOf("var es = new Array();"))ServerRequest_handleMapData(o);else if(-1!==o.indexOf("knownmaps = [")){window.knownmaps=[];for(let e of o.match(/"(.*?)"/g))knownmaps.push(e.slice(1,-1));aleiLog(DEBUG,`Updated knownmaps with ${knownmaps.length} maps`)}else{aleiLog(DEBUG2,`Evaling for request ${ANSI_YELLOW}"${e}"${ANSI_RESET} with operation of ${ANSI_YELLOW}"${t}"${ANSI_RESET}: ${o}`);try{JS_eval(o)}catch(r){NewNote("Eval error!",note_bad),console.error(r),aleiLog(INFO,`Eval Error from ${e}, for op ${t} whose response is ${o}`)}}}function makeRequest(e,t,o){return new Promise((function(r,i){let n=new XMLHttpRequest;n.open(e,t),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onload=function(){this.status>=200&&this.status<300?r({status:200,response:n.response}):i({status:this.status,statusText:n.statusText})},n.onerror=function(){i({status:this.status,statusText:n.statusText})},n.send(o)}))}function updateDecorList(){try{let e=$id("list_native");for(let t=0;t<ALEI_decors.length;t++){let o=ALEI_decors[t],r=o[0],i=o[1],n=o[2];e.innerHTML+=`\n                    <div class="img_option" onClick="CustomImageSelected('${r}', '${i}' )">\n                       <div class="imgdiv" style="background:url(${n})"></div>\n                       <div>\n                         ${i}\n                       </div>\n                    </div>\n                    `}aleiLog(DEBUG,"Updated decor list.")}catch(e){}}async function ALEI_ServerRequest(e,t,o=null){let r=await makeRequest("POST",`e_server.php?a=${request_a}`,e);if(200==r.status){try{handleServerRequestResponse(e,t,r.response),-1!=e.indexOf("a=get_images")&&-1!=e.indexOf("for_class=decor_model")&&updateDecorList(),window.ImageContext=ImageContext,"save"!=t&&"load"!=t||(changes_made=!1,"load"==t&&(need_redraw=!0,need_GUIParams_update=!0,ClearUndos()))}catch(e){console.error(e),NewNote("Server responds with unclear message. Looks like one of recent actions wasn't successful.",note_bad)}null!=o&&o()}else"save"==t?NewNote("Oops! Error occoured during saving. Usually it may be happening due to connection problems. Map will be temporary saved to your computer's LocalStorage",note_bad):"load"==t&&NewNote("Oops! Error occoured durning loading. Usually it may be happening due to connection problems.",note_bad)}let _serverRequestPatched=!1;function patchServerRequest(){_serverRequestPatched||(_serverRequestPatched=!0,window.ServerRequest=ALEI_ServerRequest,aleiLog(DEBUG,"Patched ServerRequest"))}function patchUpdateGUIParams(){let code=window.UpdateGUIParams.toString().replace("if ( i >= 4 && (i-4) % 3 == 0 ) {","if (shouldAddSeparatorInGUIParams(i)) {");code="("+code+")";let origUGP=eval(code),origGPV=window.GenParamVal;window.GenParamValEscapeDoubleQuotes=!1,window.GenParamVal=function(e,t){return GenParamValEscapeDoubleQuotes&&"nochange"==e?`<pvalue real="${`${t}`.replaceAll('"',"&quot;")}">- not used -</pvalue>`:origGPV(e,t)},window.shouldAddSeparatorInGUIParams=function(e){let t=5;return 1==getSelection().length&&aleiSettings.showIDs&&(t=6),e>=t&&(e-t)%3==0},window.UpdateGUIParams=function(){GenParamValEscapeDoubleQuotes=!0;let e=[],t=getSelection(),o=1==t.length&&aleiSettings.showIDs,r=t.length>=1&&aleiSettings.showZIndex;for(let e=0;e<t.length;e++)"trigger"==t[e]._class&&(r=0);if(o){let e=Object.entries(t[0].pm);e.splice(0,0,["__id",t[0].aleiID]),t[0].pm=Object.fromEntries(e)}if(!r)for(let o=0;o<t.length;o++)e.push(t[o].pm.__zIndex),delete t[o].pm.__zIndex;if(1==t.length&&"region"==t[0]._class&&(-1!=[!0,"true"].indexOf(t[0].pm.uses_timer)?param_type[REGION_EXECUTE_PARAM_ID][1]="timer+none":param_type[REGION_EXECUTE_PARAM_ID][1]="trigger+none"),origUGP(),o&&delete t[0].pm.__id,!r)for(let o=0;o<t.length;o++)t[o].pm.__zIndex=e.shift();addDecorButtons(),GenParamValEscapeDoubleQuotes=!1},aleiLog(DEBUG,"Patched UpdateGUIParams")}function patchEvalSet(){window.EvalSet=function(e,t){window[e]=t,UpdateTools()},aleiLog(DEBUG,"Patched EvalSet")}function createALEISettingsMenu(){let e=document.createElement("div");e.setAttribute("class","mrpopup");let t=document.createElement("div");t.innerHTML="ALEI Setting",t.setAttribute("id","mrtitle"),e.appendChild(t);let o=document.createElement("div");o.setAttribute("id","mrbox"),e.appendChild(o);let r=document.createElement("style");function i(e,t=!1){let r=document.createElement("div");r.innerHTML=e,t&&r.style.setProperty("color","#FFFF00"),r.setAttribute("class","ALEI_settingMenuText"),o.innerHTML+="<br>",o.innerHTML+=r.outerHTML}function n(e,t,o){aleiSettingButtonsMap[e]=[t,o]}function a(e,t,r,i=""){aleiButtonClicks["setting_"+t]=r;let n=document.createElement("input");n.setAttribute("type","button"),n.setAttribute("id","ALEI_"+t),n.setAttribute("value",e),n.setAttribute("onclick",`aleiButtonClicks['setting_${t}'](); ALEI_settingUpdateButtons(); triggerActionsPreventError();`),n.setAttribute("class","ALEI_settingsMenuButton"),n.setAttribute("style",i),o.innerHTML+=n.outerHTML}function l(e,t,o,r,i,n=(()=>{})){function l(e){writeStorage(o,e),aleiSettings[r]=e}a(e,`${i}_true`,(()=>{l(!0),n(!0)})),a(t,`${i}_false`,(()=>{l(!1),n(!1)}))}function s(e){writeStorage("ALEI_LogLevel",e),aleiSettings.logLevel=e}r.innerHTML="\n    .ALEI_settingMenuText {\n        font-size: 14px;\n        width: 150px;\n        height: 20px;\n        background-color: #476082;\n        color: #bfcad9;\n        border-radius: 4px;\n        text-align: center;\n        display: inline-block;\n    }\n    .ALEI_settingsMenuButton {\n        background-color: #26354a;\n        color: #c1c9d3;\n        border-radius: 5px;\n        border: 1px solid #26354a;\n        width: 70px;\n        height: 20px;\n        font-size: 14px;\n        text-align: center;\n        display: inline-block;\n        margin-right: 4px;\n    }\n    .ALEI_settingsMenuButton:hover {\n        background-color: #596a83;\n        color: #f5faff;\n    }\n    .ALEI_settingMenuButtonClicked {\n        background-color: #91a5c1;\n        color: #fbfbfb;\n    }\n    ",document.head.appendChild(r),o.innerHTML+="NOTE: Settings in yellow text requires page refresh to be applied.<br>",a("Clear Backup","clearMapBackups",(()=>{let e=[];for(let t of Object.keys(localStorage))"pb2_map"==t.slice(0,7)&&(e.push(t),localStorage.removeItem(t));NewNote(`ALEI: Cleared backup, removed total ${e.length} backups.`,"#00FFFF"),aleiLog(DEBUG2,`Removed backup of: ${e}`)}),"width: 100px"),o.innerHTML+="<br>",n("log",[0,1,2],"logLevel"),i("Log Level:"),a("INFO","log_0",(()=>s(0))),a("DEBUG","log_1",(()=>s(1))),a("DEBUG2","log_2",(()=>s(2))),n("actionid",[!0,!1],"showTriggerIDs"),i("Action IDs:",!0),l("Show","Hide","ALEI_ShowTriggerIDs","showTriggerIDs","actionid"),n("tooltip",[!0,!1],"enableTooltips"),i("Tooltips:"),l("Show","Hide","ALEI_ShowTooltips","enableTooltips","tooltip"),n("showids",[!0,!1],"showIDs"),i("Object IDs:"),l("Show","Hide","ALEI_ShowIDs","showIDs","showids"),n("showzindex",[!0,!1],"showZIndex"),i("Object z-index:"),l("Show","Hide","ALEI_ShowZIndex","showZIndex","showzindex"),n("sameparams",[!0,!1],"showSameParameters"),i("Same Parameters:"),l("Show","Hide","ALEI_ShowSameParameters","showSameParameters","sameparams"),n("blackTheme",[!0,!1],"blackTheme"),i("Black theme:",!0),l("Yes","No","ALEI_BlackTheme","blackTheme","blackTheme"),n("changeGridBasedOnSnapping",[!0,!1],"gridBasedOnSnapping"),i("Grid by Snap:"),l("Yes","No","ALEI_gridBasedOnSnapping","gridBasedOnSnapping","changeGridBasedOnSnapping"),n("showObjectNames",[!0,!1],"renderObjectNames"),i("Show object names: "),l("Yes","No","ALEI_RenderObjectNames","renderObjectNames","showObjectNames",(e=>ALEI_UpdateNameRenderSetting(e))),n("remapUID",[!0,!1],"rematchUID"),i("Remap UID: "),l("Enabled","Disabled","ALEI_RemapUID","rematchUID","remapUID",(e=>ALEI_UpdateRematchUIDSetting(e))),n("textAffectedByZoomOption",[!0,!1],"textAffectedByZoom"),i("Text affected by zoom:"),l("Yes","No","ALEI_TextAffectedByZoom","textAffectedByZoom","textAffectedByZoomOption"),window.ALEI_settingsMenu=e,document.body.appendChild(e),ALEI_settingUpdateButtons(),aleiLog(DEBUG,"Created settings window.")}window.eval=function(e){void 0!==window.ServerRequest?(handleServerRequestResponse(null,null,e),patchServerRequest(),window.eval=JS_eval):console.log(e)},window.ALEI_settingsMenu=void 0;let aleiSettingButtonsMap={};function showSettings(){void 0===ALEI_settingsMenu&&createALEISettingsMenu(),mrdimlights.style.display="block",ALEI_settingsMenu.style.display="block",dim_undo="ALEI_settingsMenu.style.display = 'none'"}function patchTeamList(){for(let e of Object.entries(VAL_TABLE.team)){let t=parseInt(e[0]),o=e[1];t<0&&(o=o.replace("(no friendly fire)","(No collision, Yes friendly fire)"),VAL_TABLE.team[t]=o),-1!==t&&(VAL_TABLE["team+any"][t]=o)}aleiLog(DEBUG,"Edited team list..")}function addProjectileModels(){let e=VAL_TABLE.ALEI_projectileModels={1:"https://static.miraheze.org/plazmaburstwiki/6/6a/Lazer_1.png",2:"https://static.miraheze.org/plazmaburstwiki/a/ae/Lazer_2.png",3:"https://static.miraheze.org/plazmaburstwiki/0/06/Lazer_3.png",4:"https://static.miraheze.org/plazmaburstwiki/d/de/Lazer_4.png",5:"https://static.miraheze.org/plazmaburstwiki/8/8f/Lazer_5.png",6:"https://static.miraheze.org/plazmaburstwiki/a/a0/Lazer_6.png",7:"https://static.miraheze.org/plazmaburstwiki/7/71/Lazer_7.png",8:"https://static.miraheze.org/plazmaburstwiki/c/c6/Lazer_8.png",9:"https://static.miraheze.org/plazmaburstwiki/d/d2/Lazer_9.png",10:"https://static.miraheze.org/plazmaburstwiki/5/5b/Lazer_10.png",11:"https://static.miraheze.org/plazmaburstwiki/d/d2/Lazer_11.png",12:"https://static.miraheze.org/plazmaburstwiki/2/2d/Lazer_12.png",13:"https://static.miraheze.org/plazmaburstwiki/b/be/Lazer_13.png",14:"https://static.miraheze.org/plazmaburstwiki/1/14/Lazer_14.png",15:"",16:"https://static.miraheze.org/plazmaburstwiki/7/7f/Lazer_16.png",17:"https://static.miraheze.org/plazmaburstwiki/3/31/Lazer_17.png",18:"https://static.miraheze.org/plazmaburstwiki/8/89/Lazer_18.png",19:"https://static.miraheze.org/plazmaburstwiki/f/fe/Lazer_19.png",20:"https://static.miraheze.org/plazmaburstwiki/1/1a/Lazer_20.png",21:"https://static.miraheze.org/plazmaburstwiki/4/42/Lazer_21.png",22:"https://static.miraheze.org/plazmaburstwiki/c/c0/Lazer_22.png",23:"https://static.miraheze.org/plazmaburstwiki/d/d9/Lazer_23.png",24:"https://static.miraheze.org/plazmaburstwiki/f/f5/Lazer_24.png",25:"https://static.miraheze.org/plazmaburstwiki/7/7c/Lazer_25.png",26:"https://static.miraheze.org/plazmaburstwiki/a/a7/Lazer_26.png",27:"https://static.miraheze.org/plazmaburstwiki/3/30/Lazer_27.png",28:"https://static.miraheze.org/plazmaburstwiki/3/3a/Lazer_28.png",29:"https://static.miraheze.org/plazmaburstwiki/9/90/Lazer_29.png",30:"https://static.miraheze.org/plazmaburstwiki/2/23/Lazer_30.png",31:"https://static.miraheze.org/plazmaburstwiki/3/3a/Lazer_31.png",32:"https://static.miraheze.org/plazmaburstwiki/f/f0/Lazer_32.png",33:"https://static.miraheze.org/plazmaburstwiki/0/0d/Lazer_33.png",34:"https://static.miraheze.org/plazmaburstwiki/c/c8/Lazer_34.png",35:"https://static.miraheze.org/plazmaburstwiki/3/38/Lazer_35.png",36:"https://static.miraheze.org/plazmaburstwiki/6/6d/Lazer_36.png",37:"https://static.miraheze.org/plazmaburstwiki/a/a9/Lazer_37.png",38:"https://static.miraheze.org/plazmaburstwiki/e/e7/Lazer_38.png",39:"https://static.miraheze.org/plazmaburstwiki/6/6c/Lazer_39.png",40:"https://static.miraheze.org/plazmaburstwiki/d/d4/Lazer_40.png",41:"https://static.miraheze.org/plazmaburstwiki/5/5d/Lazer_41.png",42:"https://static.miraheze.org/plazmaburstwiki/9/9d/Lazer_42.png",43:"https://static.miraheze.org/plazmaburstwiki/7/79/Lazer_43.png",44:"https://static.miraheze.org/plazmaburstwiki/6/6d/Lazer_44.png",45:"https://static.miraheze.org/plazmaburstwiki/4/44/Lazer_45.png",46:"https://static.miraheze.org/plazmaburstwiki/3/3b/Lazer_46.png",47:"https://static.miraheze.org/plazmaburstwiki/8/84/Lazer_47.png",48:"https://static.miraheze.org/plazmaburstwiki/7/75/Lazer_48.png",49:"https://static.miraheze.org/plazmaburstwiki/0/08/Lazer_49.png",50:"https://static.miraheze.org/plazmaburstwiki/4/41/Lazer_50.png",51:"https://static.miraheze.org/plazmaburstwiki/9/92/Lazer_51.png",52:"https://static.miraheze.org/plazmaburstwiki/9/92/Lazer_52.png",53:"https://static.miraheze.org/plazmaburstwiki/7/70/Lazer_53.png",54:"https://static.miraheze.org/plazmaburstwiki/e/ee/Lazer_54.png",55:"https://static.miraheze.org/plazmaburstwiki/d/d1/Lazer_55.png"};for(let t=1;t<56;t++)e[t]=`<img src='${e[t]}' style='width: 60px; height: 20px'/>`;aleiLog(DEBUG,"Loaded projectile models.")}function patchSpecialValue(){let e=window.special_value;window.special_value=(t,o)=>{if(-1!==["ALEI_projectileModels"].indexOf(t)){let e=VAL_TABLE[t][o];return void 0===e?ERROR_VALUE:e}return"trigger+none"==t?-1==o?VAL_TABLE["trigger+none"][-1]:special_value("trigger",o):"timer+none"==t?-1==o?VAL_TABLE["timer+none"][-1]:special_value("timer",o):e(t,o)},aleiLog(DEBUG,"Patched SpecialValue")}function notifyUpdate(e){newUpdate=1,aleiLog(INFO,`New update: ${e}`),NewNote(`ALEI: There is new update: ${e}, you are currently in ${GM_info.script.version}<br>Press Ctrl + Shift to update`,"#FFFFFF")}function notifyIfTheresUpdate(e){let t,o=e.split("\n");for(let e=0;e<o.length;e++){let r=o[e];if(-1==r.indexOf("@version"))continue;let i=r.split(" ");t=i[i.length-1];break}let r=t.split("."),i=GM_info.script.version.split(".");if(r.length>i.length)return notifyUpdate(t);let n=Math.min(r.length,i.length);for(let e=0;e<n;e++)if(parseInt(r[e])>parseInt(i[e]))return notifyUpdate(t);aleiLog(INFO,"No update detected.")}async function checkForUpdates(){notifyIfTheresUpdate((await GM.xmlHttpRequest({url:GM_info.script.updateURL}).catch((e=>console.error(e)))).responseText)}function ALEI_DoWorldScale(){var e=prompt("Multiply selection size by % (percents)",100);if(null==e||100==e);else{var t=Math.floor(e)/100;{let r="/GRID_SNAPPING)*GRID_SNAPPING;";var o=!0;for(lcz(),i=0;i<es.length;i++)es[i].exists&&es[i].selected&&MatchLayer(es[i])&&(null!=es[i].pm.w&&(ldn("es["+i+"].pm.w=Math.round(es["+i+"].pm.w*"+t+r),lnd("es["+i+"].pm.w="+es[i].pm.w+";"),es[i].pm.w*t!=Math.round(es[i].pm.w*t/GRID_SNAPPING)*GRID_SNAPPING&&(o=!1)),null!=es[i].pm.h&&(ldn("es["+i+"].pm.h=Math.round(es["+i+"].pm.h*"+t+r),lnd("es["+i+"].pm.h="+es[i].pm.h+";"),es[i].pm.h*t!=Math.round(es[i].pm.h*t/GRID_SNAPPING)*GRID_SNAPPING&&(o=!1)),null!=es[i].pm.x&&(ldn("es["+i+"].pm.x=Math.round(es["+i+"].pm.x*"+t+r),lnd("es["+i+"].pm.x="+es[i].pm.x+";"),es[i].pm.x*t!=Math.round(es[i].pm.x*t/GRID_SNAPPING)*GRID_SNAPPING&&(o=!1)),null!=es[i].pm.y&&(ldn("es["+i+"].pm.y=Math.round(es["+i+"].pm.y*"+t+r),lnd("es["+i+"].pm.y="+es[i].pm.y+";"),es[i].pm.y*t!=Math.round(es[i].pm.y*t/GRID_SNAPPING)*GRID_SNAPPING&&(o=!1)));lfz(!0),NewNote("Operation complete:<br><br>Selected objects scaled by "+t+" ("+e+"% of original size)",note_passive),o||NewNote("Note: Position and/or dimensions of some objects were not scaled properly due to Level Editor rounding rules",note_neutral),need_GUIParams_update=!0,need_redraw=!0,UpdateTools()}}}function patchPercentageTool(){window.DoWorldScale=ALEI_DoWorldScale,aleiLog(DEBUG,"Patched percentage tool")}function _encodeXMLChars(e){return e.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;")}function patchCompileTrigger(){let e=window.CompileTrigger;window.CompileTrigger=()=>{let t=e(),o=getSelection();for(let e=0;e<o.length;e++){let t=o[e],r=Object.keys(t.pm);for(let e=0;e<r.length;e++)"string"==typeof t.pm[r[e]]&&(t.pm[r[e]]=_encodeXMLChars(t.pm[r[e]]))}return t},aleiLog(DEBUG,"Patched CompileTrigger")}function addPasteFromPermanentClipboard(){window.pasteFromPermanentClipboard=pasteFromPermanentClipboard}window.ALEI_settingUpdateButtons=()=>{for(let e of Object.entries(aleiSettingButtonsMap)){let t=e[0],o=e[1][0],r=e[1][1],i=aleiSettings[r];for(let e of o)$query(`#ALEI_${t}_${e}`).setAttribute("class","ALEI_settingsMenuButton");$query(`#ALEI_${t}_${i}`).setAttribute("class","ALEI_settingsMenuButton ALEI_settingMenuButtonClicked")}};let selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1,triggerActionsClipboard=[];function getTriggerActionElements(){let e=[],t=document.getElementsByClassName("p_i"),o=6;for(aleiSettings.showIDs&&o++;o<t.length;o++)e.push(t[o].childNodes[0]);return e}function addEventListeners(){let e=getTriggerActionElements();for(let t=0;t<e.length;t++){let o=e[t];o.onmousedown=function(){selectedTriggerActions[Math.floor(t/3)]^=1,updateTriggerActionElements()},o.onmouseenter=function(){hoveredTriggerAction=Math.floor(t/3),updateTriggerActionElements()},o.onmouseleave=function(){hoveredTriggerAction=-1,updateTriggerActionElements()}}}function updateTriggerActionElements(){let e=getTriggerActionElements();for(let t=0;t<10;t++){let o="";selectedTriggerActions[t]&&(o="rgb(45, 65, 95)",0!=THEME&&(o="rgb(27, 27, 27)")),e[3*t+0].style.backgroundColor=o,e[3*t+1].style.backgroundColor=o,e[3*t+2].style.backgroundColor=o}if(-1!=hoveredTriggerAction&&!selectedTriggerActions[hoveredTriggerAction]){let t="rgb(65, 85, 130)";0!=THEME&&(t="rgb(47, 47, 47)"),e[3*hoveredTriggerAction+0].style.backgroundColor=t,e[3*hoveredTriggerAction+1].style.backgroundColor=t,e[3*hoveredTriggerAction+2].style.backgroundColor=t}}function isOnlyTriggerSelected(){let e=0,t=getSelection();return 1==t.length&&"trigger"==t[0]._class&&(e=1),e}function getTriggerActions(){edit_triggers_as_text=1,UpdateGUIParams();let e=document.getElementById("opcode_field").value.split("\n").slice(4);for(;e.length<10;)e.push("");return edit_triggers_as_text=0,UpdateGUIParams(),e}function copyTriggerActions(){let e=getTriggerActions();triggerActionsClipboard=[];for(let t=0;t<10;t++)selectedTriggerActions[t]&&triggerActionsClipboard.push(e[t])}function isNothingSelected(){return!selectedTriggerActions.includes(1)}function isOnlyOneTriggerActionSelected(){return selectedTriggerActions.indexOf(1)==selectedTriggerActions.lastIndexOf(1)&&!isNothingSelected()}function getSelectedTriggerAction(){return selectedTriggerActions.indexOf(1)}function getTriggerInfo(){return edit_triggers_as_text=1,UpdateGUIParams(),document.getElementById("opcode_field").value.split("\n").slice(0,3)}function pasteTriggerActions(){let e=getTriggerActions(),t=getSelectedTriggerAction(),o=triggerActionsClipboard.join("\n"),r=getTriggerInfo();edit_triggers_as_text=1,UpdateGUIParams(),isNothingSelected()&&(t=e.length-1,e[t]=e[t]+"\n"+o),isOnlyOneTriggerActionSelected()&&(e[t]=o+"\n"+e[t]),document.getElementById("opcode_field").value=r.concat(e).join("\n"),CompileTrigger(),edit_triggers_as_text=0,UpdateGUIParams()}function deleteTriggerActions(){let e=getTriggerActions(),t=getTriggerInfo();edit_triggers_as_text=1,UpdateGUIParams();for(let t=0;t<10;t++)selectedTriggerActions[t]&&(e[t]="");document.getElementById("opcode_field").value=t.concat(e).join("\n"),CompileTrigger(),edit_triggers_as_text=0,UpdateGUIParams()}function reverseTriggerActions(){let e=getTriggerActions(),t=[],o=[],r=getTriggerInfo();edit_triggers_as_text=1,UpdateGUIParams();for(let r=0;r<10;r++)selectedTriggerActions[r]&&(t.push(e[r]),o.push(r));o.reverse();for(let r=0;r<t.length;r++){let i=o[r],n=t[r];e[i]=n}document.getElementById("opcode_field").value=r.concat(e).join("\n"),displayOperationCompleteNotes=!1,CompileTrigger(),displayOperationCompleteNotes=!0,NewNote("Reversed actions.","#FFFFFF"),edit_triggers_as_text=0,UpdateGUIParams()}function unselectTriggerActions(){selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1,updateTriggerActionElements()}function triggerActionsPreventError(){selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1,UpdateGUIParams()}function patchClipboardFunctions(){let e=CopyToClipBoard,t=PasteFromClipBoard,o=DeleteSelection,r=UpdateGUIParams,i=DO_UNDO,n=DO_REDO;window.CopyToClipBoard=function(t){if(isNothingSelected()){let o=e(t);return triggerActionsClipboard=[],o}return copyTriggerActions(),unselectTriggerActions(),!0},window.PasteFromClipBoard=function(e){if(0==triggerActionsClipboard.length){let o=t(e);return UpdateGUIParams(),o}return displayOperationCompleteNotes=!1,pasteTriggerActions(),unselectTriggerActions(),displayOperationCompleteNotes=!0,!0},window.DeleteSelection=function(){isNothingSelected()?o():(displayOperationCompleteNotes=!1,deleteTriggerActions(),unselectTriggerActions(),NewNote("Deleted trigger actions.","#FFFFFF"),displayOperationCompleteNotes=!0)},window.UpdateGUIParams=function(){r(),isOnlyTriggerSelected()?edit_triggers_as_text||(addEventListeners(),updateTriggerActionElements()):(selectedTriggerActions=[0,0,0,0,0,0,0,0,0,0],hoveredTriggerAction=-1)},window.DO_UNDO=function(){try{i()}catch(e){NewNote("Can't undo action.",note_bad)}},window.DO_REDO=function(){try{n()}catch(e){NewNote("Can't redo action.",note_bad)}},window.triggerActionsPreventError=triggerActionsPreventError,aleiLog(DEBUG,"Patched clipboard related functions.")}function patchDrawGrid(){let e=lg;window.lg=function(t,o){aleiSettings.gridBasedOnSnapping?e(t*(GRID_SNAPPING/10),Math.min(o*Math.max(GRID_SNAPPING/10,1),1)):e(t,o)},aleiLog(DEBUG,"Patched LG")}function patchNewNote(){let e=NewNote;window.NewNote=(t,o)=>displayOperationCompleteNotes||"Operation complete:<br><br>"!=t.slice(0,27)?e(t,o):void 0}var zoomedTextScaleMultiply=1.4;function ALEI_renderObjectNameText(e,t,o,r,i){if(aleiSettings.textAffectedByZoom){let n=1/zoom;n*=zoomedTextScaleMultiply,n>1&&(n=1);let a=o-i.width*n/2,l=r+3*n;e.translate(a,l),e.scale(n,n),e.fillText(t,0,0),e.scale(1/n,1/n),e.translate(-a,-l)}else e.fillText(t,o-i.width/2,r+3)}function patchRender(){let oldCodeSnippet="ctx.fillText(fillText, x3, y3+8 + (dim.height-10)/2);",newCodeSnippet="ALEI_renderObjectNameText(ctx, fillText, capx, capy, dim);",code=ALE_Render.toString().replace(oldCodeSnippet,newCodeSnippet);code=code.replace("for ( property in es[i].pm )","for (var property in es[i].pm)"),code="("+code+")",window.Render=eval(code),aleiLog(DEBUG,"Patched Render")}let ALE_start=async function(){if(VAL_TABLE=special_values_table,ROOT_ELEMENT=document.documentElement,stylesheets=document.styleSheets,ALE_Render=Render,addPropertyPanelResize(),addObjBoxResize(),updateStyles(),updateSkins(),updateSounds(),updateVoicePresets(),updateParameters(),updateOffsets(),updateObjects(),updateButtons(),patch_m_down(),addSessionSync(),addTriggerIDs(),patchShowHideButton(),optimize(),patchUpdateTools(),patchDecorUpload(),patchEntityClass(),patchNewNote(),patchEvalSet(),window.UpdatePhysicalParam=UpdatePhysicalParam,window.PasteFromClipBoard=PasteFromClipBoard,patchANI(),aleiSettings.enableTooltips&&doTooltip(),patchServerRequest(),patchUpdateGUIParams(),patchTeamList(),patchRandomizeName(),patchAllowedCharacters(),aleiSettings.blackTheme&&blackTheme(),addProjectileModels(),patchSpecialValue(),UpdateTools(),patchPercentageTool(),patchCompileTrigger(),createClipboardDiv(),addPasteFromPermanentClipboard(),registerClipboardItemAction(),patchClipboardFunctions(),patchDrawGrid(),patchRender(),imageFunctions(),isNative&&(checkForUpdates(),changeTopRightText()),aleiLog(DEBUG2,"Settings: "+JSON.stringify(aleiSettings)),0==aleiSettings.renderObjectName&&ALEI_UpdateNameRenderSetting(!1),NewNote("ALEI: Welcome!","#7777FF"),aleiLog(INFO,"Welcome!"),isNative)aleiLog(INFO,`TamperMonkey Version: ${GM_info.version} ALEI Version: ${GM_info.script.version}`);else{let e="You are running ALEI not under tampermonkey, this is not native ALEI, please load ALEI by tampermonkey when possible.";NewNote(`ALEI: ${e}`,"#FFFF00"),NewNote("ALEI: Check https://github.com/LisABC/ALEI for more details.","#FFFF00"),aleiLog(INFO,e)}};document.addEventListener("DOMContentLoaded",(()=>ALE_start()))})();
//# sourceMappingURL=alei.user.js.map