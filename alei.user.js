// ==UserScript==
// @name ALE Improvements
// @description Changes to make ALE better.
// @version 19.1
// @author mici1234, wanted2001, gcp5o
// @match *://www.plazmaburst2.com/level_editor/map_edit.php*
// @connect github.com
// @connect githubusercontent.com
// @downloadURL https://github.com/LisABC/ALEI/raw/main/alei.user.js
// @grant GM.xmlHttpRequest
// @icon https://github.com/LisABC/ALEI/blob/main/icon.png?raw=true
// @run-at document-start
// @updateURL https://github.com/LisABC/ALEI/raw/main/alei.user.js
// ==/UserScript==

/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/css-loader/dist/cjs.js!./src/static/aleistyles.css":
/*!*************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/static/aleistyles.css ***!
  \*************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/noSourceMaps.js */ \"./node_modules/css-loader/dist/runtime/noSourceMaps.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.ALEI_settingMenuText {\r\n    font-size: 14px;\r\n    width: 150px;\r\n    height: 20px;\r\n    background-color: #476082;\r\n    color: #bfcad9;\r\n    border-radius: 4px;\r\n    text-align: center;\r\n    display: inline-block;\r\n}\r\n\r\n.ALEI_settingsMenuButton {\r\n    background-color: #26354a;\r\n    color: #c1c9d3;\r\n    border-radius: 5px;\r\n    border: 1px solid #26354a;\r\n    width: 80px;\r\n    height: 20px;\r\n    font-size: 14px;\r\n    text-align: center;\r\n    display: inline-block;\r\n    margin-right: 4px;\r\n}\r\n\r\n.ALEI_settingsMenuButton:hover {\r\n    background-color: #596a83;\r\n    color: #f5faff;\r\n}\r\n\r\n.ALEI_settingMenuButtonClicked {\r\n    background-color: #91a5c1;\r\n    color: #fbfbfb;\r\n}\r\n\r\n#ALEI_tooltip {\r\n    font-size: 16px;\r\n    font-family: monospace;\r\n    color: #eee;\r\n    background-color: #000;\r\n    padding: 10px;\r\n    width: fit-content;\r\n    border-radius: 4px;\r\n    word-break: break-all;\r\n    position: absolute;\r\n    left: 100px;\r\n    top: -100px;\r\n}`, \"\"]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n//# sourceURL=webpack://alei/./src/static/aleistyles.css?./node_modules/css-loader/dist/cjs.js");

/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js!./src/static/themes.css":
/*!*********************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/static/themes.css ***!
  \*********************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/noSourceMaps.js */ \"./node_modules/css-loader/dist/runtime/noSourceMaps.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\");\n/* harmony import */ var _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__);\n// Imports\n\n\nvar ___CSS_LOADER_EXPORT___ = _node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1___default()((_node_modules_css_loader_dist_runtime_noSourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default()));\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `/* css variables go in these. */\r\n\r\n:root, .blueTheme {\r\n    --warning-go-away-pls: 0;\r\n}\r\n\r\n.darkTheme, .purpleTheme, .greenTheme {\r\n    --warning-go-away-pls: 0;\r\n}\r\n\r\n/*this is unused cuz theme changing needs to be reworked first*/\r\n.aleidarkTheme {\r\n    --warning-go-away-pls: 0;\r\n}`, \"\"]);\n// Exports\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (___CSS_LOADER_EXPORT___);\n\n\n//# sourceURL=webpack://alei/./src/static/themes.css?./node_modules/css-loader/dist/cjs.js");

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/***/ ((module) => {

eval("\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};\n\n//# sourceURL=webpack://alei/./node_modules/css-loader/dist/runtime/api.js?");

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/noSourceMaps.js":
/*!**************************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/noSourceMaps.js ***!
  \**************************************************************/
/***/ ((module) => {

eval("\n\nmodule.exports = function (i) {\n  return i[1];\n};\n\n//# sourceURL=webpack://alei/./node_modules/css-loader/dist/runtime/noSourceMaps.js?");

/***/ }),

/***/ "./src/static/aleistyles.css":
/*!***********************************!*\
  !*** ./src/static/aleistyles.css ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ \"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/styleDomAPI.js */ \"./node_modules/style-loader/dist/runtime/styleDomAPI.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/insertBySelector.js */ \"./node_modules/style-loader/dist/runtime/insertBySelector.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js */ \"./node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/insertStyleElement.js */ \"./node_modules/style-loader/dist/runtime/insertStyleElement.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/styleTagTransform.js */ \"./node_modules/style-loader/dist/runtime/styleTagTransform.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _node_modules_css_loader_dist_cjs_js_aleistyles_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../../node_modules/css-loader/dist/cjs.js!./aleistyles.css */ \"./node_modules/css-loader/dist/cjs.js!./src/static/aleistyles.css\");\n\n      \n      \n      \n      \n      \n      \n      \n      \n      \n\nvar options = {\"attributes\":{\"title\":\"style-from-webpack\"}};\n\noptions.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());\noptions.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3___default());\noptions.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, \"head\");\noptions.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());\noptions.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());\n\nvar update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_aleistyles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"], options);\n\n\n\n\n       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_aleistyles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"] && _node_modules_css_loader_dist_cjs_js_aleistyles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals ? _node_modules_css_loader_dist_cjs_js_aleistyles_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals : undefined);\n\n\n//# sourceURL=webpack://alei/./src/static/aleistyles.css?");

/***/ }),

/***/ "./src/static/themes.css":
/*!*******************************!*\
  !*** ./src/static/themes.css ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js */ \"./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/styleDomAPI.js */ \"./node_modules/style-loader/dist/runtime/styleDomAPI.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/insertBySelector.js */ \"./node_modules/style-loader/dist/runtime/insertBySelector.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js */ \"./node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/insertStyleElement.js */ \"./node_modules/style-loader/dist/runtime/insertStyleElement.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! !../../node_modules/style-loader/dist/runtime/styleTagTransform.js */ \"./node_modules/style-loader/dist/runtime/styleTagTransform.js\");\n/* harmony import */ var _node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var _node_modules_css_loader_dist_cjs_js_themes_css__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! !!../../node_modules/css-loader/dist/cjs.js!./themes.css */ \"./node_modules/css-loader/dist/cjs.js!./src/static/themes.css\");\n\n      \n      \n      \n      \n      \n      \n      \n      \n      \n\nvar options = {\"attributes\":{\"title\":\"style-from-webpack\"}};\n\noptions.styleTagTransform = (_node_modules_style_loader_dist_runtime_styleTagTransform_js__WEBPACK_IMPORTED_MODULE_5___default());\noptions.setAttributes = (_node_modules_style_loader_dist_runtime_setAttributesWithAttributesAndNonce_js__WEBPACK_IMPORTED_MODULE_3___default());\noptions.insert = _node_modules_style_loader_dist_runtime_insertBySelector_js__WEBPACK_IMPORTED_MODULE_2___default().bind(null, \"head\");\noptions.domAPI = (_node_modules_style_loader_dist_runtime_styleDomAPI_js__WEBPACK_IMPORTED_MODULE_1___default());\noptions.insertStyleElement = (_node_modules_style_loader_dist_runtime_insertStyleElement_js__WEBPACK_IMPORTED_MODULE_4___default());\n\nvar update = _node_modules_style_loader_dist_runtime_injectStylesIntoStyleTag_js__WEBPACK_IMPORTED_MODULE_0___default()(_node_modules_css_loader_dist_cjs_js_themes_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"], options);\n\n\n\n\n       /* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_node_modules_css_loader_dist_cjs_js_themes_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"] && _node_modules_css_loader_dist_cjs_js_themes_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals ? _node_modules_css_loader_dist_cjs_js_themes_css__WEBPACK_IMPORTED_MODULE_6__[\"default\"].locals : undefined);\n\n\n//# sourceURL=webpack://alei/./src/static/themes.css?");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js":
/*!****************************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js ***!
  \****************************************************************************/
/***/ ((module) => {

eval("\n\nvar stylesInDOM = [];\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n  for (var i = 0; i < stylesInDOM.length; i++) {\n    if (stylesInDOM[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n  return result;\n}\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var indexByIdentifier = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3],\n      supports: item[4],\n      layer: item[5]\n    };\n    if (indexByIdentifier !== -1) {\n      stylesInDOM[indexByIdentifier].references++;\n      stylesInDOM[indexByIdentifier].updater(obj);\n    } else {\n      var updater = addElementStyle(obj, options);\n      options.byIndex = i;\n      stylesInDOM.splice(i, 0, {\n        identifier: identifier,\n        updater: updater,\n        references: 1\n      });\n    }\n    identifiers.push(identifier);\n  }\n  return identifiers;\n}\nfunction addElementStyle(obj, options) {\n  var api = options.domAPI(options);\n  api.update(obj);\n  var updater = function updater(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap && newObj.supports === obj.supports && newObj.layer === obj.layer) {\n        return;\n      }\n      api.update(obj = newObj);\n    } else {\n      api.remove();\n    }\n  };\n  return updater;\n}\nmodule.exports = function (list, options) {\n  options = options || {};\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDOM[index].references--;\n    }\n    var newLastIdentifiers = modulesToDom(newList, options);\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n      var _index = getIndexByIdentifier(_identifier);\n      if (stylesInDOM[_index].references === 0) {\n        stylesInDOM[_index].updater();\n        stylesInDOM.splice(_index, 1);\n      }\n    }\n    lastIdentifiers = newLastIdentifiers;\n  };\n};\n\n//# sourceURL=webpack://alei/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js?");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/insertBySelector.js":
/*!********************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/insertBySelector.js ***!
  \********************************************************************/
/***/ ((module) => {

eval("\n\nvar memo = {};\n\n/* istanbul ignore next  */\nfunction getTarget(target) {\n  if (typeof memo[target] === \"undefined\") {\n    var styleTarget = document.querySelector(target);\n\n    // Special case to return head of iframe instead of iframe itself\n    if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n      try {\n        // This will throw an exception if access to iframe is blocked\n        // due to cross-origin restrictions\n        styleTarget = styleTarget.contentDocument.head;\n      } catch (e) {\n        // istanbul ignore next\n        styleTarget = null;\n      }\n    }\n    memo[target] = styleTarget;\n  }\n  return memo[target];\n}\n\n/* istanbul ignore next  */\nfunction insertBySelector(insert, style) {\n  var target = getTarget(insert);\n  if (!target) {\n    throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n  }\n  target.appendChild(style);\n}\nmodule.exports = insertBySelector;\n\n//# sourceURL=webpack://alei/./node_modules/style-loader/dist/runtime/insertBySelector.js?");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/insertStyleElement.js":
/*!**********************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/insertStyleElement.js ***!
  \**********************************************************************/
/***/ ((module) => {

eval("\n\n/* istanbul ignore next  */\nfunction insertStyleElement(options) {\n  var element = document.createElement(\"style\");\n  options.setAttributes(element, options.attributes);\n  options.insert(element, options.options);\n  return element;\n}\nmodule.exports = insertStyleElement;\n\n//# sourceURL=webpack://alei/./node_modules/style-loader/dist/runtime/insertStyleElement.js?");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js":
/*!***************************************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js ***!
  \***************************************************************************************/
/***/ ((module) => {

eval("\n\n/* istanbul ignore next  */\nfunction setAttributesWithoutAttributes(styleElement, attributes) {\n  Object.keys(attributes).forEach(function (key) {\n    styleElement.setAttribute(key, attributes[key]);\n  });\n}\nmodule.exports = setAttributesWithoutAttributes;\n\n//# sourceURL=webpack://alei/./node_modules/style-loader/dist/runtime/setAttributesWithAttributesAndNonce.js?");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/styleDomAPI.js":
/*!***************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/styleDomAPI.js ***!
  \***************************************************************/
/***/ ((module) => {

eval("\n\n/* istanbul ignore next  */\nfunction apply(styleElement, options, obj) {\n  var css = \"\";\n  if (obj.supports) {\n    css += \"@supports (\".concat(obj.supports, \") {\");\n  }\n  if (obj.media) {\n    css += \"@media \".concat(obj.media, \" {\");\n  }\n  var needLayer = typeof obj.layer !== \"undefined\";\n  if (needLayer) {\n    css += \"@layer\".concat(obj.layer.length > 0 ? \" \".concat(obj.layer) : \"\", \" {\");\n  }\n  css += obj.css;\n  if (needLayer) {\n    css += \"}\";\n  }\n  if (obj.media) {\n    css += \"}\";\n  }\n  if (obj.supports) {\n    css += \"}\";\n  }\n  var sourceMap = obj.sourceMap;\n  if (sourceMap && typeof btoa !== \"undefined\") {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  }\n\n  // For old IE\n  /* istanbul ignore if  */\n  options.styleTagTransform(css, styleElement, options.options);\n}\nfunction removeStyleElement(styleElement) {\n  // istanbul ignore if\n  if (styleElement.parentNode === null) {\n    return false;\n  }\n  styleElement.parentNode.removeChild(styleElement);\n}\n\n/* istanbul ignore next  */\nfunction domAPI(options) {\n  if (typeof document === \"undefined\") {\n    return {\n      update: function update() {},\n      remove: function remove() {}\n    };\n  }\n  var styleElement = options.insertStyleElement(options);\n  return {\n    update: function update(obj) {\n      apply(styleElement, options, obj);\n    },\n    remove: function remove() {\n      removeStyleElement(styleElement);\n    }\n  };\n}\nmodule.exports = domAPI;\n\n//# sourceURL=webpack://alei/./node_modules/style-loader/dist/runtime/styleDomAPI.js?");

/***/ }),

/***/ "./node_modules/style-loader/dist/runtime/styleTagTransform.js":
/*!*********************************************************************!*\
  !*** ./node_modules/style-loader/dist/runtime/styleTagTransform.js ***!
  \*********************************************************************/
/***/ ((module) => {

eval("\n\n/* istanbul ignore next  */\nfunction styleTagTransform(css, styleElement) {\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css;\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild);\n    }\n    styleElement.appendChild(document.createTextNode(css));\n  }\n}\nmodule.exports = styleTagTransform;\n\n//# sourceURL=webpack://alei/./node_modules/style-loader/dist/runtime/styleTagTransform.js?");

/***/ }),

/***/ "./src/alescript.js":
/*!**************************!*\
  !*** ./src/alescript.js ***!
  \**************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parse: () => (/* binding */ parse)\n/* harmony export */ });\nfunction isNumber(str) {\r\n    let number = 0;\r\n\r\n    if ((!isNaN(Number(str)) && str !== \" \") || str == \".\") {\r\n        number = 1;\r\n    }\r\n\r\n    return number;\r\n}\r\n\r\nfunction isOperator(str) {\r\n    return \"+-*/%^SCANRF\".includes(str);\r\n}\r\n\r\nfunction isGroup(str) {\r\n    return \"()\".includes(str);\r\n}\r\n\r\nfunction split(str) {\r\n    return str.replaceAll(\" \", \"\").split(\"\");\r\n}\r\n\r\nfunction concatNumbers(str) {\r\n    let num = \"\";\r\n\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (isNumber(str[i])) {\r\n            num += str[i];\r\n        } else if (num.length != 0) {\r\n            str.splice(i - num.length, num.length, num);\r\n            i -= (num.length - 1);\r\n            num = \"\";\r\n        }\r\n    }\r\n\r\n    if (num.length != 0) {\r\n        str.splice(str.length - num.length, num.length, num);\r\n    }\r\n}\r\n\r\nfunction convertToObjects(str) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        str[i] = {\r\n            chr: str[i]\r\n        }\r\n    }\r\n}\r\n\r\nfunction createGroupOrders(str) {\r\n    let order = 1;\r\n\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (str[i].chr == \"(\") {\r\n            order++;\r\n        }\r\n\r\n        if (str[i].chr == \")\") {\r\n            order--;\r\n        }\r\n\r\n        str[i].groupOrder = order;\r\n    }\r\n}\r\n\r\nfunction removeGroupChars(str) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (isGroup(str[i].chr)) {\r\n            str.splice(i, 1);\r\n            i--;\r\n        }\r\n    }\r\n}\r\n\r\nfunction operatorOrder(str) {\r\n    let order = 0;\r\n\r\n    if (\"+-\".includes(str)) {\r\n        order = 1;\r\n    }\r\n\r\n    if (\"*/%\".includes(str)) {\r\n        order = 2;\r\n    }\r\n\r\n    if (\"^SCANRF\".includes(str)) {\r\n        order = 3;\r\n    }\r\n\r\n    return order;\r\n}\r\n\r\nfunction createOperatorOrders(str) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (isOperator(str[i].chr)) {\r\n            let order = operatorOrder(str[i].chr);\r\n\r\n            str[i].operatorOrder = order;\r\n\r\n            if (str[i + 1].groupOrder == str[i].groupOrder) {\r\n                str[i + 1].operatorOrder = order;\r\n            }\r\n\r\n            if (!str[i - 1].operatorOrder || (str[i - 1].operatorOrder < str[i].operatorOrder && str[i - 1].groupOrder == str[i].groupOrder)) {\r\n                str[i - 1].operatorOrder = order;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction createOrders(str) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        str[i].order = str[i].groupOrder * 10 + str[i].operatorOrder;\r\n    }\r\n}\r\n\r\nfunction getOrders(str) {\r\n    let orders = [];\r\n\r\n    for (let i = 0; i < str.length; i++) {\r\n        orders.push(str[i].order);\r\n    }\r\n\r\n    return orders;\r\n}\r\n\r\nfunction simplifyOrders(orders) {\r\n    let arr = [];\r\n    let order = 1;\r\n\r\n    orders.sort((x, y) => {\r\n        return y - x;\r\n    });\r\n\r\n    arr.push({\r\n        from: orders[0],\r\n        to: order\r\n    });\r\n\r\n    for (let i = 1; i < orders.length; i++) {\r\n        if (orders[i] != orders[i - 1]) {\r\n            order++;\r\n        }\r\n\r\n        arr.push({\r\n            from: orders[i],\r\n            to: order\r\n        });\r\n    }\r\n\r\n    return arr;\r\n}\r\n\r\nfunction replaceOrders(str) {\r\n    let orders = getOrders(str);\r\n    let arr = simplifyOrders(orders);\r\n\r\n    for (let i = 0; i < str.length; i++) {\r\n        for (let j = 0; j < arr.length; j++) {\r\n            if (str[i].order == arr[j].from) {\r\n                str[i].order = arr[j].to;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction calc(x, y, z) {\r\n    let result;\r\n\r\n    x = Number(x);\r\n    z = Number(z);\r\n\r\n    if (y == \"+\") {\r\n        result = x + z;\r\n    }\r\n\r\n    if (y == \"-\") {\r\n        result = x - z;\r\n    }\r\n\r\n    if (y == \"*\") {\r\n        result = x * z;\r\n    }\r\n\r\n    if (y == \"/\") {\r\n        result = x / z;\r\n    }\r\n\r\n    if (y == \"%\") {\r\n        result = x % z;\r\n    }\r\n\r\n    if (y == \"^\") {\r\n        result = x ** z;\r\n    }\r\n\r\n    if (y == \"S\") {\r\n        result = Math.sin(x) * z;\r\n    }\r\n\r\n    if (y == \"C\") {\r\n        result = Math.cos(x) * z;\r\n    }\r\n\r\n    if (y == \"A\") {\r\n        result = Math.atan2(x, z);\r\n    }\r\n\r\n    if (y == \"N\") {\r\n        if (z) {\r\n            result = Math.floor(Math.random() * x);\r\n        } else {\r\n            result = Math.random() * x;\r\n        }\r\n    }\r\n\r\n    if (y == \"R\") {\r\n        result = Math.round(x / z) * z;\r\n    }\r\n\r\n    if (y == \"F\") {\r\n        result = Math.floor(x / z) * z;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction getMaxOrder(str) {\r\n    let order = 0;\r\n\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (str[i].order > order) {\r\n            order = str[i].order;\r\n        }\r\n    }\r\n\r\n    return order;\r\n}\r\n\r\nfunction exec(str) {\r\n    let maxOrder = getMaxOrder(str);\r\n\r\n    for (let order = 1; order <= maxOrder; order++) {\r\n        let i = 0;\r\n        let loop = 1;\r\n\r\n        while (loop) {\r\n            loop = 0;\r\n\r\n            let newstr = [];\r\n            let length;\r\n            let saveOrder;\r\n            let index = -1;\r\n\r\n            for (; i < str.length; i++) {\r\n                if (str[i].order == order) {\r\n                    newstr.push(str[i]);\r\n\r\n                    if (index == -1) {\r\n                        index = i;\r\n                    }\r\n                } else if (newstr.length != 0) {\r\n                    loop = 1;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            length = newstr.length;\r\n\r\n            if (length) {\r\n                while (newstr.length != 1) {\r\n                    newstr.splice(0, 3, {\r\n                        chr: calc(newstr[0].chr, newstr[1].chr, newstr[2].chr)\r\n                    });\r\n                }\r\n\r\n                saveOrder = str[index].order;\r\n\r\n                str.splice(index, length, newstr[0]);\r\n                i -= (length - 1);\r\n\r\n                str[index] = {\r\n                    chr: str[index].chr,\r\n                    order: saveOrder + 1\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction replace(str, arr) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        for (let j = 0; j < arr.length; j++) {\r\n            if (str[i] == arr[j].from) {\r\n                str[i] = arr[j].to;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction negativeNumbers(str) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (str[i] == \"-\" && str[i - 1] == \"(\") {\r\n            str.splice(i, 0, \"0\");\r\n        }\r\n    }\r\n}\r\n\r\nfunction simpleGroups(str) {\r\n    for (let i = 0; i < str.length; i++) {\r\n        if (str[i - 1] == \"(\" && str[i + 1] == \")\") {\r\n            str.splice(i, 0, \"0\", \"+\");\r\n        }\r\n    }\r\n}\r\n\r\nfunction parse(str, vars) {\r\n    if (str == \"\") {\r\n        str = \"0\";\r\n    }\r\n\r\n    if (str[0] == \"-\") {\r\n        str = \"0\" + str;\r\n    }\r\n\r\n    str = split(str);\r\n    concatNumbers(str);\r\n\r\n    replace(str, [\r\n        {\r\n            from: \"p\",\r\n            to: String(Math.PI)\r\n        },\r\n\r\n        {\r\n            from: \"x\",\r\n            to: String(vars[0])\r\n        },\r\n\r\n        {\r\n            from: \"y\",\r\n            to: String(vars[1])\r\n        },\r\n\r\n        {\r\n            from: \"w\",\r\n            to: String(vars[2])\r\n        },\r\n\r\n        {\r\n            from: \"h\",\r\n            to: String(vars[3])\r\n        },\r\n\r\n        {\r\n            from: \"i\",\r\n            to: String(vars[4])\r\n        }\r\n    ]);\r\n\r\n    try {\r\n        negativeNumbers(str);\r\n        simpleGroups(str);\r\n        convertToObjects(str);\r\n        createGroupOrders(str);\r\n        removeGroupChars(str);\r\n        createOperatorOrders(str);\r\n        createOrders(str);\r\n        replaceOrders(str);\r\n        exec(str);\r\n    } catch {\r\n        return \"error\";\r\n    }\r\n\r\n    return Number(Number(str[0].chr).toFixed(10));\r\n}\n\n//# sourceURL=webpack://alei/./src/alescript.js?");

/***/ }),

/***/ "./src/loadcss.js":
/*!************************!*\
  !*** ./src/loadcss.js ***!
  \************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fixWebpackStyleSheets: () => (/* binding */ fixWebpackStyleSheets),\n/* harmony export */   patchThemeSet: () => (/* binding */ patchThemeSet)\n/* harmony export */ });\n/* harmony import */ var _static_aleistyles_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./static/aleistyles.css */ \"./src/static/aleistyles.css\");\n/* harmony import */ var _static_themes_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./static/themes.css */ \"./src/static/themes.css\");\n\r\n\r\n\r\n/*\r\nfor some reason the vanilla ThemeSet function does this:\r\n\"\r\nfor (var i = 1; i < document.styleSheets.length - 1; i++)\r\n    document.styleSheets[i].disabled = true;\r\n\"\r\nI have no idea why that exists but it breaks webpack's stylesheets because they get disabled.\r\nfixWebpackStyleSheets fixes that.\r\n*/\r\n\r\nconst webpackStylesheetName = \"style-from-webpack\";\r\n\r\nconst themes = {\r\n    0: \"blueTheme\",\r\n    1: \"darkTheme\",\r\n    2: \"purpleTheme\",\r\n    3: \"greenTheme\",\r\n    4: \"aleidarkTheme\",\r\n}\r\n\r\nfunction patchThemeSet() {\r\n    const origThemeSet = unsafeWindow.ThemeSet;\r\n\r\n    unsafeWindow.ThemeSet = function(value) {\r\n        const oldTheme = themes[THEME];\r\n        const newTheme = themes[value];\r\n        document.body.classList.remove(oldTheme);\r\n        document.body.classList.add(newTheme);\r\n        //console.log(\"changed theme: \" + oldTheme + \" -> \" + newTheme);\r\n\r\n        origThemeSet(value);\r\n    }\r\n}\r\n\r\nfunction fixWebpackStyleSheets() {\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n        if (document.styleSheets[i].title == webpackStylesheetName) {\r\n            document.styleSheets[i].disabled = false;\r\n        }\r\n    }\r\n    fixBullshitInThemeSet();\r\n}\r\n\r\nfunction fixBullshitInThemeSet() {\r\n    let oldCodeSnippet = \"document.styleSheets[ i ].disabled = \\ntrue;\";\r\n    let newCodeSnippet = `if (document.styleSheets[i].title != \"${webpackStylesheetName}\") { ` + \r\n                            \"document.styleSheets[i].disabled = true; \" + \r\n                         \"}\";\r\n    let code = unsafeWindow.ThemeSet.toString().replace(oldCodeSnippet, newCodeSnippet);\r\n    code = \"(\" + code + \")\";\r\n    unsafeWindow.ThemeSet = eval(code);\r\n}\n\n//# sourceURL=webpack://alei/./src/loadcss.js?");

/***/ }),

/***/ "./src/main.js":
/*!*********************!*\
  !*** ./src/main.js ***!
  \*********************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _loadcss_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./loadcss.js */ \"./src/loadcss.js\");\n/* harmony import */ var _alescript_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./alescript.js */ \"./src/alescript.js\");\n\r\n\r\n\r\n\"use strict\";\r\n\r\nlet window = unsafeWindow;\r\nlet isNative;\r\ntry {\r\n    GM_info\r\n    isNative = true;\r\n    window[\"nativeALEIRunning\"] = true;\r\n} catch (e) {\r\n    isNative = false\r\n};\r\n\r\nif(!isNative && (window[\"nativeALEIRunning\"] == true)) {\r\n    Hello_IgnoreThisError_ItIsIntentional // hope this is not defined\r\n}\r\nwindow[\"ALEI_Active\"] = true;\r\n\r\n// Shorthand things\r\nfunction $id(id) {\r\n    return document.getElementById(id);\r\n}\r\nfunction $query(selector) {\r\n    return document.querySelector(selector);\r\n}\r\n\r\nlet ROOT_ELEMENT = document.documentElement;\r\nlet stylesheets = document.styleSheets;\r\nlet VAL_TABLE = {}; // Will be filled later.\r\nlet displayOperationCompleteNotes = true;\r\nlet REGION_EXECUTE_PARAM_ID; // Will be set later.\r\nlet OCM_LOADED = true; // Assume empty map.\r\nlet ExtendedTriggersLoaded = false;\r\n\r\nconst INFO = 0;\r\nconst DEBUG = 1;\r\nconst DEBUG2 = 2;\r\nconst VERBOSE = DEBUG2; // Alias.\r\nconst WARN = -1;\r\nconst SWARN = -2;\r\nconst __OCM_CHECKED_KEYS = [\"target\", \"attach\", \"use_target\", \"incar\", \"ondeath\", \"callback\"]; // OCM = Object Connection Mapping\r\n\r\n// Just for styling.\r\nconst ANSI_RESET = \"\\x1B[0m\"\r\nconst ANSI_RED = \"\\x1B[31m\"\r\nconst ANSI_GREY = \"\\x1B[37m\"\r\nconst ANSI_YELLOW = \"\\x1B[93m\"\r\nconst ANSI_GREEN = \"\\x1B[92m\"\r\nconst ANSI_CYAN = \"\\x1B[96m\"\r\n\r\nfunction readStorage(key, defaultValue, func) {\r\n    let val = localStorage[key];\r\n    if (val === undefined) return defaultValue;\r\n    return func(localStorage[key])\r\n}\r\n\r\nif (localStorage['RIGHT_PANEL_WIDTH'] != undefined) {\r\n    localStorage[\"ALEI_RightPanelWidth\"] = localStorage[\"RIGHT_PANEL_WIDTH\"];\r\n    localStorage.removeItem(\"RIGHT_PANEL_WIDTH\");\r\n}\r\n\r\nlet aleiSettings = {\r\n    rightPanelSize:     readStorage(\"ALEI_RightPanelWidth\",         \"30vw\",  (val) => val         ),\r\n    triggerEditTextSize:readStorage(\"ALEI_EditTextSize\",            \"12px\",  (val) => val + \"px\"  ),\r\n    starsImage:         readStorage(\"ALEI_StarImage\",               \"stars2.jpg\", (val) => val    ),\r\n    logLevel:           readStorage(\"ALEI_LogLevel\",                0,     parseInt               ),\r\n    showTriggerIDs:     readStorage(\"ALEI_ShowTriggerIDs\",          false, (val) => val === \"true\"),\r\n    enableTooltips:     readStorage(\"ALEI_ShowTooltips\",            false, (val) => val === \"true\"),\r\n    showSameParameters: readStorage(\"ALEI_ShowSameParameters\",      true , (val) => val === \"true\"),\r\n    rematchUID:         readStorage(\"ALEI_RemapUID\",                false, (val) => val === \"true\"),\r\n    //showIDs:            readStorage(\"ALEI_ShowIDs\",               false, (val) => val === \"true\"),\r\n    blackTheme:         readStorage(\"ALEI_BlackTheme\",              false, (val) => val === \"true\"),\r\n    gridBasedOnSnapping:readStorage(\"ALEI_gridBasedOnSnapping\",     true,  (val) => val === \"true\"),\r\n    //showZIndex:         readStorage(\"ALEI_ShowZIndex\",              false, (val) => val === \"true\"),\r\n    renderObjectNames:  readStorage(\"ALEI_RenderObjectNames\",       true,  (val) => val === \"true\"),\r\n    //ocmEnabled:         readStorage(\"ALEI_OCMEnabled\",              false, (val) => val === \"true\"),\r\n    ocmEnabled:         true,\r\n    extendedTriggers:   readStorage(\"ALEI_ExtendedTriggersEnabled\", true,  (val) => val === \"true\"),\r\n    customRenderer:     readStorage(\"ALEI_Renderer_Enabled\",        true,  (val) => val === \"true\"),\r\n    orderedNaming:      readStorage(\"ALEI_orderedNaming\",           true,  (val) => val === \"true\")\r\n}\r\nwindow.aleiSettings = aleiSettings;\r\n\r\nfunction writeStorage(key, value) {\r\n    try {\r\n        localStorage[key] = value;\r\n    } catch (e) {\r\n        NewNote(\"ALEI: There was some issue trying to save into storage. You might need to clear your datas.\", note_bad);\r\n        console.error(e);\r\n    }\r\n}\r\n\r\nlet levelToNameMap = {\r\n    0: `${ANSI_CYAN}INFO${ANSI_RESET}`,\r\n    1: `${ANSI_GREEN}DEBUG${ANSI_RESET}`,\r\n    2: `${ANSI_GREEN}VERBOSE${ANSI_RESET}`\r\n}\r\n\r\nfunction aleiLog(level, text) {\r\n    if (level <= WARN) {\r\n        console.warn(`[ALEI:WARNING]: ${text}`);\r\n        if(level === WARN) NewNote(`ALEI: Please check console.`, \"#FFFF00\");\r\n    }else if (level <= aleiSettings.logLevel)\r\n        console.log(`[${ANSI_GREEN}ALEI:${levelToNameMap[level]}]: ${text}`)\r\n}\r\naleiLog(INFO, \"Starting up...\");\r\n\r\n// Original functions, globally saved here if needed\r\n// JS_ prefix for JavaScript ones, ALE_ for ALE ones\r\nlet JS_setTimeout = window.setTimeout;\r\nlet JS_eval = window.eval;\r\nlet ALE_Render;\r\n\r\nlet aleiSessionID = null; // ID of this session\r\nlet aleiSessionList = []; // Set of known session IDs\r\n\r\nfunction updateParameters() {\r\n    // Does things to parameters depending on purpose.\r\n    function add(key, type, name, objType) {\r\n        param_type[param_type.length] = [key, type, name, \"\", objType];\r\n    }\r\n    // Adding parameters that the game accepts but ALE does not have.\r\n    add(\"moving\", \"bool\", \"Is Moving?\", \"door\");\r\n    add(\"tarx\", \"value\", \"Target X\", \"door\");\r\n    add(\"tary\", \"value\", \"Target Y\", \"door\");\r\n    // Adding our own parameter.\r\n    add(\"__id\", \"value\", \"Object ID\", \"*\");\r\n    add(\"__priority\", \"value\", \"Object priority\", \"*\");\r\n    add(\"execute\", \"bool\", \"Executes directly?\", \"trigger\");\r\n    add(\"uses_timer\", \"bool\", \"Calls timer?\", \"region\");\r\n    add(\"text\", \"string\", \"Placeholder text\", \"decor\");\r\n    add(\"attach\", \"door+none\", \"Attach to\", \"water\");\r\n\r\n    // add(\"extended\", \"bool\", \"Extended?\", \"trigger\");\r\n    // add(\"totalNumOfActions\", \"value\", \"Total No. Of Actions: \", \"trigger\");\r\n    // add(\"nextTrigger\", \"trigger+none\", \"Next trigger\", \"trigger\");\r\n\r\n    // Patching parameters\r\n    param_type[0] = ['uid', 'string', 'Name', 'Object Name', '*'];\r\n\r\n    // Setting global variables for future use\r\n    for(let i = 0; i < param_type.length; i++) {\r\n        let param = param_type[i];\r\n        let key = param[0];\r\n        let selector = param[4];\r\n\r\n        if((key == \"use_target\") && (selector == \"region\")) {\r\n            REGION_EXECUTE_PARAM_ID = i;\r\n            continue;\r\n        }\r\n        if([\"w\", \"h\"].indexOf(key) != -1) { // Enables height and width parameters to be able to have negative height and width.\r\n            param_type[i][1] = \"value+round10\";\r\n            continue;\r\n        }\r\n    }\r\n    VAL_TABLE[\"timer+none\"] = new Array();\r\n    VAL_TABLE[\"timer+none\"][-1] = \"- No timer -\";\r\n    VAL_TABLE[\"timer+none\"][\"[listof]\"] = \"timer\"; // Somebody save me.\r\n}\r\n\r\nfunction updateSounds() {\r\n    // Adds sounds that exist in game but not in ALE\r\n    let SVTS = VAL_TABLE[\"sound\"];\r\n    SVTS['am_base'] = 'Indoor Ambience';\r\n    SVTS['am_wind'] = 'Outdoor Ambience';\r\n    SVTS['android2_die'] = 'DT-148 - Death';\r\n    SVTS['android2_hurt'] = 'DT-148 - Hurt';\r\n    SVTS['android2_welcome2'] = 'DT-148 - Alerted';\r\n    SVTS['arrin_death1'] = 'Arrin - Death';\r\n    SVTS['arrin_dying'] = 'Arrin - Dying';\r\n    SVTS['arrin_hurt1'] = 'Arrin - Hurt 1';\r\n    SVTS['arrin_hurt2'] = 'Arrin - Hurt 2';\r\n    SVTS['arrin_welcome1'] = 'Arrin - Alerted 1';\r\n    SVTS['arrin_welcome2'] = 'Arrin - Alerted 2';\r\n    SVTS['arrin_welcome3'] = 'Arrin - Alerted 3';\r\n    SVTS['bounce_bullet'] = 'Falkonian PSI Cutter - Shot Bounce';\r\n    SVTS['dart4'] = 'Medic Pistol';\r\n    SVTS['exp_event_stop'] = 'EXP - Stop';\r\n    SVTS['exp_level'] = 'EXP - Level Up';\r\n    SVTS['exp_tick'] = 'EXP - Gain';\r\n    SVTS['gameplay_song'] = 'Katharsys - Erges';\r\n    SVTS['gravitator2'] = 'Floor gravitator noice';\r\n    SVTS['helm_proxy_alert_over_hereB'] = 'Proxy - Over here!';\r\n    SVTS['helm_proxy_alert_take_coverB'] = 'Proxy - Take cover!';\r\n    SVTS['helm_proxy_alert_up_thereA'] = 'Proxy - Up there!';\r\n    SVTS['helm_proxy_death3'] = 'Proxy - Death 1';\r\n    SVTS['helm_proxy_death4'] = 'Proxy - Death 2';\r\n    SVTS['helm_proxy_death5'] = 'Proxy - Death 3';\r\n    SVTS['helm_proxy_death6'] = 'Proxy - Death 4';\r\n    SVTS['helm_proxy_dyingC'] = 'Proxy - Help! 1';\r\n    SVTS['helm_proxy_dyingF'] = 'Proxy - Help! 2';\r\n    SVTS['helm_proxy_enemy_down_fantasticA'] = 'Proxy - Fantastic.';\r\n    SVTS['helm_proxy_enemy_down_got_oneD'] = 'Proxy - Got one.';\r\n    SVTS['helm_proxy_enemy_down_niceA'] = 'Proxy - Nice. 1';\r\n    SVTS['helm_proxy_enemy_down_niceC'] = 'Proxy - Nice. 2';\r\n    SVTS['helm_proxy_hurt11'] = 'Proxy - Hurt 1';\r\n    SVTS['helm_proxy_hurt12'] = 'Proxy - Hurt 2';\r\n    SVTS['helm_proxy_hurt13'] = 'Proxy - Hurt 3';\r\n    SVTS['helm_proxy_hurt14'] = 'Proxy - Hurt 4';\r\n    SVTS['helm_proxy_hurt15'] = 'Proxy - Hurt 5';\r\n    SVTS['helm_proxy_hurt17'] = 'Proxy - Hurt 6';\r\n    SVTS['helm_proxy_hurt4'] = 'Proxy - Hurt 7';\r\n    SVTS['helm_proxy_hurt5'] = 'Proxy - Hurt 8';\r\n    SVTS['helm_proxy_hurt8'] = 'Proxy - Hurt 9';\r\n    SVTS['helm_proxy_hurt9'] = 'Proxy - Hurt 10';\r\n    SVTS['hexagon_death1'] = 'Hexagon - Death 1';\r\n    SVTS['hexagon_death2'] = 'Hexagon - Death 2';\r\n    SVTS['hexagon_pain1'] = 'Hexagon - Hurt 1';\r\n    SVTS['hexagon_pain2'] = 'Hexagon - Hurt 2';\r\n    SVTS['hexagon_pain3'] = 'Hexagon - Hurt 3';\r\n    SVTS['hexagon_pain4'] = 'Hexagon - Hurt 4';\r\n    SVTS['hexagon_welcome1'] = 'Hexagon - Alerted 1';\r\n    SVTS['hexagon_welcome2'] = 'Hexagon - Alerted 2';\r\n    SVTS['hexagon_welcome3'] = 'Hexagon - Alerted 3';\r\n    SVTS['main_song'] = 'NPhonix - Antigravity';\r\n    SVTS['orakin_death1'] = 'Orakin - Death 1';\r\n    SVTS['orakin_death2'] = 'Orakin - Death 2';\r\n    SVTS['orakin_hurt'] = 'Orakin - Hurt';\r\n    SVTS['orakin_welcome'] = 'Orakin - Alerted';\r\n    SVTS['proxy_alert_over_hereB'] = 'No Helm Proxy - Over here!';\r\n    SVTS['proxy_alert_take_coverB'] = 'No Helm Proxy - Take cover!';\r\n    SVTS['proxy_alert_up_thereA'] = 'No Helm Proxy - Up there!';\r\n    SVTS['proxy_death3'] = 'No Helm Proxy - Death 1';\r\n    SVTS['proxy_death4'] = 'No Helm Proxy - Death 2';\r\n    SVTS['proxy_death5'] = 'No Helm Proxy - Death 3';\r\n    SVTS['proxy_death6'] = 'No Helm Proxy - Death 4';\r\n    SVTS['proxy_dyingC'] = 'No Helm Proxy - Help! 1';\r\n    SVTS['proxy_dyingF'] = 'No Helm Proxy - Help! 2 ';\r\n    SVTS['proxy_enemy_down_fantasticA'] = 'No Helm Proxy - Fantastic.';\r\n    SVTS['proxy_enemy_down_got_oneD'] = 'No Helm Proxy - Got one.';\r\n    SVTS['proxy_enemy_down_niceA'] = 'No Helm Proxy - Nice. 1';\r\n    SVTS['proxy_enemy_down_niceC'] = 'No Helm Proxy - Nice. 2';\r\n    SVTS['proxy_hurt11'] = 'No Helm Proxy - Hurt 1';\r\n    SVTS['proxy_hurt12'] = 'No Helm Proxy - Hurt 2';\r\n    SVTS['proxy_hurt13'] = 'No Helm Proxy - Hurt 3';\r\n    SVTS['proxy_hurt14'] = 'No Helm Proxy - Hurt 4';\r\n    SVTS['proxy_hurt15'] = 'No Helm Proxy - Hurt 5';\r\n    SVTS['proxy_hurt17'] = 'No Helm Proxy - Hurt 6';\r\n    SVTS['proxy_hurt4'] = 'No Helm Proxy - Hurt 7';\r\n    SVTS['proxy_hurt5'] = 'No Helm Proxy - Hurt 8';\r\n    SVTS['proxy_hurt8'] = 'No Helm Proxy - Hurt 9';\r\n    SVTS['proxy_hurt9'] = 'No Helm Proxy - Hurt 10';\r\n    SVTS['silk_alert_contactA'] = 'Silk - Contact!';\r\n    SVTS['silk_alert_i_see_oneA'] = 'Silk - I see one.';\r\n    SVTS['silk_alert_there_is_oneA'] = 'Silk - There is one...!';\r\n    SVTS['silk_death1B'] = 'Silk - Death 1';\r\n    SVTS['silk_death2B'] = 'Silk - Death 2';\r\n    SVTS['silk_dyingB'] = 'Silk - Not good...';\r\n    SVTS['silk_enemy_down_brilliantC'] = 'Silk - Brilliant.';\r\n    SVTS['silk_enemy_down_eliminatedB'] = 'Silk - Eliminated.';\r\n    SVTS['silk_enemy_down_hell_yeahB'] = 'Silk - Hell yeah!';\r\n    SVTS['silk_enemy_down_ive_got_oneB'] = 'Silk - I got one!';\r\n    SVTS['silk_enemy_down_minus_oneB'] = 'Silk - -1.';\r\n    SVTS['silk_enemy_down_no_kicking_for_youB'] = 'Silk - No kicking for you.';\r\n    SVTS['silk_hurt1B'] = 'Silk - Hurt 1';\r\n    SVTS['silk_hurt2B'] = 'Silk - Hurt 2';\r\n    SVTS['silk_hurt5'] = 'Silk - Hurt 3';\r\n    SVTS['silk_hurt6'] = 'Silk - Hurt 4';\r\n    SVTS['silk_hurt9B'] = 'Silk - Hurt 5';\r\n    SVTS['wea_crossfire2'] = 'Crossfire CR-145 Vortex';\r\n    SVTS['wea_ditzy_cs_ik'] = 'Assault Rifle CS-IK';\r\n    SVTS['wea_glhf'] = 'Grenade Launcher CS-GLHF';\r\n    SVTS['wea_incompetence_archetype_27xx_fire'] = 'Archetype 27XX';\r\n    SVTS['wea_lazyrain_gravy_rl'] = 'Falkonian Anti-Grav Rocket Launcher';\r\n    SVTS['wea_m202'] = 'Rocket Launcher CS-Barrage';\r\n    SVTS['wea_moonhawk_railgun'] = 'Crossfire CR-34 Marauder';\r\n    SVTS['wea_ph01'] = 'Crossfire CR-54 Viper';\r\n    SVTS['wea_plasma_shotgun'] = 'Plasma Shotgun';\r\n    SVTS['wea_rail_alt2'] = 'Falkonian PSI Cutter';\r\n    SVTS['wea_thetoppestkek_shotgun_nxs25'] = 'Shotgun NXS-25';\r\n    SVTS['xin_celebrate'] = 'Xin - Celebrating';\r\n    SVTS['xin_death'] = 'Xin - Death';\r\n    SVTS['xin_enemy_spotted'] = 'Xin - Alerted';\r\n    SVTS['xin_hit'] = 'Xin - Hurt';\r\n    let voices = {\r\n        Grosk: [\r\n            \"Grosk\",\r\n            [\"death\", \"Death\", 2],\r\n            [\"dying\", \"Dying\", 2],\r\n            [\"edown\", \"Celebrating\", 3],\r\n            [\"welcome\", \"Alerted\", 5],\r\n            [\"hurt\", \"Hurt\", 3]\r\n        ],\r\n        drohnentroop: [\r\n            \"Drohnen Trooper\",\r\n            [\"welcome\", \"Alerted\", 3],\r\n            [\"hurt\", \"Hurt\", 3],\r\n            [\"edown\", \"Celebrating\", 3],\r\n            [\"dying\", \"Dying\", 1],\r\n            [\"death\", \"Death\", 3]\r\n        ],\r\n        drohnenfem: [\r\n            \"Drohnen Female\",\r\n            [\"welcome\", \"Alerted\", 3],\r\n            [\"hurt\", \"Hurt\", 3],\r\n            [\"edown\", \"Celebrating\", 3],\r\n            [\"dying\", \"Dying\", 1],\r\n            [\"death\", \"Death\", 3]\r\n        ],\r\n        elurra: [\r\n            \"Elurra\",\r\n            [\"welcome\", \"Alerted\", 3],\r\n            [\"hurt\", \"Hurt\", 2],\r\n            [\"edown\", \"Celebrating\", 2],\r\n            [\"dying\", \"Dying\", 1],\r\n            [\"death\", \"Death\", 1]\r\n        ],\r\n        ferro: [\r\n            \"Lt. Ferro\",\r\n            [\"welcome\", \"Alerted\", 3],\r\n            [\"hurt\", \"Hurt\", 2],\r\n            [\"edown\", \"Celebrating\", 3],\r\n            [\"death\", \"Death\", 2]\r\n        ],\r\n        serkova: [\r\n            \"Serkova\",\r\n            [\"welcome\", \"Alerted\", 3],\r\n            [\"hurt\", \"Hurt\", 1],\r\n            [\"edown\", \"Celebrating\", 2],\r\n            [\"death\", \"Death\", 1]\r\n        ],\r\n        phantom: [\r\n            \"Phantom\",\r\n            [\"edown\", \"Celebrating\", 1],\r\n            [\"welcome\", \"Alerted\", 2],\r\n            [\"death\", \"Death\", 1]\r\n        ]\r\n    };\r\n    for (let entry of Object.entries(voices)) {\r\n        let character = entry[0];\r\n        let charVoices = entry[1];\r\n        let charName = charVoices[0];\r\n\r\n        for (let i = 1; i < charVoices.length; i++) {\r\n            let voice = charVoices[i];\r\n            for (let j = 1; j <= voice[2]; j++) {\r\n                SVTS[`${character}_${voice[0]}${j}`] = `${charName} - ${voice[1]} ${j}`\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateVoicePresets() {\r\n    // Adds voice presets that exist in game but not in ALE\r\n    let VP = VAL_TABLE['voice_preset'];\r\n    VP['proxy_helmetless'] = 'Proxy (helmetless)';\r\n    VP['silk'] = 'Silk';\r\n    VP['orakin'] = 'Orakin';\r\n    VP['arrin'] = 'Arrin';\r\n    VP['civilian_male'] = 'Civilian Male';\r\n    VP['vulture'] = 'Vulture';\r\n    VP['crossfire_sentinel'] = 'Crossfire Sentinel';\r\n    VP['xin'] = 'Xin';\r\n    VP[\"grosk\"] = \"Grosk\";\r\n\r\n    VP[\"elurra\"] = \"Elurra\";\r\n    VP[\"drohnenfem\"] = \"Drohnen Female\";\r\n    VP[\"serkova\"] = \"Serkova\";\r\n    VP[\"ferro\"] = \"Lt. Ferro\";\r\n    VP[\"drohnentroop\"] = \"Drohnen Trooper\";\r\n    VP[\"phantom\"] = \"Phantom\";\r\n}\r\n\r\nfunction updateStyles() {\r\n    // Changes some stylesheets to open up to things like resizable right panel.\r\n    for(let i1 = 0; i1 < stylesheets.length; i1++) {\r\n        let styleSheet = stylesheets[i1];\r\n        for (let i2 = 0; i2 < styleSheet.rules.length; i2++) {\r\n            let rule = styleSheet.rules[i2];\r\n            switch(rule.selectorText) {\r\n                case \".p_i\":\r\n                    rule.style.setProperty(\"display\", \"flex\");\r\n                    break;\r\n                case \".rightui\":\r\n                    rule.style.setProperty(\"width\", aleiSettings.rightPanelSize);\r\n                    break;\r\n                case \".pa1\":\r\n                    rule.style.setProperty(\"flex-grow\", 0);\r\n                    rule.style.setProperty(\"flex-shrink\", 0);\r\n                    break;\r\n                case \".pa2\":\r\n                    rule.style.setProperty(\"width\", \"100%\");\r\n                    break;\r\n                case \".opcode_field\":\r\n                    rule.style.setProperty(\"font-size\", aleiSettings.triggerEditTextSize);\r\n                    break;\r\n                case \"#rparams\":\r\n                    rule.style.setProperty(\"height\", \"var(--ALEI_RPARAMS_HEIGHT)\");\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    $id(\"stars\").style.setProperty(\"background-image\", `url(${aleiSettings.starsImage})`)\r\n    let _th = THEME;\r\n    ThemeSet(THEME_BLUE);\r\n    ThemeSet(_th);\r\n}\r\n\r\nfunction updateSkins() {\r\n    // Adds skins that exist in game but not in ALE.\r\n    let charlists = [\r\n        [10, \"Head Gib\"],\r\n        [18, \"Star Defender (play map ID 'eric gurt-star_defenders' to unlock it)\"],\r\n        [20, \"Arm Gib\"],\r\n        [30, \"Leg Gib\"],\r\n        [50, \"Heavy Hero (Only Head and Arms)\"],\r\n        [60, \"Proxy (Only Head and Arms)\"],\r\n        [62, \"Proxy (No Limbs)\"],\r\n\r\n        [38, \"GoldenKnife Noir Lime\"],\r\n        [39, \"RootZ Noir Lime\"],\r\n\r\n        [151, \"Purple Xin\"],\r\n        [152, \"Golden Xin\"],\r\n        [153, \"Blue Xin\"],\r\n        [154, \"Red Xin\"],\r\n        [155, \"Amber Xin\"],\r\n\r\n        [156, \"Nirvana Noir Lime\"],\r\n\r\n        [157, \"Purple Gallynew\"],\r\n        [158, \"Golden Gallynew\"],\r\n        [159, \"Blue Gallynew\"],\r\n        [160, \"Red Gallynew\"],\r\n        [161, \"Amber Gallynew\"],\r\n\r\n        [162, \"Pinkine\"],\r\n        [163, \"Raider (by Serpent)\"],\r\n        [164, \"Blue Heavy Hero\"],\r\n        [165, \"Red Heavy Hero\"],\r\n        [166, \"Orakin\"],\r\n        [167, \"Husk\"],\r\n        [168, \"Hex\"],\r\n        [169, \"Arrin\"],\r\n        [170, \"Heavy Usurpation Soldier\"],\r\n\r\n        [171, \"Cyber Grub by S1lk\"],\r\n        [172, \"Grosk\"],\r\n        [173, \"Futuristic Knight\"],\r\n        [174, \"Uncivil Proxy\"],\r\n\r\n        [175, \"Serkova Insertion Unit\"],\r\n        [176, \"Xenos Scout\"],\r\n\r\n        [177, \"Armored Trooper\"],\r\n\r\n        [178, \"New Generation Marine\"],\r\n        [179, \"Elurra (by Lin)\"],\r\n        [180, \"Dark Proxy (by littlekk)\"],\r\n        [181, \"Huntsman (Night)\"],\r\n        [182, \"Huntsman (Swamp)\"],\r\n        [183, \"Lt. Ferro (by Serpent)\"],\r\n        [184, \"Xenos Titan\"],\r\n        [185, \"Elurra (Masked) (by Lin)\"],\r\n        [186, \"Drohnen Heavy (by Ark633)\"],\r\n        [187, \"Cromastakan\"],\r\n        [188, \"Sgt. Davais\"],\r\n        [189, \"Maroon (by Francis localhost)\"],\r\n        [190, \"Drohnen Skirmisher (by Ark633)\"],\r\n        [191, \"Serkova Recon Unit\"],\r\n        [192, \"Drohnen Drifter (by Ark633)\"],\r\n        [193, \"Xenos Marine\"],\r\n        [194, \"Dark Android SLC-56 (by littlekk)\"],\r\n        [195, \"Wraith (by Ark633)\"],\r\n        [196, \"Serkova Armored Unit\"],\r\n        [197, \"Phantom (play map ID 'therealon3-phantom' to unlock it)\"],\r\n        [198, \"Blue Civil Security Heavy\"],\r\n        [199, \"Red Civil Security Heavy\"],\r\n        [200, \"Xenos Welder\"],\r\n        [201, \"Xenos Special Unit\"],\r\n        [202, \"Serkova Assault Unit\"],\r\n        [203, \"Serkova Gunner Unit\"],\r\n        [204, \"Serkova Grenader Unit\"],\r\n        [205, \"Serkova Team Leader\"],\r\n        [206, \"Serkova Resource Unit\"],\r\n        [207, \"Serkova Technician Unit\"],\r\n        [208, \"Serkova Grub\"],\r\n        [209, \"Serkova Reinforced Grub\"],\r\n        [210, \"Serkova Devastator Grub\"],\r\n        [211, \"XBT-117 Android\"],\r\n        [212, \"Teneguilae\"],\r\n        [213, \"Walker (by Serpent)\"],\r\n        [214, \"Space Grub (by Broforce1)\"],\r\n        [215, \"Blue Phantom (play map ID 'therealon3-phantom' to unlock it)\"],\r\n        [216, \"Red Phantom (play map ID 'therealon3-phantom' to unlock it)\"]\r\n    ]\r\n    for(let li = 0; li < charlists.length; li++) {\r\n        let charID = charlists[li][0];\r\n        let paddedCharID = charID.toString().padStart(4, \"0\")\r\n        let charName = charlists[li][1];\r\n        let src = \"https://www.plazmaburst2.com/level_editor/chars_full/char\" + paddedCharID + \".png\"\r\n        VAL_TABLE['char'][charID] = _turnLinkIntoSkinSpan(src, charName);\r\n        img_chars_full[charID] = new Image();\r\n        img_chars_full[charID].src = 'chars_full/char' + paddedCharID + '.png';\r\n    }\r\n\r\n    let ids = Object.keys(VAL_TABLE[\"char\"]);\r\n    ids = ids.map(str => parseInt(str));\r\n    let fromID = Math.max(...ids) + 1;\r\n    fetchSkinsFrom(fromID);\r\n}\r\n\r\nfunction _turnLinkIntoSkinSpan(src, charName) {\r\n    return '<span style=\\'background:url(' + src + '); width: 16px; height: 16px; display: inline-block; background-position: center; background-position-x: 30%; background-position-y: 26%; background-size: 67px;vertical-align: -4px;\\'></span> ' + charName;\r\n}\r\n\r\nasync function fetchSkinsFrom(startingID) {\r\n    if(!isNative) return;\r\n    const requestsAtOnce = 5;\r\n    let requestsRunning = true;\r\n    let skinsAdded = [];\r\n\r\n    async function requestSkin(id) {\r\n        let paddedCharID = id.toString().padStart(4, \"0\");\r\n        let src = \"https://www.plazmaburst2.com/level_editor/chars_full/char\" + paddedCharID + \".png\"\r\n        let response = await GM.xmlHttpRequest({ url: src }).catch(e => console.error(e));\r\n        if(response.status == 404) {\r\n            requestsRunning = false;\r\n            return;\r\n        }\r\n        VAL_TABLE[\"char\"][id] = _turnLinkIntoSkinSpan(src, `Unknown Skin #${id}`);\r\n        skinsAdded.push(id);\r\n    }\r\n    async function requestBatch(id) {\r\n        let promises = [];\r\n        for (let i = 0; i < requestsAtOnce; i++) {\r\n            promises.push(requestSkin(id + i));\r\n        }\r\n        await Promise.all(promises);\r\n    }\r\n    let fromID = startingID;\r\n    while(requestsRunning) {\r\n        await requestBatch(fromID);\r\n        fromID += requestsAtOnce;\r\n    }\r\n    if(skinsAdded.length > 0) {\r\n        NewNote(`ALEI: There are ${skinsAdded.length} unregistered skins, please inform ALEI developer(s) about this. Check logs for more information`, `#00FFFF`);\r\n        aleiLog(INFO, `Unregistered skins: ${skinsAdded}`);\r\n    }\r\n}\r\n\r\nfunction optimize() {\r\n    // VSync.\r\n    window.setTimeout = (f, ms) => {\r\n        if (f == ani) {window.requestAnimationFrame(ani)}\r\n        else return JS_setTimeout(f, ms);\r\n    }\r\n    let _browseImages = window.BrowseImages;\r\n    let ogImageLists = {};\r\n    // Image caching.\r\n    window.BrowseImages = function(for_class = 'bg_model', current_value = '', callback = null) {\r\n        // If cache doesn't have the class we are looking for, we will just set default value.\r\n        if (ogImageLists[for_class] == undefined) {\r\n            ogImageLists[for_class] = \"[ALEI] Loading...\";\r\n            aleiLog(INFO, `Will cache response of ${for_class}`);\r\n        }\r\n        // Overwrite setTimeout temporarily, as BrowseImages calls setTimeout for ServerRequest which sets the innerHTML of image_list\r\n        let ost = window.setTimeout;\r\n        window.setTimeout = (f, ms) => {\r\n            window.setTimeout = ost; // Assign original setTimeout\r\n            window.ServerRequest = (req, op, callback = null) => {\r\n                window.ServerRequest = ALEI_ServerRequest; // Assign original ServerRequest\r\n                // We made ServerRequest an async function, so we can just register on it\r\n                ServerRequest(req, op, callback).then(() => {\r\n                    ogImageLists[for_class] = image_list.innerHTML;\r\n                });\r\n            };\r\n            f();\r\n        }\r\n        _browseImages(for_class, current_value, callback);\r\n        image_list.innerHTML = ogImageLists[for_class]; // Show what is in cache. (If cache didn't have the class, it will just show the previously set default value)\r\n    }\r\n}\r\n\r\nfunction updateVehicles() {\r\n    // Adding vehicles that exist in game but not in ALE. Currently only veh_hh, which is grabbable ledge.\r\n    let _SVTV = VAL_TABLE[\"vehicle_model\"];\r\n    let vehicles = [\r\n        [\"veh_hh\", \"Grabbable Ledge\", \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAACLSURBVEhLYxhxgBFE2M3/r/vvH0MQWISGgImJYd2hRMbLIDbYYpu5/+t/MzEEf2diuALi0wJw/mPQYf3HsPZIMmMjiA+3+BMLg/olIYblID4tgN47hki+Pww3YRYzgUUHAIxaTDcwajHdwKjFdAOjFtMNjFpMNzBqMd3AqMV0AwPbrh6InsQAAQYGAA8CLDKAAcpOAAAAAElFTkSuQmCC\"]\r\n    ]\r\n    for(let i = 0; i < vehicles.length; i++) {\r\n        let vehicle = vehicles[i];\r\n        let model = vehicle[0];\r\n        let name = vehicle[1];\r\n        let image = vehicle[2];\r\n        _SVTV[model] = `<img src='${image}' border=0 height=12 style=vertical-align:middle title='${name}' > ${name}`\r\n        img_vehicles[model] = new Image();\r\n        img_vehicles[model].src = image;\r\n    }\r\n}\r\n\r\nfunction updateGuns() {\r\n    // Adds guns that exist in game but not in ALE. Currently only one isn't visible in ALE, and that is joke weapon: NARL\r\n    let guns = [\r\n        [\"gun_rl0\", \"BETA Rocket Launcher\", \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAUCAYAAAAa2LrXAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAfeSURBVFhH3VhZaJVHFD53+++SxCRmM4nBmLhUTYtCbCJaSpF0sRTqVmn7UAptsdQuIKXYQqlQ2of60Idai+BToVQNcQNBqCZQipQEEqNRq8E1MYlZzXKT3Nyl33e8c3u9GputCx49mZnzzz9z5pvvnJn/2mQKsnHjxtxQKGSPNsXhcEScTmfH/v37Q1HTlGX9+vXO/v7+0MmTJyNR0/9aJgXgpk2bfDab7QtUt9rt9lAkEhG0JRwOe2D78ODBg3u14xRkw4YNpRjnc4xXhHFHYBpFGWAJDZi6y+UaxdyBkZGRAIXPEhVjBJKSkgLsNzY2FsBmj8E2hmfUIMYIYNMbDhw4MID2tGTCAAK8jSi+xEIey83NFSoBhJNy+/ZtuX79+u+ofwxbCM7qIuH4qNZt9oCtKxySiITEDrVBsRBbj4xFFjlyRkdHd1iW9c68efNcs2fP5obo2Hg/Vjft1tZWGRgYkCVLlkhqaqoEg0HtY/pSaWtpaZGhoSHtg+i4ZxyAzz5vVVZW7tPFTUNiAG7evDkdg2ZigiAWzfAJox7AbuWjvhO2F71er05eUFAg+fn56hTs6mhjY6M6SoE9Ag0BxCDHg9tBABcEP0L4F5Qg2linDZawL5KVnZ+TWVRUpIt9mHAuv98vly5dUsBWrVol9ImgUEx57do1OXPmjMyfP1/95CabZxT6io14/+jRo99FTVMWBXDLli0uOFQNWpehyZAxAIYBahKAcaWkpChAfX19UlhYKDk5OQoghc6dO3dOEDbCfsPDw9LR0SF5eXkSDobk1p0O6fs0S0KznGIbQ9iHMTz+24Jh8e3rlLKkJyQ7L0dB+TshiJzv5s2bcvXqVW0bO4U+0Y/FixfLrFmztK8Bz/RpaGjg+9uOHTu2Ww3TEAf/LFq0aIPP59u+dOlS+5w5cyyAY2VnZ7tRepKTkx0EhDvPnUROkYyMDHXSOAbglZlkIgFkP4YZxgRDfOJvGZDBCq8MF/oklOqUYJpLgukuCWS4xe4IiXXKL1kF2TrWRCUtLU3mzp2ryoiIr5N1Ho8n5l+icHNxUB0Hk2ujpimLOUk/IqMICiemMjSotJeUlAjyk4KHfKWAxQsd5YIINFnE5263WwG12W3i9XjFavJHe5P2YCHesSOOA4+nSIejW/wD6BtlyESEczIikGLuU8PSf0McuDa8AOB2MF8k5goK2wSEzDLMYz0eRDrMNg8TAocDQW0MJ7Iw7IyIv7lH3F2j4qsDM09Df4P+2i/e2kEJtY6K1+WVjMwMHY9+8P14nUlAZpKBjmXLln0PphUTGDpOIFgmitlxE6KJwvfION4syFyCaMLI6XKKNeyU1GanpLVYktrultQuj6T1eiV9AKx3e6S3t1dzFt8nkznW4OAgF6olNyJ+XoJqhHU+mwjI7EsA79y5MzMAIjz9cNoO9iR1d3enMXdxEZyIoMQDSgfHc5J9yLjOzk4FObGfx+sRd4pHrGQwNAnqs8TltcTpcSnYWJBePdra2lTJZo4Fn/TqQn94xaEwTTDnGqYTYL5PEjxM6CM3hwcQUtHxixcvThvA2DbiIpuCRZdAn0bzGbBtBZiUxZ1nWOJQ0ZJO0OlEMGkna86ePatMNX0ops4+3H0CoCd09BSn8O7G8XGIaX8KSyrzLsFdvny55mSysra2VkpLS/Xq09PTo+2ysjJtx49L4byc89atW9Lc3Ezwq+DjNlyk26JdpizjZm0Amo2JV3R1dT1XU1Pz3rp163g6K7sYagSWDDCAkhF0DtecaoD1DYaIoYs+e1AcB5t/xhXiycuXL+8qLy9XdhuQWc/MzNRTNPEE5fhkGJUgcW7eBcnOlStX6oZxbrLWtPm+2QhevaLPm2H75NChQ1X6YAZkXAATZA+uBlsXLFigLKFyEbjixG760cRciVPwDexs7MjFBd2L4gr0VXzq1ahR5DRO9XICZoAia7hBZCbZnigEg6HNeclE9ifrOMbChQuVwfX19cILOQ87jkvm8q5448aNEdwgvsWGfw0f+qNDzojcex8ZX5qQG98EMzx0ND7BkwVHjhxh3vylurr6paamJn5vxgSH1BoUr0F3nj9/fkiNIkNY0CYu1DCYyjDj5jCX8ToSL3xO8Nrb27VO4BgJyGOSlZWlrGX48wDjmLxy1dXVMX+eQP9XDh8+/BPm50fCjMpEAeyDpkCfSk9PVwOBZNgyKXPR+BJJhvkItEc7RAUAfobCj53/4a5FwbiEBb4MBucQlKhNxzSntzkQaKdSGOYECN/dynxuANnKd8hIHn48BJF29KBAbuwDmGuqqqpu6AD/gEw0hClZ0DP4RMp90CnL8EKSPoHq83ctGr7FKBqhDN+javxL3gZQewlCPEgEiKctP8VYp5jnRpkLWfLuyk0kaIwK1MnsNjC5Ga/9AWBPPWDeGZXJAEjZjp3fVVxcrGESLww/JnYsZBuauwEeGVsN7cIiYqAaAZt8eOcDVDOhHIwxS+UvElZFRYULc1lglgWwLNpMH8xtYQNdAKsb5QXYzkEvwH4FfdtxSAyj/a/IZAFkmNZj5xfwAIlnIRnBnIjw6l27du1XYNa7eM6E/SwA7Lzba/qCsW0A1o4NsGPce/LtfyGTBZDyOpQ/AwWh98QxQQRoztWrVw/gOvIjGMZTzxwcj6RMBUAKP1rv/56DIO/YcEXpx12Pvyo/4iLyJ69VPj0rzLmtAAAAAElFTkSuQmCC\"]\r\n    ];\r\n    for(let i = 0; i < guns.length; i++) {\r\n        let gun = guns[i];\r\n        let gun_model = gun[0];\r\n        let gun_name = gun[1];\r\n        let gun_image = gun[2];\r\n        VAL_TABLE[\"gun_model\"][gun_model] = `<img src='${gun_image}' border=0 width=80 height=20 style=vertical-align:baseline title='${gun_name}'>`\r\n        img_guns[gun_model] = new Image();\r\n        img_guns[gun_model].src = gun_image;\r\n    }\r\n}\r\n\r\nfunction updateDecors() {\r\n    // Adds decors that exist in game, but not in ALE. Currently only hakase easter egg is known.\r\n    window.img_decors = CACHED_DECORS; // For some reason img_decors gets resetted\r\n    let decors = [\r\n        [\"hakase\", \"Hakase\", \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAA8CAYAAAAUufjgAAANHklEQVRogbVaa1Bb17X+AIEOQoID6HF4SjyFEQ+Zh3jJIAdbJo7t2I6duGlm6mkTO1Pf22ZuMxP3TtMbT6ZN2rm5cW+SGbuZTBqTNnHnkga75pmCTYFYAhzAxpYAywjzEAakIxDiiEe4PwgKAvES7jejH2evtdf+ztp7r732OgI8BwEgdxv9NwWfTeiQAOQA4gFIlv24JXlpb/YOjEwB0P2L+IG1jkwSygsoOli08+XdmTuSBCSPXBLQNjsGHln6RCGBpDSaoj6taAoan5yqBmB63AS91mgnfrgvt/LHhwpViuTYdQ3QNjs+udbE1LXcrapru/dLeO7NJQfQyxu93ZF7fm/uu+dOHdmQHACQXA5K8lIJQTCP8pDYoh0y8EfBwUHPrWxftQYzpZIz77xy4tVIYch60++C+fl59A2PR5I8TmR3v6kaALNFfvJ/f/H5PwUH8ubudhvKlgtcPCgRheb8+qWn35CE8YmtWBeFBEEYEojUuMjDebL417ZIDgJBiFQSFUFyeQFJAFRrESSKFcln81PjSXiAg8p0sP1YyEwWn8T34YdMiJOcLszP+i8ASW66EQByY8WRuUX52ZBJ46nnnznwFhajBIBluzgsJLDo5MFdJYSfryf8IAoJwi55IvpN49TebNnPa1u6cOzg3reSpfEqaXwMGppbb+D7DUQASHr2+LNvHTt2rAQAqm9o8YOjT1Fmi5XGsiXiJJieKD6RJA7bcGr/2d6N7OQYMDOzILkcl/bGXgvg7YOMrKzD7/7Pb08kJcSiuq4RxsFhGoshiAQgV6vVp4ufKFZxOByKYBNQq9X48I+D0Pc+QI+hz4Rl4WqJoHynNFq1lvc6ex+C/Z2suXcMI5ZJsH198Mg6jQN5ydDefYCBb/k49YufgaIolF76E2EcGEZSQiykCTH4c9k1XWhoaI6qUHVy/1P75coCJSkWi8EwDN57/z1IpVIcPHQEH13831Vj+wAgCtIT3vzJoUJVhCDYKaBtdnT3L77IFU0PHI5ZWG122Hy4GJ2cgWloCA4iFG0dXZgNScCpf/sFSHJx+YrFElTUfAV+EAf3+wYwbJmxnT798gtnzpyJV2QriCU9FosFFouF+4b7yMzMBD1hQ+lfPjtvoa2aJR7eAHLZLBY5PEa7hIbbvQMYMU/g71/fRUScFMzcPHpME3A4ZiBPT4UXOwAL8zPw4cfAi83FyMiIsy9Jkjj49HGU1zTCzLDw+9//d9KRw0ecxJZDmiiFXq//rl8wDH39Hcvl3gDap5lZnTxR7LL+Ou8PouXuA4zPsUEJ+Og3jcPbnweRIBQ5menw4YYgWroTL/70P3D82HGUfloKk+n7k04qlSIhJRsR0XFul83ylyFJEu9/8D79+uuvnwfQt3KKGUkYX9n9cITi+rP5VpsdtG0aHQNWePn4ouRJNby8vNBn7MfBA/sRHxONy3+vQ97u/Th0+Ci4XC64XC4AoPnrZsiSZWCxFpc2wzBo+6YDWZkZbsnRNI3Kqkqm4lpF4+eXPz+r79ZfBDC2kiD6R8ZH+oZGTTwuoaxoun2TCg2SmOcJ5OZkQ1WQA4LNhi/bH1PTDK636HDwyHPIzMx0GUwsFuPWrVtwMA6IxWJ0dHTgi/IrKChQIioy3EWXYRg0NzfjwoUL7e+8+86rrW2tv5mamuoAMLfyJZZ2sc5iszNf1reRk1OMSZ4YpQoURiE3S44bzS3oezgIeHnDvuCPF0+fgbu1BADqvWqUfloKhmFQ39CIYvWTUGTtdNExGo24VHqp77PPPztvMBjKV07pSrjLZiSnDqv+xqci5BGxUphGxwAvb6Rm5EGt3geCWD9UXv7rZdzreYCCXbuRk5GKwGWxsqqqivn444+ryq+W/w7AzXUNfQd3CYHpPr3Q98NXTsm1Wi0W/AJx/NhxSKXSDY3V1ddjxDyJpw49g5hIkZMcwzCovlaOrqZKWttUf2Gz5AD36ZZcnpGlamhogNVqhThavClyZV98gRHLFPIKihAuDAE/ONApu3L1Crp7eyGPpajXfnTgPIBNp2ar0q1CZeFPjh49WlL8RDGkiVIkJyc7d6k7MAyDT0pL4U0EIj5BClEoiagwvouOTCaDLCUNlXUNKE6N5FOhgUrdg6GxKWZGv2WC4mix6qWXXlKJxWLw+fx1yZlMJnz40Ufw45BIS5NDEiFEmDDErS5BEOAGC1FZU4sX9mRG8gL8VZ09/QN2x0zXegRXrUEWi7VhsknTNG5qNPiq/joysvORlpaG2EgKHH/2uv3S09Oh16nQ2Pk1Xny6iAJw/t2/VGHUaru8Vp9VHnzQ98BXvVd9Mi5u9QnAMAwqKivwRfkVmCemsEe9H1k70xAbRcHXd3MJeFx8Amr/qYGQmEeEMJhLT03Hd/Y+vIEVAXpNggCY8LDwPcXFxc6FbDQa0dnZiabaq7jdqkG2qgT7S/ZBGhftEkY2AxaLBT4VgasVlViYZeg/fF5zwTE7dwNrXBPcEbSNPBohwsPDVWFUGKumtga1tbXQtmh1ucI5fiSHhTadAcV79sLPz29L5JbA5/Nhts/hYW8XwfLBmN44/Oe1dN1e3C0WS8c333xD375zmxwZGZkbHBrUXbp06eILasWBqFA+ent6YbLPISUl1SOCACCWxOBWVzcGDD1jOuPwJ2vprbVwGIPB8AeDwXAZi+k5g2V3CmVyHGpvVKIhPBKFhYUeESQIAk8fex632jsJoI3EivvwEjYqfdi+62gDIHlhX+5JHsHBt/MLCA0gUNvQCEFUDCjKsysxSZII4Qsjm5qbTBaLReNOx91J4haZ0uh0UQjP+RwayMXueBH++uH7MBqNG/ZnGPfRS6FQYHfR7hNY43TZTPEIAIididG/OlKUET/j+BYzs/MAAA7bDz5zDOo0tyBNSYONmcW9+wMYemTGyBgNPx+gtbUFDQ0NqKyqhEKhcOaKS2CxWJiZneGXlZVVw01ms1mCkcVZO159RpVBmulpJ0Fg0ZPm4UEYrdPYpSzApNWM/7v8KXp0t9HVdQdcLhc5ihyo96rXzIS8vbxZGq1GZzKZmlbKNlvekPACCMJoGsf8/AKau3oZti8LbD8WkRBBYWDCzpzIUhAAkJSYgDfPnduk2UWIRCIIBAK5O9lmCdJldbfeTowQvjH8aAqXahrPRwlDVQAQwg0gO4fM1w87mFe2xGoZSJIEL8B98WmzBNsNw6PtvymtZCYmp2izbbq8d+hRdVy4QFzffu+GQCAocjAOT/kBAFLTUqmyv5VRWFFj3HQFCwD6hscuLnu8eX9o9CYAyGQylVgshl6vB8MwSE9P3zLBwMBAAosx1wWbDjPrgKQoSg4sJqZr3Vc2QmxMLAU3oeaxEExNSaU0Wg3Ue9UQi8UeGeFwOP8yD0pSU1Il3d3dHk3tRtg2wYSEBGkQGQSBQOgsYTxObJtgmCiMokQUZLIU/KOu7nFwcsG2CQoEApVIJIKyIB8GYz9o2m1S4jG2S5AA4DzCJJJYaLXa7XJywXYJUgXKAsnSQ3p6OjQtLR4ZstvtbtOdx7GLnUhJToZj9lt0dHRsrLwChgcGE9xkM9v2oEgockbm4CAuYuISUH/9ultlmqah1+vR0NCwSjY4MOhSPF/Clo46NyAEAoHL0fGEqhB/vHgBer3epWTy27ffhs0+DS6PBF8gQk7urLPuTdM02jvb++DmW992Ca5CuEgAaXIarl67BrFY7NxA/3n2LO70GDHNzCA+OsxJDgC0Wi3a29u/dGfvsezi5WD7+aJwlxITUw5UVVe7yGIjKfh4eyM4aLGccuXqFQBAU1OTbnx8fHt3EncoVBbmuDt7I0ShyN+lwtfaVtTU1DjbOf5syBKiAQAarQZ9xoegaRo6nU6HNb6SPvYpBha9mLojEQBQ/1Ul7NPTKNm3WPxcmlqNthUZGZmwWq2wWCzta9l6rGFmOSJEoYiMCEfRnifRfuce3vvgA+dZ3dHRgUdjZqSlpW1oZzsepLxZ3hSbvXZFKzaSwjQzg6cOPQOrZcyZilXV1CJaEodALgeW8fUH8diDOdk5r51749zL613aOf5sZzFTIKRAEARu3rwJy4QNu3erAABsNhvcQK5kLRsee5CiKAkZtBgCvywvh51xIC9fCT8/Nhwzs5iZdf2iMDM7h1/+6teYnZvHnpIDYPv6LtnBDukOeUVFhQTbuBevwsTkBB0QELBHqVRyKYqCwdCLiqoq9D8cxNQ0A9o6AT/C34WoMCwCSckpIMlgTE0zGHpkhp1xgMcNoNraWnVms7lt5Tgee5DL5Ury8/IpYPHa+Nyzz2Gfmoa+W487XXexsLAAVYHCqT8zO4dwYQgmp6adbT4+3ogQhiJKtAvZWdklPT09F1eO4zFBXgAvVyQSubSRJIkcRQ5yFDlbsqXRajA/N+82kVzrbykbIiwsbF9+bv5ZkiQJWYpsy+WtiYkJ5nbnbRMAjI6OXm9obLgIN2exxwSXgcAWvnssA4NN/BHo/wEN3ae6aBBdhgAAAABJRU5ErkJggg==\"]\r\n    ];\r\n    for(let i = 0; i < decors.length; i++) {\r\n        let decor = decors[i];\r\n        let decor_model = decor[0];\r\n        let decor_name = decor[1];\r\n        let decor_image = decor[2];\r\n        VAL_TABLE[\"decor_model\"][decor_model] = decor_name; // Add to known decors.\r\n        img_decors[decor_model] = new Image();\r\n        img_decors[decor_model].src = decor_image;\r\n        img_decors[decor_model].native = true;\r\n        CACHED_DECORS[decor_model] = img_decors[decor_model];\r\n        CUSTOM_IMAGES_APPROVED[decor_model] = true; // Since it's obviously vanilla, and other vanilla decors are approved, it's only natural if we approve added decors too\r\n    }\r\n    window.ALEI_decors = decors;\r\n}\r\n\r\nfunction updateOffsets() {\r\n    // Because hakase decor and grabbable ledge image is made with hand manually and doesn't come from website, and that there is no\r\n    // inbuilt offset, we have to offset those to make sure they show up in ALE correctly.\r\n    let toosc = window.ThinkOfOffsetClass;\r\n    window.ThinkOfOffsetClass = function(tc, esi) {\r\n        if (tc == \"vehicle\" && offsets[esi.pm.model] != undefined) {\r\n            return \"alei_\" + esi.pm.model;\r\n        } else if (tc == \"decor\" && offsets[esi.pm.model] != undefined) {\r\n            return \"alei_\" + esi.pm.model;\r\n        } else if (tc == \"gun\" && (esi.pm.model == \"gun_rl0\")) {\r\n            return \"alei_gun_rl0\";\r\n        } else return toosc(tc, esi);\r\n    }\r\n    let offsets = {\r\n        veh_hh: {x: -15, y: -15, w: 30, h: 30},\r\n        hakase: {x: -18, y: -57, w: 40, h: 60},\r\n        gun_rl0: {x: -24, y: -6, w: 61, h: 13}\r\n    }\r\n    for (let key in offsets) {\r\n        let off = offsets[key];\r\n        lo_x[\"alei_\" + key] = off.x;\r\n        lo_y[\"alei_\" + key] = off.y;\r\n        lo_w[\"alei_\" + key] = off.w;\r\n        lo_h[\"alei_\" + key] = off.h;\r\n    }\r\n}\r\n\r\nfunction updateTriggers() {\r\n    // This is where we will rename some triggers.\r\n    // For now it's only 378, but we got more triggers like renaming 328\r\n    addTrigger(175, \"Gun &#8250; Change gun 'A' projectile model to 'B'\", \"gun\", \"ALEI_projectileModels\");\r\n    addTrigger(378, \"Gun &#8250; Add hex color 'B' to gun 'A'\", \"gun\", \"string\");\r\n    addTrigger(332, \"Var &#8250; Set variable 'A' to value 1 if Gun 'B' is in owner's active slot, set to value 0 in else case\", \"string\", \"gun\");\r\n}\r\n\r\nfunction updateObjects() {\r\n    // Shorthand for object-related functions as to not clutter console.\r\n    updateGuns();\r\n    updateVehicles();\r\n    updateDecors();\r\n    updateTriggers();\r\n}\r\n\r\nfunction updateButtons() {\r\n    let topPanel = $id(\"top_panel\");\r\n    let childs = topPanel.children;\r\n\r\n    // We redirect the manual page to EaglePB2's.\r\n    childs[16].value = \"Eagle's Manual\";\r\n    childs[16].setAttribute(\"onclick\", \"window.open('https://eaglepb2.gitbook.io/pb2-editor-manual/', '_blank');\")\r\n\r\n    // We dont want our new buttons to appear after \"rights\", so we will store \"rights\" beforehand and remove them, we'll add them back once we are done\r\n    let appendBack = (topPanel.removeChild(childs[childs.length - 1])).outerHTML;\r\n    appendBack = (topPanel.removeChild(childs[childs.length - 1])).outerHTML + appendBack;\r\n\r\n    // Remove pad (we will add our own later).\r\n    topPanel.removeChild(childs[childs.length - 1])\r\n\r\n    window.aleiButtonClicks = {};\r\n\r\n    // Convenience function for doing easy top panel buttons\r\n    function createButton(text, internalName, onClick) {\r\n        let button = document.createElement(\"input\");\r\n        button.setAttribute(\"class\", \"field_btn\");\r\n        button.setAttribute(\"type\", \"button\");\r\n        button.setAttribute(\"value\", text);\r\n        button.setAttribute(\"onclick\", `aleiButtonClicks['${internalName}']()`);\r\n        window.aleiButtonClicks[internalName] = onClick;\r\n\r\n        let pad = document.createElement(\"div\");\r\n        pad.setAttribute(\"class\", \"q\");\r\n\r\n        topPanel.appendChild(button);\r\n        topPanel.appendChild(pad);\r\n    }\r\n    let bigPad = document.createElement(\"div\");\r\n    bigPad.setAttribute(\"class\", \"q3\");\r\n    topPanel.appendChild(bigPad);\r\n\r\n    // \"Download XML\" button.\r\n    createButton(\"Download XML\", \"downloadXMLButton\", exportXML);\r\n    // \"Insert XML\" button.\r\n    createButton(\"Insert XML\", \"insertXMLButton\", () => {\r\n        let file = confirm(\"File (OK) or text (Cancel) ?\");\r\n\r\n        if (file) {\r\n            let fileInput = document.createElement(\"input\");\r\n\r\n            fileInput.type = \"file\";\r\n\r\n            fileInput.onchange = function() {\r\n                if (fileInput.files[0]) {\r\n                    if (fileInput.files[0].name.split(\".\")[1] == \"xml\") {\r\n                        let reader = new FileReader();\r\n\r\n                        reader.onload = function() {\r\n                            insertXML(reader.result);\r\n\r\n                            fileInput.remove();\r\n                        }\r\n\r\n                        reader.readAsText(fileInput.files[0]);\r\n                    } else {\r\n                        alert(\"Invalid file extension.\");\r\n                    }\r\n                }\r\n            }\r\n\r\n            fileInput.click();\r\n        } else {\r\n            let xml = prompt(\"Enter XML:\", \"\");\r\n\r\n            if (xml !== null) {\r\n                insertXML(xml);\r\n            }\r\n        }\r\n    });\r\n    createButton(\"ALEI Settings\", \"openALEISettings\", showSettings);\r\n    // Readd 'rights' back.\r\n    topPanel.innerHTML += appendBack;\r\n    // Update original reference\r\n    window.mapid_field = $id(\"mapid_field\");\r\n    mapid_field.value = mapid; // And update map id field value manually.\r\n}\r\n\r\nfunction addClipboardSync() {\r\n    let clipboard_channel = new BroadcastChannel(\"ale_clipboard\");\r\n\r\n    ///////////////\r\n    // Receiving //\r\n    ///////////////\r\n    clipboard_channel.onmessage = (msg) => {\r\n        let data = msg.data;\r\n        let kind = data.kind;\r\n        if (kind == \"send\") {\r\n            let recipient = data.recipient;\r\n            let clip_name  = data.clip_name;\r\n            let clip_data  = data.clip_data;\r\n\r\n            if (recipient == undefined || recipient == aleiSessionID) {\r\n                aleiLog(DEBUG, '/ale_clipboard/ got data for ' + clip_name);\r\n                sessionStorage[clip_name] = clip_data;\r\n            }\r\n        }\r\n        if (kind == \"get\") {\r\n            if (aleiSessionID > Math.min(...aleiSessionList)) return;\r\n\r\n            let session_id = data.session_id;\r\n            aleiLog(DEBUG, '/ale_clipboard/ syncing to ' + session_id);\r\n            for (let i = 0; i <= 10; i++) {\r\n                let clip_name = \"clipboard\" + (i == 0 ? \"\" : (\"_slot\" + (i-1)));\r\n                let clip_data = sessionStorage[clip_name];\r\n                if (clip_data == undefined) continue;\r\n                clipboard_channel.postMessage({kind: \"send\", recipient: session_id, clip_name, clip_data});\r\n            }\r\n        }\r\n    }\r\n\r\n    // Initial Sync\r\n    aleiLog(DEBUG, '/ale_clipboard/ requesting');\r\n    clipboard_channel.postMessage({kind: \"get\", session_id: aleiSessionID});\r\n\r\n    /////////////\r\n    // Sending //\r\n    /////////////\r\n    let ALE_CopyToClipBoard = window.CopyToClipBoard;\r\n    window.CopyToClipBoard = (clip_name) => {\r\n        ALE_CopyToClipBoard(clip_name);\r\n        let clip_data = sessionStorage[clip_name];\r\n        clipboard_channel.postMessage({kind: \"send\", clip_name, clip_data});\r\n    }\r\n}\r\n\r\nasync function addSessionSync() {\r\n    // This function registers some events, as to talk with other tabs\r\n    // For now, this is useful for clipboard sync, but we probably can have more.\r\n    const PROBE_TIMEOUT_MS = 200;\r\n    let session_channel = new BroadcastChannel(\"ale_session\");\r\n\r\n    // Receive data\r\n    session_channel.onmessage = (msg) => {\r\n        let data = msg.data;\r\n        let kind = data.kind;\r\n        // New ALEI instance started up.\r\n        if (kind == \"start\") {\r\n            if (aleiSessionID == null) return;\r\n            session_channel.postMessage({kind: \"greet\", id: aleiSessionID});\r\n            aleiLog(DEBUG, \"/ale_session/ recieved start\");\r\n        }\r\n        // An ALEI instance responded to new ALEI instance, registering the ALEI instance\r\n        if (kind == \"greet\") {\r\n            let session_id = data.id;\r\n            if (!aleiSessionList.includes(session_id))\r\n                aleiSessionList.push(session_id);\r\n            aleiLog(DEBUG, \"/ale_session/ received greet by \" + session_id);\r\n        }\r\n        // An ALEI instance is closing\r\n        if (kind == \"close\") {\r\n            let session_id = data.id;\r\n            aleiSessionList.splice(aleiSessionList.indexOf(session_id), 1);\r\n            aleiLog(DEBUG, \"/ale_session/ received close by \" + session_id);\r\n        }\r\n    }\r\n\r\n    // Probe for other sessions\r\n    session_channel.postMessage({kind: \"start\"});\r\n    aleiLog(DEBUG, \"/ale_session/ probing\");\r\n    await new Promise(resolve => {\r\n        JS_setTimeout(resolve, PROBE_TIMEOUT_MS);\r\n    });\r\n\r\n    // Assign own session ID\r\n    if (aleiSessionList.length == 0)\r\n        aleiSessionID = 0;\r\n    else\r\n        aleiSessionID = Math.max(...aleiSessionList) + 1;\r\n\r\n    aleiLog(DEBUG, \"/ale_session/ session ID \" + aleiSessionID);\r\n\r\n    // Tell other sessions that this one is done\r\n    window.addEventListener('beforeunload', (event) => {\r\n        session_channel.postMessage({kind: \"close\", id: aleiSessionID});\r\n    });\r\n\r\n    addClipboardSync();\r\n}\r\n\r\nfunction addPropertyPanelResize() {\r\n    // Gives right panel ability to be resized.\r\n\r\n    let splitter_is_down = false;\r\n    const splitter = document.createElement(\"div\");\r\n    const root = document.documentElement;\r\n\r\n    splitter.style.position = \"absolute\";\r\n    splitter.style.width = \"5px\";\r\n    splitter.style.top = \"50px\";\r\n    splitter.style.height = \"100%\";\r\n    splitter.style.cursor = \"w-resize\";\r\n    // splitter.style[\"background-color\"] = \"black\";\r\n    $id('floattag').appendChild(splitter);\r\n\r\n    function splitter_resize(e) {\r\n        let new_width = Math.min(root.clientWidth - 100, Math.max(100, root.clientWidth - e.clientX));\r\n        right_panel.style.width = new_width + 'px';\r\n        splitter.style.right = new_width + 'px';\r\n        ROOT_ELEMENT.style.setProperty(\"--param_panel_size\", splitter.style.right);\r\n        updateBoxSplitterSize();\r\n    }\r\n\r\n    splitter.addEventListener('mousedown', (e) => {\r\n        splitter_is_down = true;\r\n    });\r\n\r\n    root.addEventListener('mouseup', (e) => {\r\n        splitter_is_down = false;\r\n        writeStorage('ALEI_RightPanelWidth', right_panel.clientWidth + 'px');\r\n    });\r\n\r\n    root.addEventListener('mousemove', (e) => {\r\n        if (splitter_is_down) splitter_resize(e);\r\n    });\r\n\r\n    splitter.style.right = aleiSettings.rightPanelSize;\r\n    ROOT_ELEMENT.style.setProperty(\"--param_panel_size\", splitter.style.right);\r\n    window.splitter = splitter;\r\n}\r\n\r\nfunction addTriggerIDs() {\r\n    if (!aleiSettings.showTriggerIDs) return;\r\n\r\n    let SVTTP = VAL_TABLE['trigger_type'];\r\n    for (let i in SVTTP) {\r\n        SVTTP[i] = i + \" \" + SVTTP[i];\r\n    }\r\n}\r\n\r\nfunction patchShowHideButton() {\r\n    let og = window.ShowHideObjectBox;\r\n    window.ShowHideObjectBox = function() {\r\n        og();\r\n        let rparams = $id(\"rparams\");\r\n        let heightOffset = {true: 270, false: 155}[ObjectBox_visible];\r\n        if (rparams != null) {\r\n            heightOffset = Math.round(rparams.getBoundingClientRect().top + 13);\r\n        }\r\n        // We then set variable and call original function.\r\n        document.documentElement.style.setProperty(\"--ALEI_RPARAMS_HEIGHT\", `calc(100vh - ${heightOffset}px)`);\r\n        //og();\r\n    }\r\n    ShowHideObjectBox();\r\n    ShowHideObjectBox(); // Hacky way to fix bug\r\n}\r\n\r\nwindow.ALEI_CustomSnapping = () => {\r\n    let snapping = prompt(\"Enter snapping:\", \"\");\r\n\r\n    if(!snapping) return;\r\n    if(isNaN(Number(snapping))) {NewNote(\"Invalid snapping.\", \"#FF0000\"); return};\r\n\r\n    if (snapping < 0.1) {\r\n        snapping = 0.1;\r\n        NewNote(\"ALEI: Snapping can't be less than 0.1\", \"#FF0000\");\r\n        return;\r\n    }\r\n\r\n    if (snapping > 100) {\r\n        snapping = 100;\r\n        NewNote(\"ALEI: Snapping can't be greater than 100\", \"#FF0000\");\r\n        return;\r\n    }\r\n\r\n    GridSnappingSet(Math.round(snapping * 10));\r\n}\r\n\r\nfunction addSnappingOptions_helper() {\r\n    // Remove default snapping options except for \"1\", we will replace it them later\r\n    $query(`a[onmousedown=\"GridSnappingSet(50);\"]`).remove();\r\n    $query(`a[onmousedown=\"GridSnappingSet(100);\"]`).remove();\r\n\r\n    let newHTML = \"\"\r\n    let snappingOptions = [\r\n        1, 2, 5,\r\n        10, 20, 40,\r\n        50, 100, \"C\"\r\n    ];\r\n\r\n    for (let snappingIndex in snappingOptions) {\r\n        let snapping = snappingOptions[snappingIndex];\r\n\r\n        if ((snappingIndex % 3 == 0) && (snappingIndex != 0)) {\r\n            // We have to break into new row.\r\n            newHTML += \"<br>\";\r\n        }\r\n\r\n        let element = document.createElement(\"a\");\r\n        // Set relevant attributes.\r\n\r\n        if (snapping != \"C\") {\r\n            element.innerHTML = snapping / 10;\r\n        } else {\r\n            element.innerHTML = \"C\";\r\n        }\r\n\r\n        let toolClass = \"tool_btn\";\r\n        if (GRID_SNAPPING == snapping) {\r\n            toolClass = \"tool_btn2\";\r\n        }\r\n\r\n        if (!snappingOptions.includes(GRID_SNAPPING) && snapping == \"C\") {\r\n            toolClass = \"tool_btn2\";\r\n        }\r\n\r\n        element.setAttribute(\"class\", `${toolClass} tool_wid`);\r\n        element.setAttribute(\"style\", \"width: 21px;\");\r\n\r\n        if (snapping != \"C\") {\r\n            element.setAttribute(\"onmousedown\", `GridSnappingSet(${snapping}); Render();`);\r\n        } else {\r\n            element.setAttribute(\"onmousedown\", \"ALEI_CustomSnapping(); Render();\");\r\n        }\r\n\r\n        newHTML += element.outerHTML;\r\n        // Add to main HTML.\r\n    }\r\n    // Replace original `1` snapping with new HTML.\r\n    $query(`a[onmousedown=\"GridSnappingSet(10);\"]`).outerHTML = newHTML;\r\n}\r\n\r\nwindow.ALEI_UpdateRematchUIDSetting = function(value) {\r\n    if(value && !OCM_LOADED && aleiSettings.ocmEnabled) CreateConnectionMapping(); // To create OCM.\r\n    if(!value && OCM_LOADED && aleiSettings.ocmEnabled) CreateConnectionMapping(); // To clear OCM. (As it might be already outdated by the time rematch UID gets enabled)\r\n\r\n    aleiSettings.rematchUID = value;\r\n    writeStorage(\"ALEI_RemapUID\", value);\r\n    UpdateTools();\r\n}\r\n\r\nfunction addRematchUIOptions_helper() {\r\n    $query(`a[onmousedown=\"EvalSet('param_panel_size',800);SaveBrowserSettings();UpdateCSS();\"]`).remove();\r\n\r\n    let result = document.evaluate(\"//span[contains(., 'Param')]\", left_panel, null, XPathResult.ANY_TYPE, null);\r\n    result.iterateNext();\r\n    result.iterateNext().innerHTML = \"Remap UID\";\r\n\r\n    for (let value of [[true, \"Yes\", 0], [false, \"No\", 200]]) {\r\n        let element = document.createElement(\"a\");\r\n        element.innerHTML = value[1];\r\n\r\n        let toolClass = \"tool_btn\";\r\n        if(aleiSettings.rematchUID == value[0]) toolClass = \"tool_btn2\";\r\n\r\n        element.setAttribute(\"class\", `${toolClass} tool_wid`);\r\n        element.setAttribute(\"style\", \"width: 64px;\");\r\n        element.setAttribute(\"onmousedown\", `ALEI_UpdateRematchUIDSetting(${value[0]})`);\r\n\r\n        $query(`a[onmousedown=\"EvalSet('param_panel_size',${value[2]});SaveBrowserSettings();UpdateCSS();\"]`).outerHTML = element.outerHTML;\r\n    }\r\n\r\n}\r\n\r\nwindow.ALEI_UpdateNameRenderSetting = function(status) { // TODO: we should have mixin function lol, check: <#1245454955477729382>\r\n    window.ENABLE_TEXT = status;\r\n    aleiSettings.renderObjectNames = status;\r\n    writeStorage(\"ALEI_RenderObjectNames\", status);\r\n    UpdateTools();\r\n    need_redraw = 1;\r\n}\r\n\r\nfunction addPreviewNamesOptions_helper() {\r\n    let prevElement = $query(`a[onmousedown=\"ShowTexturesSet(true);\"]`);\r\n\r\n    function space() {\r\n        let spacer = document.createElement(\"div\");\r\n        spacer.setAttribute(\"class\", \"q\");\r\n        prevElement.outerHTML += spacer.outerHTML;\r\n    }\r\n\r\n    let headerText = document.createElement(\"span\");\r\n    headerText.setAttribute(\"class\", \"gui_sel_info\");\r\n    headerText.innerHTML = \"Object Names\";\r\n\r\n    let buttonHTML = \"\";\r\n\r\n    function addButton(text, status) {\r\n        let button = document.createElement(\"a\");\r\n        let _class = \"tool_btn\";\r\n\r\n        if(status == aleiSettings.renderObjectNames) _class = \"tool_btn2\";\r\n\r\n        button.setAttribute(\"class\", `tool_wid ${_class}`);\r\n        button.setAttribute(\"style\", \"width: 32px\");\r\n        button.setAttribute(\"onmousedown\", `ALEI_UpdateNameRenderSetting(${status});`);\r\n        button.innerHTML = text;\r\n        buttonHTML += button.outerHTML;\r\n    }\r\n\r\n    addButton(\"Show\", true);\r\n    addButton(\"Hide\", false);\r\n\r\n    prevElement.outerHTML += `<br><div class=\"q\"></div><br>` + headerText.outerHTML + \"<br>\" + buttonHTML;\r\n\r\n}\r\n\r\nfunction onToolUpdate() {\r\n    addSnappingOptions_helper();\r\n    addRematchUIOptions_helper();\r\n    addPreviewNamesOptions_helper();\r\n}\r\n\r\nfunction patchUpdateTools() {\r\n    let ut = UpdateTools;\r\n    window.UpdateTools = function() {\r\n        ut();\r\n        onToolUpdate();\r\n    }\r\n    UpdateTools();\r\n    aleiLog(DEBUG, \"Patched updateTools.\");\r\n}\r\n\r\nfunction tryToNumber(x) {\r\n    if (!isNaN(Number(x))) {\r\n        return Number(x);\r\n    } else {\r\n        return x;\r\n    }\r\n}\r\n\r\nfunction insertXML(xml) {\r\n    xml = \"<map>\" + xml.replaceAll(\"&\", \"[__Amp]\") + \"</map>\";\r\n\r\n    let parser = new DOMParser();\r\n    let map = parser.parseFromString(xml, \"application/xml\");\r\n    let objects = map.querySelectorAll(\"*\");\r\n\r\n    for (let i = 1; i < objects.length; i++) {\r\n        let object = objects[i];\r\n        if (object.tagName == \"map\") continue;\r\n\r\n        let eo = new E(object.tagName);\r\n        eo.pm = {};\r\n\r\n        for (let j = 0; j < object.attributes.length; j++) {\r\n            let name = object.attributes[j].name;\r\n            let value = object.attributes[j].value;\r\n\r\n            eo.pm[name] = tryToNumber(value.replaceAll(\"[__Amp]\", \"&\"));\r\n        }\r\n\r\n        es.push(eo);\r\n    }\r\n\r\n    need_redraw = 1;\r\n    need_GUIParams_update = 1;\r\n}\r\n\r\nfunction exportXML() {\r\n    let exportSelection = 0;\r\n    let newstr = \"\";\r\n    let download = document.createElement(\"a\");\r\n\r\n    for (let i = 0; i < es.length; i++) {\r\n        if (es[i].selected) {\r\n            exportSelection = 1;\r\n        }\r\n    }\r\n\r\n    if (exportSelection) {\r\n        if(!confirm(\"Only selection will be exported.\")) return;\r\n        for (let i = 0; i < es.length; i++) {\r\n            if (es[i].selected) {\r\n                newstr += compi_obj(i);\r\n            }\r\n        }\r\n\r\n        if (mapid) {\r\n            download.download = mapid + \" (selection).xml\";\r\n        } else {\r\n            download.download = \"newmap (selection).xml\";\r\n        }\r\n    } else {\r\n        for (let i = 0; i < es.length; i++) {\r\n            if (es[i].exists) {\r\n                newstr += compi_obj(i);\r\n            }\r\n        }\r\n\r\n        if (mapid) {\r\n            download.download = mapid + \".xml\";\r\n        } else {\r\n            download.download = \"newmap.xml\";\r\n        }\r\n    }\r\n\r\n    download.href = \"data:text,\" + escape(newstr);\r\n\r\n    if (newstr != \"\") {\r\n        download.href = \"data:text,\" + escape(newstr);\r\n\r\n        download.click();\r\n    } else {\r\n        alert(\"Map is empty.\");\r\n    }\r\n\r\n    download.remove();\r\n}\r\n///////////////////////////////\r\nconst _ignoredKeys = [\r\n    // Numbers obviously cannot have texts.\r\n    \"x\",\r\n    \"y\",\r\n    \"w\",\r\n    \"h\",\r\n    \"maxcalls\",\r\n    \"command\",\r\n    \"upg\",\r\n    \"tox\",\r\n    \"toy\",\r\n    \"stab\",\r\n    \"damage\",\r\n    \"u\",\r\n    \"v\",\r\n    \"sx\",\r\n    \"sy\",\r\n    \"r\",\r\n    \"f\",\r\n    \"power\",\r\n    // Booleans obviously cannot have texts.\r\n    \"enabled\",\r\n    \"flare\",\r\n    // We are obviously not going to change UID\r\n    \"uid\",\r\n    // We are obviously not going to change models\r\n    \"gun_model\",\r\n    \"model\",\r\n];\r\n\r\n/*\r\n * UUIDR_Replace\r\n * This is function that handles replacing name part.\r\n * Is meant to be used in UpdateUIDReferences below.\r\n\r\n * @param  {string}  value    Value to be replaced.\r\n * @param  {string}  oldName  Previous name to be replaced from.\r\n * @param  {string}  newName  New name to be replaced to.\r\n*/\r\nfunction UUIDR_Replace(value, oldName, newName) {\r\n    if ((typeof(value) !== \"string\")) return value;\r\n    if(value.indexOf(oldName) === -1) return value;\r\n    if(value == oldName) return newName;\r\n\r\n    let splt = value.split(\",\");\r\n    for (let i = 0; i < splt.length; i++) {\r\n        let item = splt[i];\r\n        if (item.trim() == oldName) {\r\n            splt[i] = item.replace(oldName, newName);\r\n        }\r\n    }\r\n    return splt.join(\",\");\r\n\r\n}\r\n\r\nfunction updateUIDReferences(oldName, newName) {\r\n    aleiLog(DEBUG2, `Updating UID references from ${ANSI_CYAN}${oldName}${ANSI_RESET} to ${ANSI_CYAN}${newName}${ANSI_RESET}`);\r\n    for (let i = 0; i < es.length; i++) {\r\n        let element = es[i];\r\n        if (!element.exists) continue;\r\n        let properties = element.pm;\r\n\r\n        for (let entry of Object.entries(properties)) {\r\n            let key = entry[0];\r\n            let value = entry[1];\r\n\r\n            if (_ignoredKeys.indexOf(key) !== -1) continue;\r\n\r\n            if([\"additionalParamA\", \"additionalParamB\"].indexOf(key) !== -1) {\r\n                // This is extended action.\r\n                for(let i = 0; i < value.length; i++) {\r\n                    value[i] = UUIDR_Replace(value[i], oldName, newName);\r\n                }\r\n                continue;\r\n            }\r\n\r\n            properties[key] = UUIDR_Replace(value, oldName, newName);\r\n        }\r\n    }\r\n    window.need_GUIParams_update = true;\r\n}\r\n\r\n/*\r\n * __OCM_EnsureValidReferences\r\n * This function is called in UpdatePhysicalParam(AFTER parameter was set.) to keep integrity of OCM (Object Connection Mapping)\r\n * Essentially just a function making sure the structure is valid on each parameter change.\r\n *\r\n * @param {E}     obj    PB2 Object to ensure validity of references of.\r\n*/\r\nfunction __OCM_EnsureValidReferences(obj) {\r\n    let ocm = window.ObjectConnectionMapping;\r\n    let utem = window.uidToElementMap;\r\n\r\n    let pm = obj.pm;\r\n    if(ocm[pm.uid] === undefined) return;\r\n\r\n    let newReferences = [];\r\n    function addReference(value) {\r\n        if(newReferences.indexOf(value) === -1) newReferences.push(value);\r\n    }\r\n\r\n    for(let key of Object.keys(pm)) {\r\n        if(__OCM_CHECKED_KEYS.indexOf(key) === -1) continue;\r\n        let value = pm[key];\r\n\r\n        if(utem[value] !== undefined) {\r\n            addReference(value);\r\n            continue;\r\n        }\r\n    }\r\n\r\n    function Trigger_HandleParameter(trigger, parameter) {\r\n        if(typeof(parameter) !== \"string\") return;\r\n\r\n        if(utem[parameter] !== undefined) { // Simple case where parameter is simply reference to object.\r\n            addReference(parameter);\r\n            return;\r\n        }\r\n        if(!parameter.includes(\",\")) return;\r\n        // A little complex case where multiple objects are referenced\r\n        // As in Parameter B: #region*1,#region*2\r\n        let splt = parameter.split(\",\");\r\n        for(let value of splt) {\r\n            let val = value.trim();\r\n            if(utem[val] !== undefined) addReference(val);\r\n        }\r\n    }\r\n\r\n    if(obj._class == \"trigger\") {\r\n        // Vanilla trigger case (10 actions, extended triggers will run this too)\r\n        for(let i = 1; i < 11; i++) {\r\n            if(pm[`actions_${i}_type`] == -1) continue;\r\n            if(pm[`actions_${i}_type`] === undefined) continue;\r\n            Trigger_HandleParameter(pm.uid, pm[`actions_${i}_targetA`]);\r\n            Trigger_HandleParameter(pm.uid, pm[`actions_${i}_targetB`]);\r\n        }\r\n        // Extended triggers.\r\n        if(pm.extended) {\r\n            let actions = pm.additionalActions;\r\n            let paramA = pm.additionalParamA;\r\n            let paramB = pm.additionalParamB;\r\n\r\n            for(let i = 0; i < actions.length; i++) {\r\n                if(actions[i] === -1) continue;\r\n                Trigger_HandleParameter(pm.uid, paramA[i]);\r\n                Trigger_HandleParameter(pm.uid, paramB[i]);\r\n            }\r\n        };\r\n\r\n\r\n    }\r\n\r\n    let oldReferences = ocm[pm.uid][\"to\"];\r\n    // let newReferences\r\n    for(let ref of newReferences) {\r\n        if(oldReferences.indexOf(ref) !== -1) continue; // No change.\r\n        // This wasn't in old reference, but is now, so added.\r\n        __OCM_AddReference(pm.uid, ref);\r\n    }\r\n    for(let ref of oldReferences) {\r\n        if(newReferences.indexOf(ref) !== -1) continue; // No change.\r\n        // This was in old reference, but not anymore, so removed.\r\n        __OCM_RemoveReference(pm.uid, ref);\r\n\r\n    }\r\n\r\n}\r\n\r\n/**\r\n *  This function updates the actual entity class's pm property based on selection.\r\n *  This function is invoked from setletedit().\r\n *\r\n *  @param {*}          paramname            Property to update   Eg: actions_1_type\r\n *  @param {*}          chvalue              Value to update with Eg: 0\r\n *  @param {boolean}    toShowNote           Default parameter (true). Indicates whether to show confirmation note.\r\n */\r\nfunction UpdatePhysicalParam(paramname, chvalue, toShowNote = true) {\r\n    lcz();\r\n\r\n    var layer_mismatch = false;\r\n    var list_changes = '';\r\n\r\n    // Finds selection.\r\n    let ogES = window.es;\r\n    window.es = SelectedObjects;\r\n    for (var elems = 0; elems < es.length; elems++) {\r\n        if (!es[elems].exists)                                                    continue;\r\n        if (!es[elems].selected)                                                  continue;\r\n        if (!es[elems].pm.hasOwnProperty(paramname) && !es[elems].pm[\"extended\"]) continue;\r\n        if (!MatchLayer(es[elems])) {\r\n            layer_mismatch = true;\r\n            continue;\r\n        }\r\n\r\n        // For extended triggers.\r\n        // Find action_XX_YYYY, where XX is the number representing trigger action 12 for example and YYYY is either targetA, targetB or type.\r\n        let regex = /actions_(\\d+)_(targetA|targetB|type)/g;\r\n        let match = Array.from(paramname.matchAll(regex))[0];\r\n\r\n        // For undo and redo.\r\n        let lup = (typeof (paramname) == 'string') ? '\"' + paramname + '\"' : paramname;\r\n        chvalue = (typeof (chvalue) == 'number' || chvalue == 0) ? chvalue : _encodeXMLChars(`${chvalue}`);\r\n\r\n        // Not a trigger or below action10 and below. Proceed with the usual Eric's implementation.\r\n        if(!match || Number(match[1]) - 11 < 0){\r\n            lnd('es[' + elems + '].pm[' + lup + '] = ' + es[elems].pm[paramname] + ';');\r\n            ldn('es[' + elems + '].pm[' + lup + '] = ' + chvalue + ';');\r\n\r\n            // Rematch UID\r\n            if((paramname == \"uid\") && aleiSettings.rematchUID) {\r\n                let oldName = es[elems].pm[paramname]; // Note: don't do this after getting original ES, otherwise id isn't valid lmao\r\n                window.es = ogES;\r\n                // Making sure we keep names unique for OCM structure\r\n                if(window.uidToElementMap[chvalue] !== undefined) {\r\n                    NewNote(`ALEI: Object with name ${chvalue} already exists, consider naming it differently.`, \"#FFFF00\");\r\n                    return;\r\n                }\r\n                updateUIDReferences(oldName, chvalue);\r\n\r\n                if(aleiSettings.ocmEnabled) {\r\n                    let ocm = window.ObjectConnectionMapping;\r\n                    ocm[chvalue] = ocm[oldName];\r\n                    delete ocm[oldName];\r\n\r\n                    function redirectConnections(obj, oldName, newName) {\r\n                        let index = ocm[obj][\"to\"].indexOf(oldName);\r\n                        if(index !== -1) ocm[obj][\"to\"][index] = newName;\r\n                        index = ocm[obj][\"by\"].indexOf(oldName);\r\n                        if(index !== -1) ocm[obj][\"by\"][index] = newName;\r\n                    }\r\n                    ocm[chvalue][\"by\"].map(v => redirectConnections(v, oldName, chvalue));\r\n                    ocm[chvalue][\"to\"].map(v => redirectConnections(v, oldName, chvalue));\r\n                }\r\n\r\n                ogES = window.es;\r\n                window.es = SelectedObjects;\r\n            }\r\n\r\n            if(paramname == \"__id\") {\r\n                NewNote(`ALEI: Changing Object ID does not do anything, don't expect that to apply.`, \"#FFFFFF\");\r\n            }\r\n            // Saves the value to the class.\r\n            es[elems].pm[paramname] = chvalue;\r\n\r\n            if(paramname == \"__priority\") {\r\n                ApplyObjectProperties(es[elems]);\r\n            }\r\n        }\r\n        // Handling extended trigger's >10 trigger action.\r\n        else{\r\n            let index = Number(match[1]) - 11;      // action_11_... starts at element 0.\r\n\r\n            let propertyName = '';\r\n            if(match[2] === \"type\"){\r\n                propertyName = \"additionalActions\";\r\n            }\r\n            else if(match[2] === \"targetA\"){\r\n                propertyName = \"additionalParamA\";\r\n            }\r\n            else if(match[2] === \"targetB\"){\r\n                propertyName = \"additionalParamB\";\r\n            }\r\n            else{\r\n                aleiLog(WARN, \"Something went wrong with regex. \" + match[2]);\r\n                return;\r\n            }\r\n\r\n            lnd(`es[\"${elems}\"].pm[\"${propertyName}\"][${index}] = ${es[elems].pm[propertyName][index]};`);\r\n            ldn(`es[\"${elems}\"].pm[\"${propertyName}\"][${index}] = ${chvalue};`);\r\n\r\n            es[elems].pm[propertyName][index] = chvalue;\r\n\r\n\r\n        }\r\n        if(aleiSettings.ocmEnabled) __OCM_EnsureValidReferences(es[elems]);\r\n        if(paramname == \"uses_timer\") { // I do not have to do this, but i will for convenience\r\n            if([true, \"true\"].indexOf(es[elems].pm.uses_timer) != -1) {\r\n                param_type[REGION_EXECUTE_PARAM_ID][1] = \"timer+none\";\r\n            } else {\r\n                param_type[REGION_EXECUTE_PARAM_ID][1] = \"trigger+none\";\r\n            }\r\n            need_GUIParams_update = true;\r\n        }\r\n\r\n        list_changes += 'Parameter \"' + paramname + '\" of object \"' + (es[elems].pm.uid != null ? es[elems].pm.uid : es[elems]._class) + '\" was set to \"' + chvalue + '\"<br>';\r\n    }\r\n\r\n    need_redraw = true;\r\n\r\n    if(toShowNote) {\r\n        NewNote('Operation complete:<br><br>' + list_changes, note_passive);\r\n    }\r\n\r\n    if (layer_mismatch) {\r\n        NewNote('Note: Some changes weren\\'t made due to missmatch of active layer and class of selected objects', note_neutral);\r\n    }\r\n    lfz(false);\r\n    window.es = ogES;\r\n}\r\n\r\nlet imageContextMap = {};\r\nlet last_element;\r\nlet last_login;\r\nwindow.aleiContextRenameImage = function(id) {\r\n    var v = prompt('New name:', imageContextMap[id]);\r\n    CloseImageContext();\r\n    if ( v !== null ) {\r\n        ServerRequest(`a=get_images&for_class=${last_for_class}&set_title_for=${id}&value=${v}`, \"rename_image\");\r\n    }\r\n}\r\nwindow.aleiContextDeleteImage = function(id) {\r\n    let v = confirm(`Are you sure you want to delete ${imageContextMap[id]} ?`);\r\n    CloseImageContext();\r\n    if ( v ) {\r\n        last_element.style.opacity = '0.5';\r\n        ServerRequest(`a=get_images&for_class=${last_for_class}&delete=${id}`, 'delete_image' );\r\n    }\r\n}\r\n\r\nfunction ImageContext(id, e, old_name, element, moderator_menu, awaiting_approval=false, login='?', approver='?', is_fav_menu = false) {\r\n    imageContextMap[id] = old_name;\r\n    last_element = element;\r\n    last_login = login;\r\n    e.preventDefault();\r\n\r\n    var image_context = document.getElementById('image_context');\r\n\r\n    var str = '';\r\n\r\n    if (moderator_menu) {\r\n        str += `<div onclick=\"CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&approve_for=${id}', 'approve_image' ); }, 1 );\">Approve <img src=\"../images/ap.png\" width=\"11\" height=\"11\"></div>`;\r\n        str += `<div onclick=\"CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&reset_status_for=${id}', 'reset_approval_image' ); }, 1 );\">Reset approval status</div>`;\r\n        str += `<div onclick=\"CloseImageContext(); setTimeout( function() { open_approved_decor_model = true; SaveFiltering(); search_phrase = '*by_login*'+last_login; UpdateImageList(); }, 1 );\">Search for other approved images from &quot;${login}&quot;</div>`;\r\n        str += `<div onclick=\"\" style=\"color:rgba(0,0,0,0.3)\">Last status change by ${approver}</div>`;\r\n        str += `<div onclick=\"CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&disapprove_for_all='+last_login, 'disapprove_image' ); }, 1 );\">Disapprove all unreviewed from &quot;${login}&quot; <img src=\"../images/noap.png\" width=\"11\" height=\"11\"><img src=\"../images/noap.png\" width=\"11\" height=\"11\"><img src=\"../images/noap.png\" width=\"11\" height=\"11\"></div>`;\r\n        str += `<div onclick=\"CloseImageContext(); setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&disapprove_for=${id}', 'disapprove_image' ); }, 1 );\">Disapprove <img src=\"../images/noap.png\" width=\"11\" height=\"11\"></div>`;\r\n\r\n    } else {\r\n        //console.log( login, curlogin );\r\n\r\n        if (login == curlogin && approver != '!') {\r\n            str += `<div onclick=\"aleiContextRenameImage(${id})\">Rename</div>`; // We overwrite rename action to our own.\r\n\r\n            if (awaiting_approval) {\r\n                str += `<div onclick=\"\" style=\"color:rgba(0,0,0,0.3)\">Request Approval (already done)</div>`;\r\n                str += `<div onclick=\"CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&deawait_approval_for=${id}', 'await_approval_status' ); }, 1 ); \">Exclude from approval review queue</div>`;\r\n            } else {\r\n                if (old_name == 'Untitled') {\r\n                    str += `<div onclick=\"alert('Proper name required for custom image - you will not be available to change name once image is approved.');\" style=\"color:rgba(0,0,0,0.3)\">Request Approval (proper name required)</div>`;\r\n                } else {\r\n                    str += `<div onclick=\"CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&await_approval_for=${id}', 'await_approval_status' ); }, 1 ); \">Request Approval <img src=\"../images/ap.png\" width=\"11\" height=\"11\"></div>`;\r\n                }\r\n                str += `<div onclick=\"\" style=\"color:rgba(0,0,0,0.3)\">Exclude from approval review queue (not in queue)</div>`;\r\n            }\r\n\r\n            str += `<div onclick=\"aleiContextDeleteImage(${id})\">Delete <img src=\"../images/noap.png\" width=\"11\" height=\"11\"></div>`;\r\n        } else {\r\n            str += `<div onclick=\"CloseImageContext(); setTimeout( function() { open_approved_decor_model = true; SaveFiltering(); search_phrase = '*by_login*'+last_login; UpdateImageList(); }, 1 );\">Search for other approved images from &quot;${login}&quot;</div>`;\r\n        }\r\n\r\n        str += `<span style=\"display:block;\">&nbsp;</span>`;\r\n        if (is_fav_menu) {\r\n            str += `<div onclick=\"CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&favorite_del=${id}', 'favorite_status' ); }, 1 ); \">Remove from favorites</div>`;\r\n        } else {\r\n            str += `<div onclick=\"CloseImageContext();  setTimeout( function() { ServerRequest('a=get_images&for_class='+last_for_class+'&favorite_add=${id}', 'favorite_status' ); }, 1 ); \">Add to favorites</div>`;\r\n        }\r\n\r\n    }\r\n\r\n    image_context.innerHTML = str;\r\n\r\n    image_context.style.left = e.clientX;\r\n    image_context.style.top = e.clientY;\r\n    image_context.style.display = 'block';\r\n\r\n    image_context_cancel_pad.style.display = 'block';\r\n\r\n    return false;\r\n}\r\n\r\nfunction findObjects(name) {\r\n    let exact = confirm(\"Exact name?\");\r\n    let notFound = 1;\r\n\r\n    function pred(d) {\r\n        if (exact) {return d == name;}\r\n        else {return d.includes(name)}\r\n    }\r\n\r\n    for (let i = 0; i < es.length; i++) {\r\n        es[i].selected = 0;\r\n\r\n        if (es[i].pm.uid) {\r\n            if (pred(es[i].pm.uid) && MatchLayer(es[i])) {\r\n                es[i].selected = 1;\r\n                notFound = 0;\r\n            }\r\n        }\r\n    }\r\n\r\n    need_GUIParams_update = 1;\r\n    need_redraw = 1;\r\n\r\n    return notFound;\r\n}\r\n\r\nfunction rotateObjects() {\r\n    let selected = SelectedObjects;\r\n    let distX = [];\r\n    let distY = [];\r\n    let minX;\r\n    let minY;\r\n\r\n    for (let i = 0; i < selected.length; i++) {\r\n        if (selected[i].pm.w && selected[i].pm.h) {\r\n            let save = selected[i].pm.w;\r\n\r\n            selected[i].pm.w = selected[i].pm.h;\r\n            selected[i].pm.h = save;\r\n        }\r\n\r\n        distX.push(selected[i].pm.x);\r\n        distY.push(selected[i].pm.y);\r\n    }\r\n\r\n    minX = Math.min(...distX);\r\n    minY = Math.min(...distY);\r\n\r\n    for (let i = 0; i < selected.length; i++) {\r\n        distX[i] -= minX;\r\n        distY[i] -= minY;\r\n\r\n        selected[i].pm.x = minX + distY[i];\r\n        selected[i].pm.y = minY + distX[i];\r\n    }\r\n}\r\n\r\nfunction RandomizeName(oldName) {\r\n    let takenUids = es.filter(e => e.exists).map(o => o.pm.uid);\r\n    let actualName = oldName;\r\n    if(oldName.indexOf(\"*\") !== -1) actualName = oldName.slice(0, oldName.indexOf(\"*\"));\r\n\r\n    let current = 1;\r\n    while(takenUids.indexOf(`${actualName}*${current}`) !== -1) current++;\r\n\r\n    return `${actualName}*${current}`;\r\n}\r\n\r\nfunction patchRandomizeName() {\r\n    window.RandomizeName = RandomizeName;\r\n}\r\n\r\nfunction patchAllowedCharacters() {\r\n    allowed_string_chars += \"<>\";\r\n}\r\n\r\nfunction getRuleBySelector(selector) {\r\n    let rules = document.styleSheets[0].rules;\r\n    let rule;\r\n\r\n    for (let i = 0; i < rules.length; i++) {\r\n        if (rules[i].selectorText == selector) {\r\n            rule = rules[i];\r\n        }\r\n    }\r\n\r\n    return rule;\r\n}\r\n\r\nwindow.blackThemeUndos = [];\r\n\r\nfunction setStyle(selector, style, value, isUndo = false) {\r\n    if(!isUndo) blackThemeUndos.push([\r\n        selector,\r\n        style,\r\n        getRuleBySelector(selector).style[style]\r\n    ]);\r\n    getRuleBySelector(selector).style[style] = value;\r\n}\r\n\r\nfunction UndoBlackTheme() {\r\n    ThemeSet(0);\r\n    for(let undo of blackThemeUndos) {\r\n        setStyle(undo[0], undo[1], undo[2], true);\r\n    }\r\n}\r\n\r\nfunction blackTheme() {\r\n    ThemeSet(0);\r\n\r\n    window.THEME = 4;\r\n\r\n    setStyle(\".topui\", \"backgroundSize\", \"0px\"); // removes top ui detail\r\n    setStyle(\".leftui\", \"backgroundSize\", \"0px\"); // removes left ui detail\r\n    setStyle(\".rightui\", \"backgroundSize\", \"0px\"); // removes right ui detail\r\n    setStyle(\".topui\", \"backgroundColor\", \"#0A0A0A\");\r\n    setStyle(\".leftui\", \"backgroundColor\", \"#0A0A0A\");\r\n    setStyle(\".rightui\", \"backgroundColor\", \"#0A0A0A\");\r\n    setStyle(\".field_btn\", \"backgroundColor\", \"#1E1E1E\");\r\n    setStyle(\".tool_btn\", \"backgroundColor\", \"#1E1E1E\");\r\n    setStyle(\".tool_btn\", \"border\", \"\"); // tool button outline\r\n    setStyle(\".tool_btn2\", \"backgroundColor\", \"#4566AB\");\r\n    setStyle(\".tool_btn2\", \"border\", \"1px solid #FFFFFF20\");\r\n    setStyle(\".field_btn\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".tool_btn\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".tool_btn2\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".gui_sel_info\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".c\", \"color\", \"#FFFFFF20\");\r\n    setStyle(\".pa1\", \"color\", \"#808080\");\r\n    setStyle(\".pa2\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".field_dis_left\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".field_dis_right\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".p_u1\", \"border\", \"\");\r\n    setStyle(\".p_u2\", \"border\", \"\");\r\n    setStyle(\".pa1\", \"backgroundColor\", \"#101010\");\r\n    setStyle(\".pa2\", \"backgroundColor\", \"#1B1B1B\");\r\n    setStyle(\".objbox\", \"backgroundColor\", \"#131313\");\r\n    setStyle(\".field_dis_left\", \"backgroundColor\", \"#1E1E1E\");\r\n    setStyle(\".field_dis_right\", \"backgroundColor\", \"#131313\");\r\n    setStyle(\".selline1\", \"backgroundColor\", \"#7A1314\"); // selected object/current map\r\n    setStyle(\".tool_btn:hover\", \"backgroundColor\", \"#5f8dd3\");\r\n    setStyle(\".tool_btn:hover\", \"border\", \"1px solid #FFFFFF20\");\r\n    setStyle(\".tool_btn:hover\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".tool_btn2:hover\", \"backgroundColor\", \"#5077C4\");\r\n    setStyle(\".tool_btn2:hover\", \"border\", \"1px solid #FFFFFF20\");\r\n    setStyle(\".tool_btn2:hover\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".field_btn:hover\", \"backgroundColor\", \"#353535\");\r\n    setStyle(\".field_btn:hover\", \"color\", \"#FFFFFFD0\");\r\n    setStyle(\".tool_btn:active\", \"backgroundColor\", \"#151515\"); // object list hold fill\r\n    setStyle(\".tool_btn:active\", \"border\", \"1px solid #FFFFFF20\"); // object list hold outline\r\n    setStyle(\".tool_btn:active\", \"color\", \"#FFFFFFD0\"); // object list hold text\r\n    setStyle(\".tool_btn2:active\", \"backgroundColor\", \"#39558C\"); // toggled active button hold fill\r\n    setStyle(\".tool_btn2:active\", \"border\", \"1px solid #FFFFFF20\"); // toggled active button hold outline\r\n    setStyle(\".tool_btn2:active\", \"color\", \"#FFFFFFD0\"); // toggled active button hold text\r\n    setStyle(\".field_btn:active\", \"backgroundColor\", \"#151515\"); // field button hold fill\r\n    setStyle(\".field_btn:active\", \"color\", \"#CCC\"); // field button hold text\r\n    setStyle(\"#mrtitle\", \"backgroundColor\", \"#1E1E1E\"); // map list overhead\r\n    setStyle(\"#mrbox\", \"backgroundColor\", \"#0A0A0A\"); // maplist border fill\r\n    setStyle(\".field_input\", \"backgroundColor\", \"#131313\"); // map id field\r\n    setStyle(\".field_input\", \"color\", \"#CCC\"); // what\r\n    setStyle(\".btn\", \"backgroundColor\", \"#1E1E1E\"); // map button\r\n    setStyle(\".btn\", \"color\", \"#CCC\"); // what\r\n    setStyle(\".btn:hover\", \"backgroundColor\", \"#353535\"); // map button hover\r\n    setStyle(\".btn:hover\", \"color\", \"#CCC\"); // what is this 8\r\n    setStyle(\".btn:active\", \"backgroundColor\", \"#151515\"); // map button hold\r\n    setStyle(\".btn:active\", \"color\", \"#CCC\"); // what is this 10\r\n    setStyle(\"closebox\", \"backgroundColor\", \"#353535\"); // decor list close button\r\n    setStyle(\"closebox\", \"color\", \"#CCC\"); // what\r\n    setStyle(\".list_group\", \"backgroundColor\", \"#1E1E1E\"); // decor list category\r\n    setStyle(\".list_group\", \"borderBottom\", \"\"); // what is this 14\r\n    setStyle(\".list_group:hover\", \"backgroundColor\", \"#353535\"); // decor list category hover\r\n    setStyle(\".list_group:active\", \"backgroundColor\", \"#0A0A0A\"); // decor list category hold\r\n    setStyle(\".image_list_collapsable\", \"backgroundColor\", \"#0A0A0A\"); // decor list background\r\n    setStyle(\".img_option_selected\", \"backgroundColor\", \"#4566AB40\"); // current decor\r\n    setStyle(\".rightui\", \"borderLeft\", \"\"); // removes right ui border\r\n    setStyle(\".leftui\", \"borderRight\", \"\"); // removes left ui order\r\n    setStyle(\"::-webkit-scrollbar-thumb\", \"backgroundColor\", \"#888\"); // what is this\r\n    setStyle(\"#rparams, #gui_objbox, #tools_box, #parambox\", \"scrollbarColor\", \"\"); // what is this\r\n    setStyle(\"#rparams, #gui_objbox, #tools_box, #parambox\", \"scrollbarWidth\", \"\"); // what is this\r\n    setStyle(\"#tools_box\", \"overflow-y\", \"hidden\"); // what is this\r\n    setStyle(\"#tools_box\", \"overflow-y\", \"auto\"); // what is this\r\n}\r\n\r\nfunction getObjectBox(obj) {\r\n    let x = 0;\r\n    let y = 0;\r\n    let w = obj.pm.w;\r\n    let h = obj.pm.h;\r\n\r\n    if (!\"box door region pushf bg water\".includes(obj._class)) {\r\n        x = bo_x[obj._class];\r\n        y = bo_y[obj._class];\r\n        w = bo_w[obj._class];\r\n        h = bo_h[obj._class];\r\n    }\r\n\r\n    if (\"player enemy\".includes(obj._class)) {\r\n        x = -15;\r\n        y = -81;\r\n        w = 30;\r\n        h = 80;\r\n    }\r\n\r\n    if (obj._class == \"vehicle\") {\r\n        x = bo_x[\"vehicle_\" + obj.pm.model];\r\n        y = bo_y[\"vehicle_\" + obj.pm.model];\r\n        w = bo_w[\"vehicle_\" + obj.pm.model];\r\n        h = bo_h[\"vehicle_\" + obj.pm.model];\r\n\r\n        if (obj.pm.model == \"veh_hh\") {\r\n            x = lo_x[\"alei_veh_hh\"];\r\n            y = lo_y[\"alei_veh_hh\"];\r\n            w = lo_w[\"alei_veh_hh\"];\r\n            h = lo_h[\"alei_veh_hh\"];\r\n        }\r\n    }\r\n\r\n    return {\r\n        x: x,\r\n        y: y,\r\n        w: w,\r\n        h: h\r\n    }\r\n}\r\n\r\nfunction getSelectionImage() {\r\n    let selection = SelectedObjects;\r\n    let arr1 = [];\r\n    let arr2 = [];\r\n    let minX = +Infinity;\r\n    let minY = +Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n\r\n    for (let i = 0; i < selection.length; i++) {\r\n        let box = getObjectBox(selection[i]);\r\n        let x = selection[i].pm.x + box.x;\r\n        let y = selection[i].pm.y + box.y;\r\n        let w = box.w;\r\n        let h = box.h;\r\n\r\n        if (x < minX) {\r\n            minX = x;\r\n        }\r\n\r\n        if (x + w > maxX) {\r\n            maxX = x + w;\r\n        }\r\n\r\n        if (y < minY) {\r\n            minY = y;\r\n        }\r\n\r\n        if (y + h > maxY) {\r\n            maxY = y + h;\r\n        }\r\n    }\r\n\r\n    window.es = [];\r\n    for (let e of selection) {\r\n        es.push(e);\r\n    }\r\n\r\n\r\n\r\n    THEME = 4;\r\n    GRID_ALPHA = 0;\r\n    SHOW_CONNECTIONS = 0;\r\n    zoom = 1;\r\n    zoom_validate();\r\n\r\n    let sw = dis_to_x - dis_from_x;\r\n    let sh = dis_to_y - dis_from_y;\r\n\r\n    dis_from_x = minX - 10;\r\n    dis_from_y = minY - 10;\r\n    dis_to_x = minX + sw - 10;\r\n    dis_to_y = minY + sh - 10;\r\n\r\n    ConsoleTraceMessages = [];\r\n\r\n    Render();\r\n\r\n    let w = maxX - minX + 20;\r\n    let h = maxY - minY + 20;\r\n\r\n    aleiLog(DEBUG2, \"Before GID\");\r\n    let data = ctx.getImageData(0, 0, w, h);\r\n    aleiLog(DEBUG2, \"After GID\");\r\n\r\n    let canvas = document.createElement(\"canvas\");\r\n    let ctx2 = canvas.getContext(\"2d\");\r\n\r\n    let canvas2 = document.createElement(\"canvas\");\r\n    let ctx3 = canvas2.getContext(\"2d\");\r\n\r\n    canvas.width = w;\r\n    canvas.height = h;\r\n\r\n    ctx2.beginPath();\r\n    ctx2.putImageData(data, 0, 0);\r\n    ctx2.closePath();\r\n\r\n    let prevW = w;\r\n    let prevH = h;\r\n\r\n    if (w > 100 || h > 100) {\r\n        let divide = w / h;\r\n\r\n        if (divide >= 1) {\r\n            w = 100;\r\n            h = w / divide;\r\n        } else {\r\n            h = 100;\r\n            w = h * divide;\r\n        }\r\n    }\r\n\r\n    canvas2.width = w;\r\n    canvas2.height = h;\r\n\r\n    ctx3.beginPath();\r\n    ctx3.scale(w / prevW, h / prevH);\r\n    ctx3.drawImage(canvas, 0, 0);\r\n    ctx3.closePath();\r\n\r\n    let result = canvas2.toDataURL();\r\n\r\n    canvas.remove();\r\n    canvas = undefined;\r\n\r\n    return result;\r\n}\r\n\r\nfunction createClipboardDiv() {\r\n    let clipboardDiv = document.createElement(\"div\");\r\n    let mrdimlights = document.getElementById(\"mrdimlights\");\r\n\r\n    clipboardDiv.id = \"clipboardDiv\";\r\n    clipboardDiv.className = \"mrpopup\";\r\n    clipboardDiv.style = \"width: calc(100% - 280px); height: 100%; margin: 0px; padding: 0px; top: 50%; transform: translate(0px, -50%); display: none;\";\r\n\r\n    clipboardDiv.addEventListener(\"contextmenu\", e => {\r\n        e.preventDefault();\r\n    });\r\n\r\n    mrdimlights.addEventListener(\"click\", e => {\r\n        clipboardDiv.style.display = \"none\";\r\n    });\r\n\r\n    document.body.append(clipboardDiv);\r\n}\r\n\r\nfunction clipboardItemAction(i) {\r\n    let items = JSON.parse(localStorage.clipboardItems);\r\n    let action = confirm(\"Rename (OK) or delete (Cancel) ?\");\r\n\r\n    if (action) {\r\n        let name = prompt(\"Enter name:\", items[i].name);\r\n\r\n        if (name) {\r\n            items[i].name = name;\r\n\r\n            localStorage.clipboardItems = JSON.stringify(items);\r\n\r\n            updateClipboardDiv();\r\n        }\r\n    } else {\r\n        if (confirm(\"Are you sure you want to delete?\")) {\r\n            items.splice(i, 1);\r\n\r\n            localStorage.clipboardItems = JSON.stringify(items);\r\n\r\n            updateClipboardDiv();\r\n        }\r\n    }\r\n}\r\n\r\nfunction registerClipboardItemAction() {\r\n    window.clipboardItemAction = clipboardItemAction;\r\n    aleiLog(DEBUG, \"Registered Clipboard Item Action\");\r\n}\r\n\r\nfunction updateClipboardDiv() {\r\n    if (!localStorage.clipboardItems) {\r\n        localStorage.clipboardItems = \"[]\";\r\n    }\r\n\r\n    let items = JSON.parse(localStorage.clipboardItems);\r\n    let clipboardDiv = document.getElementById(\"clipboardDiv\");\r\n    let mrdimlights = document.getElementById(\"mrdimlights\");\r\n\r\n    clipboardDiv.style.display = \"block\";\r\n    mrdimlights.style.display = \"block\";\r\n\r\n    let html = `\r\n        <div id=\"mrtitle\">\r\n            <span>Object clipboard</span>\r\n            <closebox onclick=\"document.getElementById('clipboardDiv').style.display = 'none'; document.getElementById('mrdimlights').style.display = 'none';\">x</closebox>\r\n        </div>\r\n\r\n        <div id=\"mrbox\" class=\"objbox\" style=\"height: calc(100% - 32px); box-sizing: border-box;\">\r\n    `;\r\n\r\n    let originalES = window.es;\r\n    let cs = {} // CS: Current Settings, because we will change settings for rendering images\r\n    cs.theme = THEME;\r\n    cs.grid_opacity = GRID_ALPHA;\r\n    cs.showConnections = SHOW_CONNECTIONS;\r\n    //\r\n    cs.dtx = dis_to_x;\r\n    cs.dty = dis_to_y;\r\n    //\r\n    cs.dfx = dis_from_x;\r\n    cs.dfy = dis_from_y;\r\n    //\r\n    cs.ctm = ConsoleTraceMessages;\r\n    cs.zoom = zoom;\r\n\r\n    window.es = [];\r\n    for (let i = 0; i < items.length; i++) {\r\n        __pasteObjectClipboard(items[i]);\r\n        html += `\r\n            <div class=\"img_option\" style=\"width: auto;\" oncontextmenu=\"clipboardItemAction(` + i + `)\" onclick=\"pasteFromPermanentClipboard(` + i + `);\">\r\n                <img src=\"` + getSelectionImage() + `\" style=\"max-width: 100px; max-height: 100px;\">\r\n                <div>` + items[i].name + `</div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    clipboardDiv.innerHTML = html + \"</div>\";\r\n    window.es = originalES;\r\n    THEME = cs.theme;\r\n    GRID_ALPHA = cs.grid_opacity;\r\n    SHOW_CONNECTIONS = cs.showConnections;\r\n    dis_to_x = cs.dtx;\r\n    dis_to_y = cs.dty;\r\n    dis_from_x = cs.dfx;\r\n    dis_from_y = cs.dfy;\r\n    ConsoleTraceMessages = cs.ctm;\r\n    zoom = cs.zoom;\r\n    need_redraw = 1;\r\n    zoom_validate();\r\n}\r\n\r\nfunction __pasteObjectClipboard(item) {\r\n    sessionStorage.permanent_clipboard = item.data;\r\n    PasteFromClipBoard(\"permanent_clipboard\");\r\n}\r\n\r\nfunction pasteFromPermanentClipboard(i) {\r\n    let items = JSON.parse(localStorage.clipboardItems);\r\n\r\n    sessionStorage.permanent_clipboard = items[i].data;\r\n\r\n    PasteFromClipBoard(\"permanent_clipboard\");\r\n\r\n    let clipboardDiv = document.getElementById(\"clipboardDiv\");\r\n    let mrdimlights = document.getElementById(\"mrdimlights\");\r\n\r\n    clipboardDiv.style.display = \"none\";\r\n    mrdimlights.style.display = \"none\";\r\n\r\n    NewNote(\"Objects pasted from permanent clipboard.\", note_passive);\r\n}\r\n\r\nfunction copyToPermanentClipboard() {\r\n    try {\r\n        let selection = SelectedObjects;\r\n\r\n        if (selection.length != 0) {\r\n            CopyToClipBoard(\"permanent_clipboard\");\r\n\r\n            let items = JSON.parse(localStorage.clipboardItems);\r\n\r\n            items.push({\r\n                name: \"Selection\",\r\n                data: sessionStorage.permanent_clipboard\r\n            });\r\n\r\n            localStorage.clipboardItems = JSON.stringify(items);\r\n\r\n            NewNote(\"Objects copied to permanent clipboard.\", note_passive);\r\n        } else {\r\n            updateClipboardDiv();\r\n        }\r\n    } catch (err) {\r\n        console.error(err);\r\n        NewNote(\"Can't copy objects to permanent clipboard.<br>LocalStorage error?\", note_bad);\r\n    }\r\n}\r\n\r\nfunction changeTopRightText() {\r\n    let containerElem = document.getElementById(\"version_rights\");\r\n    let elem = containerElem.childNodes[0];\r\n\r\n    containerElem.style.width = \"170px\";\r\n    elem.style.width = \"160px\";\r\n\r\n    let version = \"\";\r\n    if(isNative) version = \" v\" + GM_info.script.version;\r\n\r\n    elem.innerHTML = elem.innerHTML.replaceAll(\"<br>\", \" \") + \"<br>ALE Improvements\" + version;\r\n}\r\n\r\n// Adds additional button\r\nfunction addAdditionalButtons() {\r\n    const rparams = document.getElementById(\"rparams\");\r\n    const selection = SelectedObjects;\r\n\r\n    // Param list not loaded or selection is not 1.\r\n    if (!rparams || selection.length != 1) {\r\n        return;\r\n    }\r\n\r\n    const getImageSize_button = '<a onclick=\"getImageSize();\" class=\"tool_btn tool_wid\" style=\"display: block; width: 100%; margin-top: 4px;\">Get image size</a>';\r\n    const centerDecorationX_button = '<a onclick=\"centerImageX();\" class=\"tool_btn tool_wid\" style=\"display: block; width: 100%; margin-top: 4px;\">Center decoration X</a>';\r\n    const centerDecorationY_button = '<a onclick=\"centerImageY();\" class=\"tool_btn tool_wid\" style=\"display: block; width: 100%; margin-top: 4px;\">Center decoration Y</a>';\r\n\r\n    if (selection[0]._class == \"bg\") {\r\n        rparams.innerHTML += getImageSize_button;\r\n    }\r\n\r\n    if (selection[0]._class == \"decor\") {\r\n        rparams.innerHTML += getImageSize_button;\r\n        rparams.innerHTML += centerDecorationX_button;\r\n        rparams.innerHTML += centerDecorationY_button;\r\n    }\r\n\r\n    if(!edit_triggers_as_text && selection[0]._class == \"trigger\" && ExtendedTriggersLoaded){\r\n        const extendTriggerAction_button = `\r\n            <div class=\"two-element-grid\">\r\n                <a onclick=\"addTriggerActionCount(1)\" class=\"tool_btn tool_wid\" style=\"display: block; width: 95%; margin-top: 4px;\">(+) Extend trigger action list.</a>\r\n                <a onclick=\"addTriggerActionCount(-1)\" class=\"tool_btn tool_wid\" style=\"display: block; width: 95%; margin-top: 4px;\">(-) Shrink trigger action list.</a>\r\n            </div>\r\n\r\n            <div class=\"two-element-grid\">\r\n                <div class=\"two-element-grid\">\r\n                    <a onclick=\"addTriggerActionCount(5)\" class=\"tool_btn tool_wid\" style=\"display: block; width: 90%; margin-top: 4px;\">(+5)</a>\r\n                    <a onclick=\"addTriggerActionCount(10)\" class=\"tool_btn tool_wid\" style=\"display: block; width: 90%; margin-top: 4px;\">(+10)</a>\r\n                </div>\r\n\r\n                <div class=\"two-element-grid\">\r\n                    <a onclick=\"addTriggerActionCount(-5)\" class=\"tool_btn tool_wid\" style=\"display: block; width: 90%; margin-top: 4px;\">(-5)</a>\r\n                    <a onclick=\"addTriggerActionCount(-10)\" class=\"tool_btn tool_wid\" style=\"display: block; width: 90%; margin-top: 4px;\">(-10)</a>\r\n                </div>\r\n            </div>\r\n        `;\r\n        rparams.innerHTML += extendTriggerAction_button;\r\n\r\n        // Update GUI to change parameter type based on trigger action.\r\n        StreetMagic();\r\n    }\r\n}\r\n\r\n/**\r\n * This function is invoked whenever users pressed the \"Extend trigger action list.\" or the \"Shrink trigger action list\" buttons.\r\n * This function is responsible for creating and maintaining extended triggers.\r\n *\r\n * @param {Number} value    The amount of trigger actions to add or subtract from the currently selected trigger,\r\n */\r\nfunction addTriggerActionCount(value){\r\n\r\n    const selection = SelectedObjects;\r\n\r\n    if (selection.length != 1 || value === 0) {\r\n        return;\r\n    }\r\n\r\n    const selectedTrigger = selection[0];\r\n\r\n    // Subtracting trigger actions from normal triggers is a no-op.\r\n    if(!selectedTrigger.pm[\"extended\"] && value < 0){\r\n        return;\r\n    }\r\n\r\n    // It is a normal trigger, let's convert it to an extended trigger.\r\n    if(!selectedTrigger.pm[\"extended\"]){\r\n        selectedTrigger.pm[\"additionalActions\"] = new Array();\r\n        selectedTrigger.pm[\"additionalParamA\"] = new Array();\r\n        selectedTrigger.pm[\"additionalParamB\"] = new Array();\r\n        selectedTrigger.pm[\"totalNumOfActions\"] = 10;\r\n        selectedTrigger.pm[\"extended\"] = true;\r\n\r\n        NewNote(\"Converted this to an extended trigger.\", note_passive);\r\n        NewNote(\"Be mindful about your number of triggers.\", note_neutral);\r\n        NewNote(\"Behind the scenes, this creates 1 trigger for every additional 9 trigger actions.\", note_neutral);\r\n    }\r\n\r\n    selectedTrigger.pm[\"totalNumOfActions\"] += value;\r\n\r\n    // It has less than 10 trigger actions, let's convert this extended trigger back to a normal trigger.\r\n    if(selectedTrigger.pm[\"totalNumOfActions\"] <= 10 || isNaN(selectedTrigger.pm[\"totalNumOfActions\"])){\r\n        delete selectedTrigger.pm[\"additionalActions\"];\r\n        delete selectedTrigger.pm[\"additionalParamA\"];\r\n        delete selectedTrigger.pm[\"additionalParamB\"];\r\n        delete selectedTrigger.pm[\"totalNumOfActions\"];\r\n        delete selectedTrigger.pm[\"extended\"];\r\n    }\r\n    // Resize arrays according to the new change in totalNumOfTriggers.\r\n    else{\r\n        if(value > 0){\r\n            selectedTrigger.pm[\"additionalActions\"].push(...Array(value).fill(-1));\r\n            selectedTrigger.pm[\"additionalParamA\"].push(...Array(value).fill(0));\r\n            selectedTrigger.pm[\"additionalParamB\"].push(...Array(value).fill(0));\r\n        }\r\n        else{\r\n            selectedTrigger.pm[\"additionalActions\"].length += value;\r\n            selectedTrigger.pm[\"additionalParamA\"].length += value;\r\n            selectedTrigger.pm[\"additionalParamB\"].length += value;\r\n        }\r\n    }\r\n\r\n    UpdateGUIParams();\r\n\r\n    // Scroll to the bottom of the trigger list.\r\n    let divElement = document.getElementById('rparams');\r\n    divElement.scrollTop = divElement.scrollHeight;\r\n}\r\n\r\nfunction getImageSize() {\r\n    let selection = SelectedObjects;\r\n    let id;\r\n\r\n    if (selection[0]._class == \"bg\") {\r\n        id = selection[0].pm.m;\r\n    }\r\n\r\n    if (selection[0]._class == \"decor\") {\r\n        id = selection[0].pm.model;\r\n    }\r\n\r\n    if (typeof id == \"string\") {\r\n        let img = document.createElement(\"img\");\r\n\r\n        img.onload = function() {\r\n            let w = img.width;\r\n            let h = img.height;\r\n\r\n            img.remove();\r\n\r\n            alert(\"W: \" + w + \"\\nH: \" + h);\r\n        }\r\n\r\n        img.onerror = function() {\r\n            img.remove();\r\n\r\n            alert(\"Image not found.\");\r\n        }\r\n\r\n        img.src = \"https://www.plazmaburst2.com/mimage_cache.php?image_id=\" + id.slice(1);\r\n    } else {\r\n        alert(\"Image not found.\");\r\n    }\r\n}\r\n\r\nfunction getImageData() {\r\n    return new Promise((res, err) => {\r\n        let selection = SelectedObjects;\r\n        let id;\r\n\r\n        if (selection[0]._class == \"bg\") {\r\n            id = selection[0].pm.m;\r\n        }\r\n\r\n        if (selection[0]._class == \"decor\") {\r\n            id = selection[0].pm.model;\r\n        }\r\n\r\n        if (typeof id == \"string\") {\r\n            let img = document.createElement(\"img\");\r\n\r\n            img.onload = function() {\r\n                let w = img.width;\r\n                let h = img.height;\r\n\r\n                let canvas = document.createElement(\"canvas\");\r\n                let ctx = canvas.getContext(\"2d\");\r\n\r\n                canvas.width = img.width;\r\n                canvas.height = img.height;\r\n\r\n                ctx.beginPath();\r\n                ctx.drawImage(img, 0, 0);\r\n                ctx.closePath();\r\n\r\n                res([ctx.getImageData(0, 0, w, h).data, w]);\r\n            }\r\n\r\n            img.onerror = function() {\r\n                img.remove();\r\n\r\n                alert(\"Image not found.\");\r\n\r\n                res(1);\r\n            }\r\n\r\n            img.src = \"https://www.plazmaburst2.com/mimage_cache.php?image_id=\" + id.slice(1);\r\n        } else {\r\n            alert(\"Image not found.\");\r\n\r\n            res(1);\r\n        }\r\n    });\r\n}\r\n\r\nfunction arrMin(arr) {\r\n    let min = Infinity;\r\n\r\n    for (let i = 0; i < arr.length; i++) {\r\n        if (arr[i] < min) {\r\n            min = arr[i];\r\n        }\r\n    }\r\n\r\n    return min;\r\n}\r\n\r\nfunction arrMax(arr) {\r\n    let max = -Infinity;\r\n\r\n    for (let i = 0; i < arr.length; i++) {\r\n        if (arr[i] > max) {\r\n            max = arr[i];\r\n        }\r\n    }\r\n\r\n    return max;\r\n}\r\n\r\nfunction getImagePosition(data, w) {\r\n    let arrX = [];\r\n    let arrY = [];\r\n\r\n    let minX;\r\n    let minY;\r\n    let maxX;\r\n    let maxY;\r\n\r\n    let centerX = 0;\r\n    let centerY = 0;\r\n\r\n    if (data != 1) {\r\n        for (let i = 0; i < data.length; i += 4) {\r\n            if (data[i + 3] >= 3) {\r\n                let x = (i / 4) % w;\r\n                let y = Math.floor(i / 4 / w);\r\n\r\n                arrX.push(x);\r\n                arrY.push(y);\r\n            }\r\n        }\r\n\r\n        minX = arrMin(arrX);\r\n        minY = arrMin(arrY);\r\n        maxX = arrMax(arrX);\r\n        maxY = arrMax(arrY);\r\n\r\n        centerX = (minX + maxX) / 2;\r\n        centerY = (minY + maxY) / 2;\r\n    }\r\n\r\n    return {\r\n        x: centerX,\r\n        y: centerY\r\n    }\r\n}\r\n\r\nfunction setDecorOffset(x, y) {\r\n    let selection = SelectedObjects;\r\n\r\n    selection[0].pm.u = x;\r\n    selection[0].pm.v = y;\r\n}\r\n\r\nfunction centerImageX() {\r\n    let selection = SelectedObjects;\r\n\r\n    if (selection.length == 1) {\r\n        if (selection[0]._class == \"decor\") {\r\n            getImageData().then(res => {\r\n                if (res != 1) {\r\n                    let center = getImagePosition(res[0], res[1]);\r\n                    let x = center.x;\r\n\r\n                    setDecorOffset(-x, selection[0].pm.v);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    need_redraw = 1;\r\n    need_GUIParams_update = 1;\r\n}\r\n\r\nfunction centerImageY() {\r\n    let selection = SelectedObjects;\r\n\r\n    if (selection.length == 1) {\r\n        if (selection[0]._class == \"decor\") {\r\n            getImageData().then(res => {\r\n                if (res != 1) {\r\n                    let center = getImagePosition(res[0], res[1]);\r\n                    let y = center.y;\r\n\r\n                    setDecorOffset(selection[0].pm.u, -y);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    need_redraw = 1;\r\n    need_GUIParams_update = 1;\r\n}\r\n\r\nfunction addFunctionToWindow() {\r\n    window.getImageSize = getImageSize;\r\n    window.centerImageX = centerImageX;\r\n    window.centerImageY = centerImageY;\r\n    window.addTriggerActionCount = addTriggerActionCount;\r\n}\r\n\r\nlet newUpdate = 0;\r\n\r\nlet targetElement;\r\n\r\ndocument.addEventListener(\"mousedown\", e => {\r\n    targetElement = e.target;\r\n});\r\n\r\ndocument.addEventListener(\"keydown\", e => {\r\n    if(e.ctrlKey && e.code == \"KeyA\" && canvas_focus) {\r\n        window.es.map(e => {\r\n            if((e.exists) && (e._isphysical) && (MatchLayer(e))) {\r\n                e.selected = true;\r\n            }\r\n            window.need_redraw = true;\r\n            window.need_GUIParams_update = true;\r\n        });\r\n    }\r\n    if (e.ctrlKey && e.code == \"KeyS\" && canvas_focus) {\r\n        e.preventDefault();\r\n        document.getElementsByClassName(\"field_btn\")[0].click();\r\n    }\r\n\r\n    if (e.ctrlKey && e.code == \"KeyF\" && canvas_focus) {\r\n        e.preventDefault();\r\n\r\n        let name = prompt(\"Find objects:\", \"\");\r\n\r\n        if (name !== null && name !== \"\") {\r\n            let notFound = findObjects(name);\r\n\r\n            if (notFound) {\r\n                alert(\"Nothing found.\");\r\n            }\r\n        }\r\n    }\r\n\r\n    if (e.code == \"KeyR\" && targetElement != \"[object HTMLInputElement]\" && targetElement.id != \"opcode_field\") {\r\n        if (!isOnlyTriggerSelected()) {\r\n            rotateObjects();\r\n        }\r\n    }\r\n\r\n    if (e.ctrlKey && e.code == \"KeyR\" && canvas_focus) {\r\n        if (isOnlyTriggerSelected() && !isNothingSelected()) {\r\n            e.preventDefault();\r\n\r\n            reverseTriggerActions();\r\n            unselectTriggerActions();\r\n        }\r\n    }\r\n\r\n    if ((e.code == \"Minus\" || e.code == \"NumpadSubtract\") && e.ctrlKey && canvas_focus) {\r\n        e.preventDefault();\r\n\r\n        zoom *= 2;\r\n        zoom_validate();\r\n        need_redraw = 1;\r\n    }\r\n\r\n    if ((e.code == \"Equal\" || e.code == \"NumpadAdd\") && e.ctrlKey && canvas_focus) {\r\n        e.preventDefault();\r\n\r\n        zoom *= 0.5;\r\n        zoom_validate();\r\n        need_redraw = 1;\r\n    }\r\n\r\n    if (e.ctrlKey && e.altKey) {\r\n        e.preventDefault();\r\n\r\n        zoom = 1;\r\n        zoom_validate();\r\n        need_redraw = 1;\r\n    }\r\n\r\n    if (e.code == \"KeyH\" && e.ctrlKey) {\r\n        e.preventDefault();\r\n\r\n        if (targetElement.id === \"opcode_field\") {\r\n            let value = targetElement.value;\r\n\r\n            let str1 = prompt(\"Enter string to replace from:\", \"\");\r\n            if (!str1) return;\r\n\r\n            let str2 = prompt(\"Enter string to replace to:\", str1);\r\n            if (!str2) return;\r\n\r\n            targetElement.value = value.replaceAll(str1, str2);\r\n        }\r\n    }\r\n\r\n    if (e.code == \"Enter\" && targetElement != \"[object HTMLInputElement]\" && targetElement.id != \"opcode_field\" && canvas_focus) {\r\n        let selected = SelectedObjects;\r\n\r\n        if (selected.length != 0) {\r\n            let param = prompt(\"Enter parameter name:\", \"\");\r\n\r\n            if (param) {\r\n                let expression = prompt(\"Enter expression:\", \"\");\r\n\r\n                if (expression) {\r\n                    param = param.toLowerCase().replace(\"width\", \"w\").replace(\"height\", \"h\");\r\n\r\n                    for (let i = 0; i < selected.length; i++) {\r\n                        let x = selected[i].pm.x;\r\n                        let y = selected[i].pm.y;\r\n                        let w = selected[i].pm.w;\r\n                        let h = selected[i].pm.h;\r\n\r\n                        if (x === undefined) {\r\n                            x = 0;\r\n                        }\r\n\r\n                        if (y === undefined) {\r\n                            y = 0;\r\n                        }\r\n\r\n                        if (w === undefined) {\r\n                            w = 0;\r\n                        }\r\n\r\n                        if (h === undefined) {\r\n                            h = 0;\r\n                        }\r\n\r\n                        if (selected[i].pm[param] !== undefined) {\r\n                            let parsed = (0,_alescript_js__WEBPACK_IMPORTED_MODULE_1__.parse)(expression, [x, y, w, h, i]);\r\n\r\n                            if (typeof parsed == \"number\") {\r\n                                for (let j = 0; j < selected.length; j++) {\r\n                                    selected[j].selected = 0;\r\n                                }\r\n\r\n                                selected[i].selected = 1;\r\n\r\n                                UpdatePhysicalParam(param, parsed);\r\n                            }\r\n\r\n                            for (let j = 0; j < selected.length; j++) {\r\n                                selected[j].selected = 1;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    need_GUIParams_update = 1;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (e.altKey) {\r\n        e.preventDefault();\r\n    }\r\n\r\n    if (e.altKey && targetElement == \"[object HTMLInputElement]\") {\r\n        let selected = SelectedObjects;\r\n\r\n        if (selected.length == 1) {\r\n            let x = selected[0].pm.x;\r\n            let y = selected[0].pm.y;\r\n            let w = selected[0].pm.w;\r\n            let h = selected[0].pm.h;\r\n\r\n            if (x === undefined) {\r\n                x = 0;\r\n            }\r\n\r\n            if (y === undefined) {\r\n                y = 0;\r\n            }\r\n\r\n            if (w === undefined) {\r\n                w = 0;\r\n            }\r\n\r\n            if (h === undefined) {\r\n                h = 0;\r\n            }\r\n\r\n            // i is undefined and i'm pretty sure it's not supposed to be like that. so this definitely doesn't work how it should.\r\n            // i'll just leave it cuz idk how it's supposed to be and it doesn't throw an error because of some implicit globals from vanilla ale\r\n            let parsed = (0,_alescript_js__WEBPACK_IMPORTED_MODULE_1__.parse)(targetElement.value, [x, y, w, h, i]);\r\n\r\n            if (typeof parsed == \"number\") {\r\n                targetElement.value = parsed;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (e.ctrlKey && e.code == \"KeyP\") {\r\n        e.preventDefault();\r\n\r\n        copyToPermanentClipboard();\r\n    }\r\n\r\n    if (e.ctrlKey && e.shiftKey) {\r\n        if (newUpdate) {\r\n            window.open(\"https://github.com/LisABC/ALEI/raw/main/alei.user.js\");\r\n            newUpdate = false;\r\n        }\r\n    }\r\n});\r\n\r\nfunction doTooltip() {\r\n    let tooltip = document.createElement(\"p\");\r\n    tooltip.id = \"ALEI_tooltip\";\r\n\r\n    document.body.append(tooltip);\r\n\r\n    document.addEventListener(\"mousemove\", e => {\r\n        if (e.target.title) {\r\n            e.target.dataset.title = e.target.title;\r\n            e.target.title = \"\";\r\n        }\r\n\r\n        if (e.target.parentElement.title) {\r\n            e.target.parentElement.dataset.title = e.target.parentElement.title;\r\n            e.target.parentElement.title = \"\";\r\n        }\r\n        let leftOffset = 150\r\n\r\n        if (e.target.dataset.title) {\r\n            let to = e.target.dataset.title.length\r\n            tooltip.style.left = to + leftOffset + e.clientX + 20 + \"px\";\r\n            tooltip.innerHTML = e.target.dataset.title;\r\n\r\n            if (tooltip.getBoundingClientRect().height != 31) {\r\n                tooltip.style.left = to + leftOffset + e.clientX - 20 - tooltip.getBoundingClientRect().width + \"px\";\r\n            }\r\n        } else if (e.target.parentElement.dataset.title) {\r\n            let to = e.target.parentElement.dataset.title.length\r\n            tooltip.style.left = to + leftOffset + e.clientX + 20 + \"px\";\r\n            tooltip.style.top = e.clientY + \"px\";\r\n            tooltip.innerHTML = e.target.parentElement.dataset.title;\r\n\r\n            if (tooltip.getBoundingClientRect().height != 31) {\r\n                tooltip.style.left = to + leftOffset + e.clientX - 20 - tooltip.getBoundingClientRect().width + \"px\";\r\n            }\r\n        } else {\r\n            tooltip.style.left = -100 + leftOffset + \"px\";\r\n            tooltip.style.top = \"-100px\";\r\n        }\r\n    });\r\n    aleiLog(DEBUG, \"Added tooltip.\")\r\n}\r\n\r\nfunction patchDecorUpload() {\r\n    // Allows for multiple uploads.\r\n    let imageLoader = $id(\"imageLoader\");\r\n    // First we make it allow multiple files and remove original event listener.\r\n    imageLoader.setAttribute(\"multiple\", true);\r\n    imageLoader.removeEventListener(\"change\", handleImage);\r\n    // Then we register our own.\r\n    imageLoader.addEventListener(\"change\", function(e) {\r\n        let files = e.target.files;\r\n        NewNote(`ALEI: Will upload ${files.length} bg/decor(s).`, \"#2595FF\");\r\n        for (let file of files) {\r\n            let arg = {target: {files: [file]}};\r\n            handleImage(arg); // Call original function\r\n        }\r\n    }, false)\r\n}\r\n\r\nfunction setParameter(index, value) {\r\n    let rightParams = document.getElementById(\"rparams\");\r\n    if(rightParams == undefined) return;\r\n    if(rightParams == null) return;\r\n\r\n    if(index > 13) {\r\n        let isAllTrigger = SelectedObjects.map(o => (o._class == \"trigger\"));\r\n        if(isAllTrigger.indexOf(false) !== -1) return;\r\n        function getActionCount(elem) {\r\n            if(elem.isExtended) return elem.pm.totalNumOfActions;\r\n            else return 10;\r\n        }\r\n        let minimumActionCount = Math.min(...SelectedObjects.map(o => getActionCount(o)));\r\n        if(index >= (minimumActionCount * 3 + Trigger_getSeparatorStart(SelectedObjects.length) - 1)) return;\r\n    }\r\n\r\n    let actualIndex = 0; // We will bruteforce.\r\n    let i = 0;\r\n    while(i < index) {\r\n        i++;\r\n        actualIndex++;\r\n\r\n        if(rightParams.childNodes[actualIndex] == undefined) continue;\r\n        if(rightParams.childNodes[actualIndex].childNodes[1] === undefined) actualIndex++;\r\n    }\r\n\r\n    if (actualIndex < rightParams.childNodes.length) {\r\n        rightParams.childNodes[actualIndex].childNodes[1].innerHTML = value;\r\n    }\r\n}\r\n\r\nfunction getSelection() { // DEPRECATED! USE SelectedObjects DIRECTLY!\r\n    return SelectedObjects;\r\n}\r\n\r\nfunction areObjectsOfSameType(objects) {\r\n    let same = 1;\r\n\r\n    for (let i = 0; i < objects.length; i++) {\r\n        if (objects[i]._class != objects[0]._class) {\r\n            same = 0;\r\n        }\r\n    }\r\n\r\n    return same;\r\n}\r\n\r\nfunction removeSameItems(array) {\r\n    return Array.from(new Set(array));\r\n}\r\n\r\nfunction removeItems(array, items) {\r\n    let copy = JSON.parse(JSON.stringify(array));\r\n\r\n    for (let i = 0; i < items.length; i++) {\r\n        copy.splice(copy.indexOf(items[i]), 1);\r\n    }\r\n\r\n    return copy;\r\n}\r\n\r\nfunction parameterNamesToIndexes(parameters, objectParameters) {\r\n    let indexes = [];\r\n\r\n    for (let i = 0; i < parameters.length; i++) {\r\n        indexes.push(objectParameters.indexOf(parameters[i]));\r\n    }\r\n\r\n    return indexes;\r\n}\r\n\r\nfunction getSameParameters(objects) {\r\n    let differentParameters = [];\r\n    let parameters = Object.keys(objects[0].pm);\r\n\r\n    for (let i = 0; i < objects.length; i++) {\r\n        for (let j = 0; j < parameters.length; j++) {\r\n            if (objects[i].pm[parameters[j]] != objects[0].pm[parameters[j]]) {\r\n                differentParameters.push(parameters[j]);\r\n            }\r\n        }\r\n    }\r\n\r\n    differentParameters = removeSameItems(differentParameters);\r\n    differentParameters = removeItems(parameters, differentParameters);\r\n\r\n    return parameterNamesToIndexes(differentParameters, parameters);\r\n}\r\n\r\nfunction toBoolean(str) {\r\n    if (isNaN(Number(str))) {\r\n        return str == \"true\";\r\n    } else {\r\n        return Boolean(str);\r\n    }\r\n}\r\n\r\nconst parameterMap = {\r\n    \"box\": {\"m\": \"box_model\"},\r\n    \"door\": {\r\n        \"moving\": \"bool\",\r\n        \"vis\": \"bool\"\r\n    },\r\n    \"region\": {\"use_on\": \"region_activation\"},\r\n    \"decor\": {\r\n        \"f\": \"draw_in_front\",\r\n        \"model\": \"decor_model\"\r\n    },\r\n    \"bg\": {\r\n        \"s\": \"bool\",\r\n        \"f\": \"draw_in_front\",\r\n        \"m\": \"bg_model\"\r\n    },\r\n    \"water\": {\"friction\": \"bool\"},\r\n    \"trigger\": {\"enabled\": \"bool\"},\r\n    \"timer\": {\"enabled\": \"bool\"},\r\n    \"gun\": {\r\n        \"command\": \"team+any\",\r\n        \"upg\": \"gun_upgrade\",\r\n        \"model\": \"gun_model\"\r\n    },\r\n    \"barrel\": {\"model\": \"barrel_model\"},\r\n    \"lamp\": {\"flare\": \"bool\"},\r\n    \"vehicle\": {\"model\": \"vehicle_model\"}\r\n}\r\n\r\nfunction fixParameterValue(name, value, objectType) {\r\n    let fixedValue;\r\n\r\n    if (VAL_TABLE[name]) {\r\n        fixedValue = VAL_TABLE[name][value];\r\n    } else {\r\n        if (parameterMap[objectType] && parameterMap[objectType][name]) {\r\n            fixedValue = VAL_TABLE[ parameterMap[objectType][name] ][value];\r\n        }else if (name.slice(0, 8) == \"actions_\" && name.slice(-5) == \"_type\") {\r\n            fixedValue = VAL_TABLE[\"trigger_type\"][value];\r\n        }else {\r\n            fixedValue = value;\r\n        }\r\n    }\r\n\r\n    return fixedValue;\r\n}\r\n\r\nfunction setSameParameters() {\r\n    let objects = getSelection();\r\n\r\n    if (areObjectsOfSameType(objects) && objects.length >= 2) {\r\n        let indexes = getSameParameters(objects);\r\n        let parameters = Object.keys(objects[0].pm);\r\n\r\n        for (let i = 0; i < indexes.length; i++) {\r\n            let name = parameters[indexes[i]];\r\n            let value = objects[0].pm[parameters[indexes[i]]];\r\n            let objectType = objects[0]._class;\r\n\r\n            setParameter(indexes[i], fixParameterValue(name, value, objectType));\r\n        }\r\n    }\r\n}\r\n\r\nfunction patchANI() {\r\n    let oldAni = ani;\r\n    window.ani = function() {\r\n        let ngpu = need_GUIParams_update;\r\n        oldAni();\r\n        if (ngpu) {\r\n            if (aleiSettings.showSameParameters) setSameParameters();\r\n        }\r\n    }\r\n    aleiLog(DEBUG, \"Patched ANI\");\r\n}\r\n\r\n///////////////////////////////\r\n\r\nfunction updateBoxSplitterSize() {\r\n    let obj = $id(\"gui_objbox\");\r\n    let rect = obj.getBoundingClientRect();\r\n    let style = splitter2.style;\r\n    style.setProperty(\"width\", rect.width);\r\n    style.setProperty(\"left\", rect.x);\r\n    style.setProperty(\"top\", rect.bottom);\r\n}\r\n\r\nfunction addObjBoxResize() {\r\n    let obj = $id(\"gui_objbox\");\r\n    let splitter = document.createElement(\"div\");\r\n    window.splitter2 = splitter;\r\n    let style = splitter.style;\r\n    $id(\"floattag\").appendChild(splitter);\r\n\r\n    style.setProperty(\"position\", \"absolute\");\r\n    style.setProperty(\"height\", \"5px\");\r\n    style.setProperty(\"cursor\", \"s-resize\");\r\n\r\n    updateBoxSplitterSize();\r\n\r\n    let splitterClicking = false;\r\n    splitter.onmousedown = ((e) => {splitterClicking = true});\r\n    ROOT_ELEMENT.addEventListener(\"mouseup\", (e) => {splitterClicking = false});\r\n    ROOT_ELEMENT.addEventListener(\"mousemove\", (e) => {\r\n        if (!splitterClicking) return;\r\n\r\n        let new_height = e.clientY - 90;\r\n        obj.style.height = new_height;\r\n        updateBoxSplitterSize();\r\n        ShowHideObjectBox();\r\n        ShowHideObjectBox();\r\n    });\r\n    aleiLog(DEBUG, \"Added splitter for object box.\");\r\n}\r\n\r\nfunction patch_m_down() {\r\n    let og_mdown = window.m_down;\r\n    window.m_down = function(e) {\r\n        let previousEsLength = es.length;\r\n        og_mdown(e);\r\n\r\n        let ocm = ObjectConnectionMapping;\r\n        let utem = uidToElementMap;\r\n        let addedObjects = [];\r\n\r\n        if (es.length > previousEsLength) { // New element is made.\r\n            let element = es[es.length - 1];\r\n            if (!(\"x\" in element.pm)) return;\r\n            // We now have to do job of fixPos, we cannot set fixPos to have it argument-based directly because of scoping\r\n            // So we have to do it ourselves.\r\n            let pm = element.pm;\r\n            let round = function(num) {\r\n                return Math.round(num / GRID_SNAPPING) * GRID_SNAPPING\r\n            }\r\n            pm.x = round(pm.x);\r\n            pm.y = round(pm.y);\r\n            if (element._isresizable) {\r\n                pm.w = round(pm.w);\r\n                pm.h = round(pm.h);\r\n            }\r\n            // OCM mapping.\r\n            if(aleiSettings.ocmEnabled) {\r\n                for(let i = previousEsLength; i < es.length; i++) {\r\n                    ocm[es[i].pm.uid] = {\"by\": [], \"to\": []};\r\n                    utem[es[i].pm.uid] = es[i];\r\n                    addedObjects.push(es[i]);\r\n                }\r\n            }\r\n            // Now we just update.\r\n            window.need_GUIParams_update = true;\r\n            UpdateGUIObjectsList();\r\n        }\r\n        for(let obj of addedObjects) __OCM_HandleObject(obj); // I know I don't have to do this but I am careless right now.\r\n    }\r\n}\r\n\r\nfunction ReorderTriggerProperty(result) {\r\n    let execute = result.pm.execute;\r\n    execute = execute ? execute : false;\r\n\r\n    delete result.pm.execute;\r\n\r\n    let entries = Object.entries(result.pm);\r\n    entries.splice(5, 0, [\"execute\", execute]);\r\n    result.pm = Object.fromEntries(entries);\r\n}\r\n\r\nwindow.SelectedObjects = [];\r\n\r\nfunction patchEntityClass() {\r\n    function cleanUpSO() {\r\n        setTimeout(cleanUpSO, 5 * 1000);\r\n        // Manually trigger select change if required.\r\n        for(let i = 0; i < SelectedObjects.length; i++) {\r\n            let e = SelectedObjects[i];\r\n            if(!e.selected) {\r\n                e.selectChange(false, true);\r\n            }\r\n        }\r\n    }\r\n    // For some reason, there can be unselected objects in SelectedObjects, still, and sometimes indexes can be off bound, we have to fix it too.\r\n    setTimeout(cleanUpSO, 5 * 1000);\r\n\r\n    let og_E = E;\r\n    window.E = function(_class) {\r\n        let result = new og_E(_class);\r\n\r\n        // Adding property.\r\n        if(_class == \"water\") result.pm.attach = -1;\r\n        else if(_class == \"decor\") result.pm.text = \"Hello World!\";\r\n        else if(_class == \"trigger\") {\r\n            ReorderTriggerProperty(result);\r\n        }\r\n        else if(_class == \"region\") result.pm.uses_timer = false;\r\n\r\n        result.fixPos = function() {}; // For proper snapping.\r\n        result.selectChange = function(isSelected, force = false) {\r\n            if((isSelected && (!result.selected || force))) {\r\n                SelectedObjects.push(result);\r\n                result.selected = true;\r\n            } else if(!isSelected && (result.selected || force)) {\r\n                SelectedObjects.splice(SelectedObjects.indexOf(result), 1);\r\n                result.selected = false;\r\n            }\r\n        }\r\n\r\n        function ProxySet(_, key, value) {\r\n            if(key == \"selected\") result.selectChange(value);\r\n            else result[key] = value;\r\n            return true;\r\n        }\r\n\r\n        result.Remove = () => { // Better be safe...\r\n            NewNote(`ALEI: This absolutely should not happen, please report to ALEI developers, error: E.Remove got called when it shouldn't be`, `#FF0000`);\r\n            debugger;\r\n        };\r\n\r\n        let proxy = new Proxy(result, {\r\n            set: ProxySet\r\n        })\r\n        return proxy;\r\n    }\r\n    aleiLog(DEBUG, \"Patched entity.\");\r\n}\r\n\r\nfunction PasteFromClipBoard(ClipName) {\r\n    var clipboard = new Object();\r\n    if (sessionStorage[ClipName] == undefined) {\r\n        return false;\r\n    }\r\n    clipboard = unserialize(sessionStorage[ClipName]);\r\n    lcz();\r\n    for (var i = 0; i < es.length; i++)\r\n        if (es[i].exists) {\r\n            if (es[i].selected) {\r\n                ldn('es[' + i + '].selected=false;');\r\n                lnd('es[' + i + '].selected=true;');\r\n                es[i].selected = false;\r\n            }\r\n        } var min_x = 0;\r\n    var max_x = 0;\r\n    var min_y = 0;\r\n    var max_y = 0;\r\n    i = 0;\r\n    var from_obj = es.length;\r\n    while (typeof(clipboard[i]) !== 'undefined') {\r\n        var newparam = es.length;\r\n        ldn('es[' + newparam + '].exists=true;');\r\n        lnd('es[' + newparam + '].exists=false;');\r\n        es[newparam] = new E(clipboard[i]._class);\r\n        for (let param in clipboard[i]) {\r\n            es[newparam][param] = clipboard[i][param];\r\n        }\r\n        if (typeof(es[newparam].pm.x) !== 'undefined')\r\n            if (typeof(es[newparam].pm.y) !== 'undefined') {\r\n                if (i == 0) {\r\n                    min_x = es[newparam].pm.x;\r\n                    min_y = es[newparam].pm.y;\r\n                    max_x = es[newparam].pm.x;\r\n                    max_y = es[newparam].pm.y;\r\n                    if (typeof(es[newparam].pm.w) !== 'undefined')\r\n                        if (typeof(es[newparam].pm.h) !== 'undefined') {\r\n                            min_x += es[newparam].pm.w / 2;\r\n                            max_x += es[newparam].pm.w / 2;\r\n                            min_y += es[newparam].pm.h / 2;\r\n                            max_y += es[newparam].pm.h / 2;\r\n                        }\r\n                } else {\r\n                    min_x = Math.min(min_x, es[newparam].pm.x);\r\n                    min_y = Math.min(min_y, es[newparam].pm.y);\r\n                    max_x = Math.max(max_x, es[newparam].pm.x);\r\n                    max_y = Math.max(max_y, es[newparam].pm.y);\r\n                    if (typeof(es[newparam].pm.w) !== 'undefined')\r\n                        if (typeof(es[newparam].pm.h) !== 'undefined') {\r\n                            max_x = Math.max(max_x, es[newparam].pm.x + es[newparam].pm.w);\r\n                            max_y = Math.max(max_y, es[newparam].pm.y + es[newparam].pm.h);\r\n                        }\r\n                }\r\n            } i++;\r\n    }\r\n    ldn('m_drag_selected=true;');\r\n    ldn('paint_draw_mode=true;');\r\n    ldn('quick_pick_ignore_one_click=true;');\r\n    lnd('m_drag_selected=false;');\r\n    lnd('paint_draw_mode=false;');\r\n    lnd('quick_pick_ignore_one_click=false;');\r\n    ldis = true;\r\n    paint_draw_mode = true;\r\n    quick_pick_ignore_one_click = true;\r\n    lmdrwa = lmwa;\r\n    lmdrwb = lmwb;\r\n    // Original code by Prosu\r\n    let m_pos_x = lmwa;\r\n    let m_pos_y = lmwb;\r\n\r\n    m_drag_x = mouse_x;\r\n    m_drag_y = mouse_y;\r\n    let m_down_x = m_pos_x;\r\n    let m_down_y = m_pos_y;\r\n    var x1 = Math.round((m_pos_x) / GRID_SNAPPING) * GRID_SNAPPING;\r\n    var y1 = Math.round((m_pos_y) / GRID_SNAPPING) * GRID_SNAPPING;\r\n    var lo_x = Math.round((x1 - (min_x + max_x) / 2) / GRID_SNAPPING) * GRID_SNAPPING;\r\n    var lo_y = Math.round((y1 - (min_y + max_y) / 2) / GRID_SNAPPING) * GRID_SNAPPING;\r\n\r\n    let ocm = ObjectConnectionMapping;\r\n    let utem = uidToElementMap;\r\n\r\n    let addedObjects = [];\r\n\r\n    for (var i2 = from_obj; i2 < es.length; i2++) {\r\n        if (typeof(es[i2].pm.uid) !== 'undefined') {\r\n            var old_uid = es[i2].pm.uid;\r\n            es[i2].exists = true;\r\n            es[i2].pm.uid = RandomizeName(es[i2].pm.uid);\r\n\r\n\r\n            for (var i3 = from_obj; i3 < es.length; i3++) {\r\n                for (let param in es[i3].pm) {\r\n                    es[i3].pm[param] = UUIDR_Replace(es[i3].pm[param], old_uid, es[i2].pm.uid);\r\n                }\r\n            }\r\n\r\n            if(aleiSettings.ocmEnabled) {\r\n                ocm[es[i2].pm.uid] = {\"by\": [], \"to\": []};\r\n                utem[es[i2].pm.uid] = es[i2];\r\n                addedObjects.push(es[i2]);\r\n            }\r\n        }\r\n        if (typeof(es[i2].pm.x) !== 'undefined')\r\n            if (typeof(es[i2].pm.y) !== 'undefined') {\r\n                lnd('es[' + i2 + '].pm.x=' + es[i2].pm.x + ';');\r\n                lnd('es[' + i2 + '].pm.y=' + es[i2].pm.y + ';');\r\n                es[i2].pm.x += lo_x;\r\n                es[i2].pm.y += lo_y;\r\n                es[i2].fixPos();\r\n                ldn('es[' + i2 + '].pm.x=' + es[i2].pm.x + ';');\r\n                ldn('es[' + i2 + '].pm.y=' + es[i2].pm.y + ';');\r\n            }\r\n    }\r\n    // Again by Prosu\r\n    x1 = Math.round((m_pos_x - m_down_x) / GRID_SNAPPING) * GRID_SNAPPING;\r\n    y1 = Math.round((m_pos_y - m_down_y) / GRID_SNAPPING) * GRID_SNAPPING;\r\n    for (var i = 0; i < es.length; i++) {\r\n        if (es[i]._isphysical && es[i].exists && es[i].selected && (MatchLayer(es[i]) || paint_draw_mode)) {\r\n            es[i].pm.x += x1;\r\n            es[i].pm.y += y1;\r\n        }\r\n    }\r\n    m_down_x += x1;\r\n    m_down_y += y1;\r\n    lfz(false);\r\n    for(let obj of addedObjects) __OCM_HandleObject(obj);\r\n    assignObjectIDs();\r\n    assignObjectPriority();\r\n    window.need_redraw = true;\r\n    window.need_GUIParams_update = true;\r\n    return true;\r\n}\r\n\r\nfunction ServerRequest_handleMapData(mapCode) {\r\n    // Branch of patchServerRequest\r\n    // Made to deal with map source related things.\r\n    aleiLog(DEBUG, \"Parsing map source now.\");\r\n\r\n    const objectKeyValueRegex = /(\\w+)=((-?\\d+(\\.\\d+)?)|(\"[ -~]*\")|true|false)/;\r\n    const objectCreationRegex = /q=es\\[\\d+\\]=new E\\(\"(\\w+)\"\\)/;\r\n\r\n    let expressions = mapCode.split(\";\\n\");\r\n\r\n    let currentElement = null;\r\n\r\n    window.es = new Array(); // clear.\r\n    let index = 2; // We skip var q; and es = new Array();\r\n    for (;index < expressions.length; index++) {\r\n        let expression = expressions[index];\r\n\r\n        // Skip if it's just only tab or newlines\r\n        if(expression.replaceAll(\"\\n\", \"\").replaceAll(\"\\t\", \"\").length == 0) {continue};\r\n\r\n        // Map ID related stuff.\r\n        if (expression.indexOf(\"mapid = '\") != -1) {\r\n            window.mapid = expression.split(\" = \")[1].slice(1, -1);\r\n            mapid_field.value = mapid;\r\n            continue;\r\n        }\r\n        else if (expression == \"\\t\\tmapid_field.value = mapid\") {continue;}\r\n        else if (expression.indexOf(\"maprights.innerHTML='\") != -1) {\r\n            let rights = expression.split(\";\")[0].split(\".innerHTML=\")[1].slice(1, -1);\r\n            maprights.value = rights;\r\n            NewNote(`Map '${mapid}' has been successfully loaded.`, note_good);\r\n            continue\r\n        }\r\n        // Actual mapdata.\r\n        if(expression.indexOf(\";q=q.pm;\") != -1) { // Creation which is q=es[...]=new E(...);q=q.pm;q.(...)=(...);\r\n            let creation = objectCreationRegex.exec(expression);\r\n            currentElement = new E(creation[1]);\r\n            es[es.length] = currentElement;\r\n\r\n            let splt = expression.split(\";\");\r\n            if (splt.length > 3) {\r\n                // There is supposed to be only 3 ;'s\r\n                // initializing;setting;firstProperty\r\n                // Assuming that server only gives first property and does not send more than 1 in creation line\r\n                aleiLog(WARN, `Expected 3 items, got ${splt.length} - ${splt}`);\r\n                continue;\r\n            }\r\n            expression = splt[2];\r\n        };\r\n        // Key value\r\n        // In format of q.(___)=(___);\r\n        let matchKeyValue = objectKeyValueRegex.exec(expression);\r\n\r\n        if (matchKeyValue === null) {\r\n            aleiLog(WARN, `Unable to figure out what kind of code is \"${expression}\", you MIGHT have issues.`);\r\n            continue;\r\n        }\r\n        let key = matchKeyValue[1];\r\n        let value = matchKeyValue[2].replaceAll(\"\\\\/\", \"/\");\r\n        if (value[0] != '\"') { // Not a string.\r\n            if (value == \"true\") value = true;\r\n            else if(value == \"false\") value = false;\r\n            else if(value.indexOf(\".\") != -1) value = parseFloat(value);\r\n            else value = parseInt(value);\r\n        } else {\r\n            // Is a string. We just strip quotation marks and fix apostrophes.\r\n            value = value.slice(1, -1).replaceAll(\"\\\\'\", \"'\");\r\n        }\r\n        currentElement.pm[key] = value;\r\n\r\n    }\r\n    if(aleiSettings.extendedTriggers) parseExtendedTriggers();\r\n}\r\n\r\nfunction handleServerRequestResponse(request, operation, response) {\r\n    if (response.indexOf(\"var es = new Array();\") != -1) {\r\n        window.SelectedObjects = [];\r\n        OCM_LOADED = false;\r\n        ServerRequest_handleMapData(response);\r\n        CreateConnectionMapping();\r\n    }else if (response.indexOf(\"knownmaps = [\") !== -1) {\r\n        window.knownmaps = [];\r\n        for (let map of response.match(/\"(.*?)\"/g)) {\r\n            knownmaps.push(map.slice(1, -1))\r\n        }\r\n        aleiLog(DEBUG, `Updated knownmaps with ${knownmaps.length} maps`);\r\n    }else {\r\n        aleiLog(DEBUG2, `Evaling for request ${ANSI_YELLOW}\"${request}\"${ANSI_RESET} with operation of ${ANSI_YELLOW}\"${operation}\"${ANSI_RESET}: ${response}`)\r\n        try {JS_eval(response);}\r\n        catch(e) {NewNote(\"Eval error!\", note_bad); console.error(e); aleiLog(INFO, `Eval Error from ${request}, for op ${operation} whose response is ${response}`)}\r\n    };\r\n}\r\n\r\nfunction makeRequest(method, url, data) {\r\n    return new Promise(function (resolve, reject) {\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.open(method, url);\r\n        xhr.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\r\n        xhr.onload = function () {\r\n            if (this.status >= 200 && this.status < 300) {\r\n                resolve({status: 200, response: xhr.response});\r\n            } else {\r\n                reject({\r\n                    status: this.status,\r\n                    statusText: xhr.statusText\r\n                });\r\n            }\r\n        };\r\n        xhr.onerror = function () {\r\n            reject({\r\n                status: this.status,\r\n                statusText: xhr.statusText\r\n            });\r\n        };\r\n        xhr.send(data);\r\n    });\r\n}\r\n\r\nfunction updateDecorList() {\r\n    try {\r\n        let list_native = $id(\"list_native\");\r\n        for(let i = 0; i < ALEI_decors.length; i++) {\r\n            let decor = ALEI_decors[i];\r\n            let decor_model = decor[0];\r\n            let decor_name = decor[1];\r\n            let decor_image = decor[2];\r\n            list_native.innerHTML += `\r\n                    <div class=\"img_option\" onClick=\"CustomImageSelected('${decor_model}', '${decor_name}' )\">\r\n                       <div class=\"imgdiv\" style=\"background:url(${decor_image})\"></div>\r\n                       <div>\r\n                         ${decor_name}\r\n                       </div>\r\n                    </div>\r\n                    `\r\n        }\r\n        aleiLog(DEBUG, \"Updated decor list.\");\r\n    }\r\n    catch(e) {} // We assume we are not in decor list yet.\r\n}\r\n\r\nasync function ALEI_ServerRequest(request, operation, callback = null) {\r\n    let response = await makeRequest(\"POST\", `e_server.php?a=${request_a}`, request);\r\n\r\n    if (response.status != 200) {\r\n        if (operation == 'save') NewNote('Oops! Error occoured during saving. Usually it may be happening due to connection problems. Map will be temporary saved to your computer\\'s LocalStorage', note_bad);\r\n        else if (operation == 'load') NewNote('Oops! Error occoured durning loading. Usually it may be happening due to connection problems.', note_bad)\r\n        return;\r\n    }\r\n\r\n    try {\r\n        handleServerRequestResponse(request, operation, response.response);\r\n        if (request.indexOf(\"a=get_images\") != -1 && request.indexOf(\"for_class=decor_model\") != -1) {\r\n            updateDecorList();\r\n        }\r\n        window.ImageContext = ImageContext;\r\n        if (operation == 'save' || operation == 'load') {\r\n            changes_made = false;\r\n            if (operation == 'load') {\r\n                need_redraw = true;\r\n                need_GUIParams_update = true;\r\n                ClearUndos();\r\n            }\r\n        }\r\n    } catch (e) {\r\n        console.error(e);\r\n        NewNote('Server responds with unclear message. Looks like one of recent actions wasn\\'t successful.', note_bad);\r\n        debugger;\r\n    }\r\n\r\n    if (callback != null) {\r\n        callback();\r\n    }\r\n}\r\n\r\nlet _serverRequestPatched = false;\r\nfunction patchServerRequest() {\r\n    // This code just exists to prevent logging more than once\r\n    if (_serverRequestPatched) return;\r\n    _serverRequestPatched = true;\r\n    // Patches ServerRequest function.\r\n    // vanilla ServerRequest function literally eval()'s every single thing that server sends.\r\n    // Which opens up to expected vulnerabilities.\r\n    // Hopefully in future, ALEI will completely get rid of eval.\r\n    window.ServerRequest = ALEI_ServerRequest;\r\n    aleiLog(DEBUG, \"Patched ServerRequest\");\r\n}\r\n\r\nwindow.eval = function(code) { // Temporarily overriding eval so we can patch ServerRequest as early as possible\r\n    if (window.ServerRequest !== undefined) { // ServerRequest is defined.\r\n        handleServerRequestResponse(null, null, code);\r\n        patchServerRequest();\r\n        // We are pretty much done, we have patched ServerRequest, so just roll with old eval.\r\n        // Oh and a note for myself incase i confuse myself: vanilla ServerRequest is synchronous\r\n        window.eval = JS_eval;\r\n    } else {\r\n        // Is not defined.\r\n        // Is this even possible in normal circumstances?\r\n        console.log(code);\r\n        debugger;\r\n    }\r\n};\r\n\r\nfunction assignObjectIDs() {\r\n    // TODO: Refactor\r\n    let idmap = {};\r\n    for (let element of es) {\r\n        if (!element.exists) continue;\r\n        if (idmap[element._class] === undefined) idmap[element._class] = -1;\r\n\r\n        idmap[element._class] += 1;\r\n        element.aleiID = idmap[element._class];\r\n    }\r\n}\r\nfunction assignObjectPriority() {\r\n    // TODO: Refactor\r\n    for (let element of es) {\r\n        if (!element.exists) continue;\r\n        if(element.aleiPriority == undefined) element.aleiPriority = 1;\r\n    }\r\n}\r\n\r\nlet propertyAppliedObjects = [];\r\nfunction AssignObjectProperties(e) {\r\n    if(e.aleiID == undefined) assignObjectIDs();\r\n    if(e.aleiPriority == undefined) assignObjectPriority();\r\n\r\n    if(propertyAppliedObjects.indexOf(e) == -1) propertyAppliedObjects.push(e);\r\n\r\n    let entries = Object.entries(e.pm);\r\n    entries.splice(0, 0, [\"__id\", e.aleiID]);\r\n\r\n    if([\"bg\", \"decor\"].indexOf(e._class) !== -1) {\r\n        entries.splice(1, 0, [\"__priority\", e.aleiPriority]);\r\n    };\r\n\r\n    e.pm = Object.fromEntries(entries);\r\n}\r\n\r\nlet sortRequired = false;\r\nfunction SortObjectsByPriority() {\r\n    function getPriority(a, b) {\r\n        return b.aleiPriority - a.aleiPriority;\r\n    }\r\n    window.es = es.sort(getPriority);\r\n}\r\n\r\n\r\nfunction ApplyObjectProperties(e) {\r\n    if([\"bg\", \"decor\"].indexOf(e._class) == -1) return;\r\n    if(e.aleiPriority !== e.pm.__priority) {\r\n        e.aleiPriority = e.pm.__priority;\r\n        sortRequired = true;\r\n\r\n        // TODO: How can I force update GUI object list?\r\n        // UpdateGUIObjectsList does not do it.\r\n    }\r\n}\r\n\r\nfunction RemoveObjectProperties(e) {\r\n    delete e.pm.__id;\r\n    delete e.pm.__priority;\r\n}\r\n\r\nfunction patchUpdateGUIParams() {\r\n    let oldCodeSnippet = \"if ( i >= 4 && (i-4) % 3 == 0 ) {\";\r\n    let newCodeSnippet = \"if (shouldAddSeparatorInGUIParams(i)) {\";\r\n    let code = window.UpdateGUIParams.toString().replace(oldCodeSnippet, newCodeSnippet);\r\n    // if extended triggers are enabled, the code replacement from that will cause this code replacement to fail.\r\n    // it won't cause an error assuming that code does more or less the same thing. this thing is a bit of a nightmare\r\n    if (!code.includes(newCodeSnippet)) { \r\n        //aleiLog(WARN, \"UpdateGUIParams direct code replacement failed (separators)\");\r\n    }\r\n    code = \"(\" + code + \")\"; //putting it in parentheses to make it a function expression. the function can then be assigned directly from eval\r\n    let origUGP = eval(code);\r\n\r\n    let origGPV = window.GenParamVal;\r\n\r\n    window.shouldAddSeparatorInGUIParams = (count) => {\r\n        let sep = Trigger_getSeparatorStart(SelectedObjects.length);\r\n        if((count >= sep) && (count - sep) % 3 == 0) return true;\r\n        return false;\r\n    };\r\n\r\n    window.GenParamValEscapeDoubleQuotes = false;\r\n\r\n    // replaces GenParamVal behaviour of when base == \"nochange\". only difference is that it escapes double quotes.\r\n    // also it only escapes double quotes when it's used within UpdateGUIParams.\r\n    // the original function would return value if FORCE_TEXT_OPTIONS == true even if base == \"nochange\". so this works slightly differently, not sure if that's intentional\r\n    window.GenParamVal = function(base, value) {\r\n        if (GenParamValEscapeDoubleQuotes && base == \"nochange\") {\r\n            let valueWithQuotesEscaped = `${value}`.replaceAll('\"', \"&quot;\");\r\n            return `<pvalue real=\"${valueWithQuotesEscaped}\">- not used -</pvalue>`;\r\n        }\r\n        return origGPV(base, value);\r\n    }\r\n\r\n    window.UpdateGUIParams = function() {\r\n        GenParamValEscapeDoubleQuotes = true;\r\n\r\n        // Represents all the selected entity class.\r\n        let selected = SelectedObjects;\r\n        selected.filter(e => e._class == \"trigger\").map(e => ReorderTriggerProperty(e));\r\n\r\n        //selected.map(o => ApplyObjectProperties(o));\r\n\r\n        for(let element of propertyAppliedObjects) {\r\n            if(selected.indexOf(element) !== -1) continue;\r\n            RemoveObjectProperties(element);\r\n            propertyAppliedObjects.splice(propertyAppliedObjects.indexOf(element), 1);\r\n        }\r\n        selected.map(o => AssignObjectProperties(o));\r\n\r\n        // This code handles transition between timer and trigger values depending on region's \"executes\" parameter\r\n        if((selected.length == 1) && (selected[0]._class == \"region\")) {\r\n            if([true, \"true\"].indexOf(selected[0].pm.uses_timer) != -1) {\r\n                param_type[REGION_EXECUTE_PARAM_ID][1] = \"timer+none\";\r\n            } else {\r\n                param_type[REGION_EXECUTE_PARAM_ID][1] = \"trigger+none\";\r\n            }\r\n        }\r\n\r\n        origUGP();\r\n        addAdditionalButtons();\r\n\r\n        GenParamValEscapeDoubleQuotes = false;\r\n        if(sortRequired) SortObjectsByPriority();\r\n    }\r\n    aleiLog(DEBUG, \"Patched UpdateGUIParams\");\r\n}\r\n\r\nfunction patchEvalSet() {\r\n    window.EvalSet = function(key, value) {\r\n        // No evaling. Death to eval! (except for when i want to use it...)\r\n        window[key] = value;\r\n        UpdateTools();\r\n    }\r\n    aleiLog(DEBUG, \"Patched EvalSet\");\r\n}\r\n\r\nwindow.ALEI_settingsMenu = undefined;\r\n\r\n\r\n/*\r\nTODO: Text field for those.\r\nlet aleiSettings = {\r\n    triggerEditTextSize:readStorage(\"ALEI_EditTextSize\",      \"12px\",  (val) => val + \"px\"  ),\r\n    starsImage:         readStorage(\"ALEI_StarImage\",    \"stars2.jpg\", (val) => val         ),\r\n}\r\n*/\r\n\r\nfunction createALEISettingsMenu() {\r\n    let mainWindow = document.createElement(\"div\");\r\n    mainWindow.setAttribute(\"class\", \"mrpopup\");\r\n\r\n    let title = document.createElement(\"div\");\r\n    title.innerHTML = \"ALEI Setting\";\r\n    title.setAttribute(\"id\", \"mrtitle\"); // Eric, what is this crap ?\r\n    mainWindow.appendChild(title);\r\n\r\n\r\n    let box = document.createElement(\"div\");\r\n    box.setAttribute(\"id\", \"mrbox\");\r\n    mainWindow.appendChild(box);\r\n\r\n    // Convenience functions.\r\n    let usableHeight = 240;\r\n    let currentHeight = 300;\r\n\r\n    function addText(text, requiresRestart = false) {\r\n        let div = document.createElement(\"div\");\r\n        div.innerHTML = text;\r\n        if (requiresRestart) {\r\n            div.style.setProperty(\"color\", \"#FFFF00\");\r\n        }\r\n        div.setAttribute(\"class\", \"ALEI_settingMenuText\");\r\n        box.innerHTML += \"<br>\";\r\n        box.innerHTML += div.outerHTML;\r\n\r\n        usableHeight -= 20;\r\n        if(usableHeight <= 0) {\r\n            currentHeight += 20;\r\n            usableHeight += 20;\r\n            box.style.height = `${currentHeight}px`;\r\n        }\r\n    }\r\n    function registerButton(general, values, key) {\r\n        aleiSettingButtonsMap[general] = [values, aleiSettings, key];\r\n    }\r\n    function newRegisterButton(general, values, dict, key) {\r\n        aleiSettingButtonsMap[general] = [values, dict, key];\r\n    }\r\n    function addButton(display, identifier, callback, style = \"\") {\r\n        aleiButtonClicks[\"setting_\" + identifier] = callback;\r\n\r\n        let button = document.createElement(\"input\");\r\n        button.setAttribute(\"type\", \"button\");\r\n        button.setAttribute(\"id\", \"ALEI_\" + identifier);\r\n        button.setAttribute(\"value\", display);\r\n        button.setAttribute(\"onclick\", `aleiButtonClicks['setting_${identifier}'](); ALEI_settingUpdateButtons(); triggerActionsPreventError();`);\r\n        button.setAttribute(\"class\", \"ALEI_settingsMenuButton\");\r\n        button.setAttribute(\"style\", style);\r\n\r\n        box.innerHTML += button.outerHTML;\r\n    }\r\n    function addBinaryOption(truthyVal, falsyVal, storage, key, internalName, callback = () => {}) {\r\n        function _apply(val) {\r\n            writeStorage(storage, val);\r\n            aleiSettings[key] = val;\r\n        }\r\n        addButton(truthyVal, `${internalName}_true`, () => {_apply(true); callback(true)});\r\n        addButton(falsyVal, `${internalName}_false`, () => {_apply(false); callback(false)});\r\n    }\r\n\r\n    // Log level.\r\n    function logApply(val) {\r\n        writeStorage(\"ALEI_LogLevel\", val);\r\n        aleiSettings.logLevel = val;\r\n    }\r\n    box.innerHTML += \"NOTE: Settings in yellow text requires page refresh to be applied.<br>\";\r\n    addButton(\"Clear Backup\", \"clearMapBackups\", () => {\r\n        let removed = [];\r\n        for (let key of Object.keys(localStorage)) {\r\n            if(!(key.slice(0, \"pb2_map\".length) == \"pb2_map\")) continue;\r\n            removed.push(key);\r\n            localStorage.removeItem(key);\r\n        }\r\n        NewNote(`ALEI: Cleared backup, removed total ${removed.length} backups.`, \"#00FFFF\");\r\n        aleiLog(DEBUG2, `Removed backup of: ${removed}`);\r\n    }, \"width: 100px\");\r\n    box.innerHTML += \"<br>\";\r\n\r\n    let identifier = 0;\r\n\r\n    function MakeSettingButtons(storage, dict, dictKey, valueMap) {\r\n        identifier++;\r\n        newRegisterButton(\r\n            identifier,\r\n            valueMap.map(o => o[1]),\r\n            dict,\r\n            dictKey\r\n        );\r\n        function _apply(value) {\r\n            writeStorage(storage, value);\r\n            dict[dictKey] = value;\r\n        }\r\n        for(let map of valueMap) {\r\n            addButton(map[0], `${identifier}_${map[1]}`, () => _apply(map[1]));\r\n        }\r\n    }\r\n\r\n    window.ALEIAPI.settings = {};\r\n    window.ALEIAPI.settings.addText = addText;\r\n    window.ALEIAPI.settings.createButtons = MakeSettingButtons;\r\n\r\n    function aleiMakeSettingButtons(text, requireRefresh, storage, dictKey, valueMap) {\r\n        addText(text, requireRefresh);\r\n        MakeSettingButtons(storage, aleiSettings, dictKey, valueMap);\r\n    }\r\n\r\n    let PR_ShowHide = [[\"Show\", true], [\"Hide\", false]];\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Log Level:\",\r\n        false,\r\n        \"ALEI_LogLevel\", // Storage key.\r\n        \"logLevel\", // Dictionary key.\r\n        [\r\n            [\"INFO\", 0], // Value maps.\r\n            [\"DEBUG\", 1],\r\n            [\"VERBOSE\", 2]\r\n        ]\r\n    )\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Action IDs:\",\r\n        true,\r\n        \"ALEI_ShowTriggerIDs\",\r\n        \"showTriggerIDs\",\r\n        PR_ShowHide\r\n    );\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Tooltips:\",\r\n        false,\r\n        \"ALEI_ShowTooltips\",\r\n        \"enableTooltips\",\r\n        PR_ShowHide\r\n    )\r\n\r\n    // Object ID.\r\n    /*registerButton(\"showids\", [true, false], \"showIDs\");\r\n    addText(\"Object IDs:\")\r\n    addBinaryOption(\"Show\", \"Hide\", \"ALEI_ShowIDs\", \"showIDs\", \"showids\")\r\n*/\r\n\r\n    /*aleiMakeSettingButtons(\r\n        \"Z-Index:\",\r\n        false,\r\n        \"ALEI_ShowZIndex\",\r\n        \"showZIndex\",\r\n        PR_ShowHide\r\n    );*/\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Same Parameters:\",\r\n        false,\r\n        \"ALEI_ShowSameParameters\",\r\n        \"showSameParameters\",\r\n        PR_ShowHide\r\n    );\r\n\r\n    // Black theme.\r\n    registerButton(\"blackTheme\", [true, false], \"blackTheme\");\r\n    addText(\"Black theme:\", false);\r\n    addBinaryOption(\"Yes\", \"No\", \"ALEI_BlackTheme\", \"blackTheme\", \"blackTheme\", (status) => {\r\n        if(status) blackTheme()\r\n        else UndoBlackTheme();\r\n    });\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Grid by snap:\",\r\n        false,\r\n        \"ALEI_gridBasedOnSnapping\",\r\n        \"gridBasedOnSnapping\",\r\n        [[\"Yes\", true], [\"No\", false]]\r\n    );\r\n\r\n    // Render object names\r\n    registerButton(\"showObjectNames\", [true, false], \"renderObjectNames\");\r\n    addText(\"Show object names: \");\r\n    addBinaryOption(\"Yes\", \"No\", \"ALEI_RenderObjectNames\", \"renderObjectNames\", \"showObjectNames\", (status) => ALEI_UpdateNameRenderSetting(status));\r\n\r\n    // Remap UID\r\n    registerButton(\"remapUID\", [true, false], \"rematchUID\");\r\n    addText(\"Remap UID: \");\r\n    addBinaryOption(\"Enabled\", \"Disabled\", \"ALEI_RemapUID\", \"rematchUID\", \"remapUID\", (status) => ALEI_UpdateRematchUIDSetting(status));\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Extended triggers:\",\r\n        true,\r\n        \"ALEI_ExtendedTriggersEnabled\",\r\n        \"extendedTriggers\",\r\n        [[\"Enabled\", true], [\"Disabled\", false]]\r\n    );\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Ordered Naming:\",\r\n        true,\r\n        \"ALEI_orderedNaming\",\r\n        \"orderedNaming\",\r\n        [[\"Yes (Slow)\", true], [\"No (Fast)\", false]]\r\n    );\r\n\r\n    aleiMakeSettingButtons(\r\n        \"Custom Renderer:\",\r\n        true,\r\n        \"ALEI_Renderer_Enabled\",\r\n        \"customRenderer\",\r\n        [[\"Enabled\", true], [\"Disabled\", false]]\r\n    );\r\n\r\n    window.ALEI_settingsMenu = mainWindow;\r\n    document.body.appendChild(mainWindow);\r\n    ALEI_settingUpdateButtons();\r\n    aleiLog(DEBUG, \"Created settings window.\");\r\n}\r\n\r\nlet aleiSettingButtonsMap = {}\r\n\r\nwindow.ALEI_settingUpdateButtons = () => {\r\n    let defaultClass = \"ALEI_settingsMenuButton\";\r\n    let clickedClass = \"ALEI_settingsMenuButton ALEI_settingMenuButtonClicked\";\r\n\r\n    for (let entry of Object.entries(aleiSettingButtonsMap)) {\r\n        let identity = entry[0];\r\n        let values = entry[1][0];\r\n        let dict = entry[1][1];\r\n        let key = entry[1][2];\r\n\r\n        let currentVal = dict[key];\r\n        for (let value of values) {\r\n            $query(`#ALEI_${identity}_${value}`).setAttribute(\"class\", defaultClass);\r\n        }\r\n        $query(`#ALEI_${identity}_${currentVal}`).setAttribute(\"class\", clickedClass);\r\n    }\r\n}\r\n\r\n\r\nfunction showSettings() {\r\n    if (ALEI_settingsMenu === undefined) createALEISettingsMenu();\r\n\r\n    mrdimlights.style.display = 'block';\r\n    ALEI_settingsMenu.style.display = 'block';\r\n    dim_undo = \"ALEI_settingsMenu.style.display = 'none'\";\r\n};\r\n\r\nfunction patchTeamList() {\r\n    for (let entry of Object.entries(VAL_TABLE[\"team\"])) {\r\n        let teamID = parseInt(entry[0]);\r\n        let teamName = entry[1];\r\n\r\n        if (teamID < 0) {\r\n            teamName = teamName.replace(\"(no friendly fire)\", \"(No collision, Yes friendly fire)\")\r\n            VAL_TABLE[\"team\"][teamID] = teamName;\r\n        }\r\n\r\n        if (teamID === -1) continue;\r\n        VAL_TABLE[\"team+any\"][teamID] = teamName;\r\n    }\r\n    aleiLog(DEBUG, \"Edited team list..\");\r\n}\r\n\r\nfunction addProjectileModels() {\r\n    let projectileModels = VAL_TABLE[\"ALEI_projectileModels\"] = {\r\n        1: \"https://static.miraheze.org/plazmaburstwiki/6/6a/Lazer_1.png\",\r\n        2: \"https://static.miraheze.org/plazmaburstwiki/a/ae/Lazer_2.png\",\r\n        3: \"https://static.miraheze.org/plazmaburstwiki/0/06/Lazer_3.png\",\r\n        4: \"https://static.miraheze.org/plazmaburstwiki/d/de/Lazer_4.png\",\r\n        5: \"https://static.miraheze.org/plazmaburstwiki/8/8f/Lazer_5.png\",\r\n        6: \"https://static.miraheze.org/plazmaburstwiki/a/a0/Lazer_6.png\",\r\n        7: \"https://static.miraheze.org/plazmaburstwiki/7/71/Lazer_7.png\",\r\n        8: \"https://static.miraheze.org/plazmaburstwiki/c/c6/Lazer_8.png\",\r\n        9: \"https://static.miraheze.org/plazmaburstwiki/d/d2/Lazer_9.png\",\r\n        10: \"https://static.miraheze.org/plazmaburstwiki/5/5b/Lazer_10.png\",\r\n        11: \"https://static.miraheze.org/plazmaburstwiki/d/d2/Lazer_11.png\",\r\n        12: \"https://static.miraheze.org/plazmaburstwiki/2/2d/Lazer_12.png\",\r\n        13: \"https://static.miraheze.org/plazmaburstwiki/b/be/Lazer_13.png\",\r\n        14: \"https://static.miraheze.org/plazmaburstwiki/1/14/Lazer_14.png\",\r\n        15: \"\", // Empty projectile.\r\n        16: \"https://static.miraheze.org/plazmaburstwiki/7/7f/Lazer_16.png\",\r\n        17: \"https://static.miraheze.org/plazmaburstwiki/3/31/Lazer_17.png\",\r\n        18: \"https://static.miraheze.org/plazmaburstwiki/8/89/Lazer_18.png\",\r\n        19: \"https://static.miraheze.org/plazmaburstwiki/f/fe/Lazer_19.png\",\r\n        20: \"https://static.miraheze.org/plazmaburstwiki/1/1a/Lazer_20.png\",\r\n        21: \"https://static.miraheze.org/plazmaburstwiki/4/42/Lazer_21.png\",\r\n        22: \"https://static.miraheze.org/plazmaburstwiki/c/c0/Lazer_22.png\",\r\n        23: \"https://static.miraheze.org/plazmaburstwiki/d/d9/Lazer_23.png\",\r\n        24: \"https://static.miraheze.org/plazmaburstwiki/f/f5/Lazer_24.png\",\r\n        25: \"https://static.miraheze.org/plazmaburstwiki/7/7c/Lazer_25.png\",\r\n        26: \"https://static.miraheze.org/plazmaburstwiki/a/a7/Lazer_26.png\",\r\n        27: \"https://static.miraheze.org/plazmaburstwiki/3/30/Lazer_27.png\",\r\n        28: \"https://static.miraheze.org/plazmaburstwiki/3/3a/Lazer_28.png\",\r\n        29: \"https://static.miraheze.org/plazmaburstwiki/9/90/Lazer_29.png\",\r\n        30: \"https://static.miraheze.org/plazmaburstwiki/2/23/Lazer_30.png\",\r\n        31: \"https://static.miraheze.org/plazmaburstwiki/3/3a/Lazer_31.png\",\r\n        32: \"https://static.miraheze.org/plazmaburstwiki/f/f0/Lazer_32.png\",\r\n        33: \"https://static.miraheze.org/plazmaburstwiki/0/0d/Lazer_33.png\",\r\n        34: \"https://static.miraheze.org/plazmaburstwiki/c/c8/Lazer_34.png\",\r\n        35: \"https://static.miraheze.org/plazmaburstwiki/3/38/Lazer_35.png\",\r\n        36: \"https://static.miraheze.org/plazmaburstwiki/6/6d/Lazer_36.png\",\r\n        37: \"https://static.miraheze.org/plazmaburstwiki/a/a9/Lazer_37.png\",\r\n        38: \"https://static.miraheze.org/plazmaburstwiki/e/e7/Lazer_38.png\",\r\n        39: \"https://static.miraheze.org/plazmaburstwiki/6/6c/Lazer_39.png\",\r\n        40: \"https://static.miraheze.org/plazmaburstwiki/d/d4/Lazer_40.png\",\r\n        41: \"https://static.miraheze.org/plazmaburstwiki/5/5d/Lazer_41.png\",\r\n        42: \"https://static.miraheze.org/plazmaburstwiki/9/9d/Lazer_42.png\",\r\n        43: \"https://static.miraheze.org/plazmaburstwiki/7/79/Lazer_43.png\",\r\n        44: \"https://static.miraheze.org/plazmaburstwiki/6/6d/Lazer_44.png\",\r\n        45: \"https://static.miraheze.org/plazmaburstwiki/4/44/Lazer_45.png\",\r\n        46: \"https://static.miraheze.org/plazmaburstwiki/3/3b/Lazer_46.png\",\r\n        47: \"https://static.miraheze.org/plazmaburstwiki/8/84/Lazer_47.png\",\r\n        48: \"https://static.miraheze.org/plazmaburstwiki/7/75/Lazer_48.png\",\r\n        49: \"https://static.miraheze.org/plazmaburstwiki/0/08/Lazer_49.png\",\r\n        50: \"https://static.miraheze.org/plazmaburstwiki/4/41/Lazer_50.png\",\r\n        51: \"https://static.miraheze.org/plazmaburstwiki/9/92/Lazer_51.png\",\r\n        52: \"https://static.miraheze.org/plazmaburstwiki/9/92/Lazer_52.png\",\r\n        53: \"https://static.miraheze.org/plazmaburstwiki/7/70/Lazer_53.png\",\r\n        54: \"https://static.miraheze.org/plazmaburstwiki/e/ee/Lazer_54.png\",\r\n        55: \"https://static.miraheze.org/plazmaburstwiki/d/d1/Lazer_55.png\"\r\n    };\r\n    for (let i = 1; i < 56; i++) {\r\n        projectileModels[i] = `<img src='${projectileModels[i]}' style='width: 60px; height: 20px'/>`;\r\n    }\r\n    aleiLog(DEBUG, \"Loaded projectile models.\");\r\n}\r\n\r\nfunction patchSpecialValue() {\r\n    let _OG = window.special_value;\r\n    window.special_value = (base, value) => {\r\n        if ([\"ALEI_projectileModels\"].indexOf(base) !== -1) {\r\n            let returning = VAL_TABLE[base][value];\r\n            if (returning === undefined) return ERROR_VALUE;\r\n            else return returning;\r\n        } else if(base == \"trigger+none\") { // I actually do not have to do this, but i will do it to get rid of annoyance\r\n            if(value == -1) return VAL_TABLE[\"trigger+none\"][-1];\r\n            return special_value(\"trigger\", value);\r\n        }else if(base == \"timer+none\") {\r\n            if(value == -1) return VAL_TABLE[\"timer+none\"][-1];\r\n            return special_value(\"timer\", value);\r\n        }else return _OG(base, value);\r\n    }\r\n    aleiLog(DEBUG, \"Patched SpecialValue\");\r\n}\r\n\r\nfunction notifyUpdate(version) {\r\n    newUpdate = 1;\r\n\r\n    aleiLog(INFO, `New update: ${version}`);\r\n    NewNote(`ALEI: There is new update: ${version}, you are currently in ${GM_info.script.version}<br>Press Ctrl + Shift to update`, \"#FFFFFF\");\r\n}\r\n\r\nfunction notifyIfTheresUpdate(script) {\r\n    let lines = script.split(\"\\n\");\r\n    let version;\r\n    for(let i = 0; i < lines.length; i++) {\r\n        let line = lines[i];\r\n        if(line.indexOf(\"@version\") == -1) continue;\r\n\r\n        let parts = line.split(\" \");\r\n        version = parts[parts.length - 1];\r\n        break;\r\n    }\r\n\r\n    let latestVersion = parseInt(version.replaceAll(\".\", \"\"));\r\n    let currentVersion = parseInt(GM_info.script.version.replaceAll(\".\", \"\"));\r\n\r\n    if(latestVersion > currentVersion) return notifyUpdate(version);\r\n\r\n    aleiLog(INFO, `REMOTE: ${version}, LOCAL: ${GM_info.script.version} => No update detected.`);\r\n}\r\n\r\nasync function checkForUpdates() {\r\n    let resp = await GM.xmlHttpRequest({  url: GM_info.script.updateURL  }).catch(e => console.error(e));\r\n    notifyIfTheresUpdate(resp.responseText);\r\n}\r\n\r\nfunction ALEI_DoWorldScale() {\r\n    var newscale = prompt('Multiply selection size by % (percents)', 100);\r\n    if (!(newscale == null || newscale == 100)) {\r\n        var factor = Math.floor(newscale) / 100;\r\n        {\r\n            let snappingScript = `/GRID_SNAPPING)*GRID_SNAPPING;`\r\n            var roundwell = true;\r\n            lcz();\r\n            for (let i = 0; i < es.length; i++)\r\n                if (es[i].exists)\r\n                    if (es[i].selected)\r\n                        if (MatchLayer(es[i])) {\r\n                            if (es[i].pm.w != undefined) {\r\n                                ldn('es[' + i + '].pm.w=Math.round(es[' + i + '].pm.w*' + factor + snappingScript);\r\n                                lnd('es[' + i + '].pm.w=' + es[i].pm.w + ';');\r\n                                if (es[i].pm.w * factor != Math.round(es[i].pm.w * factor / GRID_SNAPPING) * GRID_SNAPPING)\r\n                                    roundwell = false;\r\n                            }\r\n                            if (es[i].pm.h != undefined) {\r\n                                ldn('es[' + i + '].pm.h=Math.round(es[' + i + '].pm.h*' + factor + snappingScript);\r\n                                lnd('es[' + i + '].pm.h=' + es[i].pm.h + ';');\r\n                                if (es[i].pm.h * factor != Math.round(es[i].pm.h * factor / GRID_SNAPPING) * GRID_SNAPPING)\r\n                                    roundwell = false;\r\n                            }\r\n                            if (es[i].pm.x != undefined) {\r\n                                ldn('es[' + i + '].pm.x=Math.round(es[' + i + '].pm.x*' + factor + snappingScript);\r\n                                lnd('es[' + i + '].pm.x=' + es[i].pm.x + ';');\r\n                                if (es[i].pm.x * factor != Math.round(es[i].pm.x * factor / GRID_SNAPPING) * GRID_SNAPPING)\r\n                                    roundwell = false;\r\n                            }\r\n                            if (es[i].pm.y != undefined) {\r\n                                ldn('es[' + i + '].pm.y=Math.round(es[' + i + '].pm.y*' + factor + snappingScript);\r\n                                lnd('es[' + i + '].pm.y=' + es[i].pm.y + ';');\r\n                                if (es[i].pm.y * factor != Math.round(es[i].pm.y * factor / GRID_SNAPPING) * GRID_SNAPPING)\r\n                                    roundwell = false;\r\n                            }\r\n                        }\r\n            lfz(true);\r\n            NewNote('Operation complete:<br><br>Selected objects scaled by ' + factor + ' (' + newscale + '% of original size)', note_passive);\r\n            if (!roundwell)\r\n                NewNote('Note: Position and/or dimensions of some objects were not scaled properly due to Level Editor rounding rules', note_neutral);\r\n            need_GUIParams_update = true;\r\n            need_redraw = true;\r\n            UpdateTools();\r\n        }\r\n    }\r\n}\r\nfunction patchPercentageTool() {\r\n    window.DoWorldScale = ALEI_DoWorldScale;\r\n    aleiLog(DEBUG, \"Patched percentage tool\");\r\n}\r\n\r\nfunction _encodeXMLChars(value) {\r\n    return value.replaceAll(\"<\", \"&lt;\").replaceAll(\">\", \"&gt;\").replaceAll('\"', \"&quot;\")\r\n}\r\n\r\nfunction patchCompileTrigger() {\r\n    let _og = window.CompileTrigger;\r\n\r\n    window.CompileTrigger = () => {\r\n        let result = _og();\r\n        let selected = SelectedObjects;\r\n        for (let i = 0; i < selected.length; i++) {\r\n            let obj = selected[i];\r\n            let keys = Object.keys(obj.pm);\r\n\r\n            for (let j = 0; j < keys.length; j++) {\r\n                if (typeof obj.pm[keys[j]] == \"string\") {\r\n                    obj.pm[keys[j]] = _encodeXMLChars(obj.pm[keys[j]]);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    aleiLog(DEBUG, \"Patched CompileTrigger\");\r\n}\r\n\r\nfunction addPasteFromPermanentClipboard() {\r\n    window.pasteFromPermanentClipboard = pasteFromPermanentClipboard;\r\n}\r\n\r\nlet selectedTriggerActions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\nlet hoveredTriggerAction = -1;\r\nlet triggerActionsClipboard = [];\r\n\r\nfunction getTriggerActionElements() {\r\n    let arr = [];\r\n    let elems = document.getElementsByClassName(\"p_i\");\r\n    let i = 7;\r\n\r\n    for (; i < elems.length; i++) {\r\n        arr.push(elems[i].childNodes[0]);\r\n    }\r\n\r\n    return arr;\r\n}\r\n\r\nfunction addEventListeners() {\r\n    let elems = getTriggerActionElements();\r\n\r\n    for (let i = 0; i < elems.length; i++) {\r\n        let elem = elems[i];\r\n\r\n        elem.onmousedown = function() {\r\n            selectedTriggerActions[Math.floor(i / 3)] ^= 1;\r\n            updateTriggerActionElements();\r\n        }\r\n\r\n        elem.onmouseenter = function() {\r\n            hoveredTriggerAction = Math.floor(i / 3);\r\n            updateTriggerActionElements();\r\n        }\r\n\r\n        elem.onmouseleave = function() {\r\n            hoveredTriggerAction = -1;\r\n            updateTriggerActionElements();\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateTriggerActionElements() {\r\n    let elems = getTriggerActionElements();\r\n\r\n    // TODO: Make those colors not hardcoded, prolly never will do.\r\n    for (let i = 0; i < 10; i++) {\r\n        // Not selected\r\n        let color = \"\";\r\n\r\n        // Selected.\r\n        if (selectedTriggerActions[i]) {\r\n            color = \"rgb(45, 65, 95)\";\r\n            if (THEME != 0) color = \"rgb(27, 27, 27)\"; // rgb(37, 37, 37)\r\n        }\r\n\r\n        elems[i * 3 + 0].style.backgroundColor = color;\r\n        elems[i * 3 + 1].style.backgroundColor = color;\r\n        elems[i * 3 + 2].style.backgroundColor = color;\r\n    }\r\n\r\n    // Hover.\r\n    if (hoveredTriggerAction != -1) {\r\n        if (!selectedTriggerActions[hoveredTriggerAction]) {\r\n            let color = \"rgb(65, 85, 130)\";\r\n\r\n            if (THEME != 0) color = \"rgb(47, 47, 47)\"\r\n\r\n            elems[hoveredTriggerAction * 3 + 0].style.backgroundColor = color;\r\n            elems[hoveredTriggerAction * 3 + 1].style.backgroundColor = color;\r\n            elems[hoveredTriggerAction * 3 + 2].style.backgroundColor = color;\r\n        }\r\n    }\r\n}\r\n\r\nfunction isOnlyTriggerSelected() {\r\n    let result = 0;\r\n    let selection = getSelection();\r\n\r\n    if (selection.length == 1 && selection[0]._class == \"trigger\") {\r\n        result = 1;\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\nfunction getTriggerActions() {\r\n    edit_triggers_as_text = 1;\r\n\r\n    UpdateGUIParams();\r\n\r\n    let textarea = document.getElementById(\"opcode_field\");\r\n    let arr = textarea.value.split(\"\\n\").slice(4);\r\n\r\n    while (arr.length < 10) {\r\n        arr.push(\"\");\r\n    }\r\n\r\n    edit_triggers_as_text = 0;\r\n    UpdateGUIParams();\r\n\r\n    return arr;\r\n}\r\n\r\nfunction copyTriggerActions() {\r\n    let actions = getTriggerActions();\r\n\r\n    triggerActionsClipboard = [];\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n        if (selectedTriggerActions[i]) {\r\n            triggerActionsClipboard.push(actions[i]);\r\n        }\r\n    }\r\n}\r\n\r\nfunction isNothingSelected() {\r\n    return !selectedTriggerActions.includes(1);\r\n}\r\n\r\nfunction isOnlyOneTriggerActionSelected() {\r\n    return selectedTriggerActions.indexOf(1) == selectedTriggerActions.lastIndexOf(1) && !isNothingSelected();\r\n}\r\n\r\nfunction getSelectedTriggerAction() {\r\n    return selectedTriggerActions.indexOf(1);\r\n}\r\n\r\nfunction getTriggerInfo() {\r\n    edit_triggers_as_text = 1;\r\n    UpdateGUIParams();\r\n\r\n    let textarea = document.getElementById(\"opcode_field\");\r\n    let arr = textarea.value.split(\"\\n\").slice(0, 3);\r\n\r\n    return arr;\r\n}\r\n\r\nfunction pasteTriggerActions() {\r\n    // TODO: Make this bit more specific\r\n    // As in, if i copy 2 actions, and i select another 2 actions, it should paste to those 2 actions i selected\r\n    // And not add to end of it.\r\n    let actions = getTriggerActions();\r\n    let index = getSelectedTriggerAction();\r\n    let clipboard = triggerActionsClipboard.join(\"\\n\");\r\n    let info = getTriggerInfo();\r\n\r\n    edit_triggers_as_text = 1;\r\n    UpdateGUIParams();\r\n\r\n    if (isNothingSelected()) { // Adds action at end of no action was selected.\r\n        index = actions.length - 1;\r\n        actions[index] = actions[index] + \"\\n\" + clipboard;\r\n    }\r\n\r\n    if (isOnlyOneTriggerActionSelected()) { // Adds action before the action that was selected.\r\n        actions[index] = clipboard + \"\\n\" + actions[index];\r\n    }\r\n\r\n    let textarea = document.getElementById(\"opcode_field\");\r\n\r\n    textarea.value = info.concat(actions).join(\"\\n\");\r\n\r\n    CompileTrigger();\r\n\r\n    edit_triggers_as_text = 0;\r\n    UpdateGUIParams();\r\n}\r\n\r\nfunction deleteTriggerActions() {\r\n    let actions = getTriggerActions();\r\n    let info = getTriggerInfo();\r\n\r\n    edit_triggers_as_text = 1;\r\n    UpdateGUIParams();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n        if (selectedTriggerActions[i]) {\r\n            actions[i] = \"\";\r\n        }\r\n    }\r\n\r\n    let textarea = document.getElementById(\"opcode_field\");\r\n\r\n    textarea.value = info.concat(actions).join(\"\\n\");\r\n\r\n    CompileTrigger();\r\n\r\n    edit_triggers_as_text = 0;\r\n    UpdateGUIParams();\r\n}\r\n\r\nfunction reverseTriggerActions() {\r\n    let actions1 = getTriggerActions();\r\n    let actions2 = [];\r\n    let indexes = [];\r\n    let info = getTriggerInfo();\r\n\r\n    edit_triggers_as_text = 1;\r\n    UpdateGUIParams();\r\n\r\n    for (let i = 0; i < 10; i++) {\r\n        if (selectedTriggerActions[i]) {\r\n            actions2.push(actions1[i]);\r\n            indexes.push(i);\r\n        }\r\n    }\r\n\r\n    indexes.reverse();\r\n\r\n    for (let i = 0; i < actions2.length; i++) {\r\n        let index = indexes[i];\r\n        let action = actions2[i];\r\n\r\n        actions1[index] = action;\r\n    }\r\n\r\n    let textarea = document.getElementById(\"opcode_field\");\r\n\r\n    textarea.value = info.concat(actions1).join(\"\\n\");\r\n\r\n    displayOperationCompleteNotes = false;\r\n    CompileTrigger();\r\n    displayOperationCompleteNotes = true;\r\n    NewNote(\"Reversed actions.\", \"#FFFFFF\");\r\n\r\n    edit_triggers_as_text = 0;\r\n    UpdateGUIParams();\r\n}\r\n\r\nfunction unselectTriggerActions() {\r\n    selectedTriggerActions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n    hoveredTriggerAction = -1;\r\n    updateTriggerActionElements();\r\n}\r\n\r\nwindow.triggerActionsPreventError = () => {\r\n    selectedTriggerActions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n    hoveredTriggerAction = -1;\r\n    UpdateGUIParams();\r\n}\r\n\r\nfunction patchClipboardFunctions() {\r\n    let old_CopyToClipBoard = CopyToClipBoard;\r\n    let old_PasteFromClipBoard = PasteFromClipBoard;\r\n    let old_DeleteSelection = DeleteSelection;\r\n    let old_UpdateGUIParams = UpdateGUIParams;\r\n    let old_DO_UNDO = DO_UNDO;\r\n    let old_DO_REDO = DO_REDO;\r\n\r\n    window.CopyToClipBoard = function(param) {\r\n        if (isNothingSelected()) {\r\n            let result = old_CopyToClipBoard(param);\r\n            triggerActionsClipboard = [];\r\n            return result;\r\n        } else {\r\n            copyTriggerActions();\r\n            unselectTriggerActions();\r\n            return true;\r\n        }\r\n    }\r\n\r\n    window.PasteFromClipBoard = function(param) {\r\n        if (triggerActionsClipboard.length == 0) {\r\n            let result = old_PasteFromClipBoard(param);\r\n            UpdateGUIParams();\r\n            return result;\r\n        } else {\r\n            displayOperationCompleteNotes = false;\r\n            pasteTriggerActions();\r\n            unselectTriggerActions();\r\n            displayOperationCompleteNotes = true;\r\n            return true;\r\n        }\r\n    }\r\n\r\n    window.DeleteSelection = function() {\r\n        if (isNothingSelected()) {\r\n            old_DeleteSelection();\r\n        } else {\r\n            displayOperationCompleteNotes = false;\r\n            deleteTriggerActions();\r\n            unselectTriggerActions();\r\n            NewNote(\"Deleted trigger actions.\", \"#FFFFFF\");\r\n            displayOperationCompleteNotes = true;\r\n        }\r\n    }\r\n\r\n    window.UpdateGUIParams = function() {\r\n        old_UpdateGUIParams();\r\n\r\n        if (!isOnlyTriggerSelected()) {\r\n            selectedTriggerActions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\r\n            hoveredTriggerAction = -1;\r\n        } else if (!edit_triggers_as_text) {\r\n            addEventListeners();\r\n            updateTriggerActionElements();\r\n        }\r\n    }\r\n\r\n    window.DO_UNDO = function() {\r\n        try {\r\n            old_DO_UNDO();\r\n        } catch (err) {\r\n            NewNote(\"Can't undo action.\", note_bad);\r\n        }\r\n    }\r\n\r\n    window.DO_REDO = function() {\r\n        try {\r\n            old_DO_REDO();\r\n        } catch (err) {\r\n            NewNote(\"Can't redo action.\", note_bad);\r\n        }\r\n    }\r\n\r\n    window.triggerActionsPreventError = triggerActionsPreventError;\r\n    aleiLog(DEBUG, \"Patched clipboard related functions.\");\r\n}\r\n\r\nfunction patchDrawGrid() {\r\n    let old_lg = lg;\r\n\r\n    window.lg = function(param1, param2) {\r\n        if(aleiSettings.gridBasedOnSnapping) {\r\n            old_lg(param1 * (GRID_SNAPPING / 10), Math.min(param2 * Math.max(GRID_SNAPPING / 10, 1), 1));\r\n        } else {\r\n            old_lg(param1, param2)\r\n        }\r\n    }\r\n    aleiLog(DEBUG, \"Patched LG\");\r\n}\r\n\r\nfunction patchNewNote() {\r\n    let old = NewNote;\r\n    window.NewNote = (text, color) => {\r\n        if (displayOperationCompleteNotes) return old(text, color);\r\n        if (text.slice(0, \"Operation complete:<br><br>\".length) != \"Operation complete:<br><br>\") return old(text, color);\r\n    }\r\n}\r\n\r\n/**\r\n * Trigger_getSeparatorStart(selectionCount) gives number which determines where does trigger's separator line starts from.\r\n * This is used for fixIndex and PatchGUIParams;\r\n*/\r\nfunction Trigger_getSeparatorStart(selectionCount) {\r\n    let startSeparatorFrom = 6; // Name + X + Y + Max Calls + Enabled + Executes Directly + ID\r\n    return startSeparatorFrom;\r\n}\r\n\r\n/**\r\n *  extendTriggerList() is responsible for patching many of the original functions to support the\r\n *  implementation of extended triggers.\r\n *\r\n *  Extended triggers are triggers that can hold more than 10 trigger actions, and is compatible with the vanilla ALE.\r\n *  They are implemented similar to a linked list, with the main extended trigger pointing to the next trigger via the\r\n *  10th trigger action.\r\n *\r\n *  View addTriggerActionCount to see what unique properties an extended trigger has (class invariant).\r\n *  View SaveThisMap to see the structe of the linked list.\r\n */\r\nfunction extendTriggerList() {\r\n\r\n    /** Modifies the original UpdateGUIParams to provide support for trigger extension.\r\n    */\r\n    function newUpdateGUIParams() {\r\n        // Get current GUI scroll percentage. This is so we can reset the GUI scroll percentage after reupdating the GUI.\r\n        let guiHTMLElement = document.getElementById(\"rparams\");\r\n        let amountToScroll = 0;\r\n        if(guiHTMLElement){\r\n            amountToScroll = guiHTMLElement.scrollTop;\r\n        }\r\n\r\n        current_gui_params = new Array();\r\n        unfocusedit();\r\n        ff.style.display = 'none';\r\n        var str = '';\r\n        var selects = 0;\r\n        var sel_by_class = new Array();\r\n        for (i = 0; i < known_class.length; i++) {\r\n            sel_by_class[i] = 0;\r\n        }\r\n        var uids_list = '';\r\n        for (i = 0; i < es.length; i++)\r\n            if (es[i].exists)\r\n                if (es[i].selected) {\r\n                    selects++;\r\n                    sel_by_class[known_class.indexOf(es[i]._class)]++;\r\n                    if (es[i].pm.uid != undefined) {\r\n                        if (uids_list.length > 0)\r\n                            uids_list += ', ';\r\n                        uids_list += '\"' + es[i].pm.uid + '\"';\r\n                    }\r\n                }\r\n        var full_list = '';\r\n        var classes_selected = 0;\r\n        for (i = 0; i < known_class.length; i++)\r\n            if (sel_by_class[i] > 0) {\r\n                if (full_list.length > 0)\r\n                    full_list += ', ';\r\n                classes_selected++;\r\n                full_list += sel_by_class[i] + ' ' + tonumerous(known_class_title[i], sel_by_class[i]);\r\n            }\r\n        if (classes_selected > 0) {\r\n            if (classes_selected == 1)\r\n                if (uids_list.length > 0) {\r\n                    full_list += ': ' + uids_list;\r\n                }\r\n            full_list = ' (' + full_list + ')';\r\n            full_list += ' <a href=\"#\" onclick=\"ForceDeselect()\"><img src=\"noap.png\" width=\"11\" height=\"11\" border=\"0\"></a>';\r\n        }\r\n        if (selects == 0)\r\n            str += '<div id=\"gui_sel_info\" class=\"gui_sel_info\">Nothing selected</div><br><div class=\"q\"></div><br>';\r\n        else if (selects == 1)\r\n            str += '<div id=\"gui_sel_info\" class=\"gui_sel_info\">' + selects + ' object selected' + full_list + '</div><br><div class=\"q\"></div><br>';\r\n        else\r\n            str += '<div id=\"gui_sel_info\" class=\"gui_sel_info\">' + selects + ' objects selected' + full_list + '</div><br><div class=\"q\"></div><br>';\r\n        var first_selected_object = null;\r\n        var params_to_display = new Array();\r\n        var paramscount_to_display = new Array();\r\n        var paramsvalue_to_display = new Array();\r\n        var param_associated = new Array();\r\n\r\n        // Code to change the starting point of the gap between trigger actions.\r\n        let startSeparatorFrom = Trigger_getSeparatorStart(selects);\r\n\r\n        for (var i = 0; i < es.length; i++) {\r\n            if (!es[i].exists) continue;\r\n            if (!es[i].selected) continue;\r\n\r\n            // Selects the first object if not already selected.\r\n            if (first_selected_object == null)\r\n                first_selected_object = es[i];\r\n\r\n\r\n            // Iterate through all entity's properties names. (__z_Index, actions_10_targetA, etc..)\r\n            for (let parameter in es[i].pm) {\r\n                // Find the ID associated with that property. Eg: __z_Index: 98.\r\n                // This ID is the same as the index to retrieve this property in param_type.\r\n                var ind2 = FindMachingParameterID(parameter, es[i]._class);\r\n\r\n                // Find any potential duplicate.\r\n                var ind = params_to_display.indexOf(ind2);\r\n                if (ind == -1 && ind2 != -1) {\r\n                    params_to_display.push(ind2);   // params_to_display contains all the ID of properties\r\n                    paramscount_to_display.push(1);\r\n                    paramsvalue_to_display.push(es[i].pm[parameter]);\r\n                    param_associated.push(parameter);\r\n\r\n                } else {\r\n                    paramscount_to_display[ind]++;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (edit_triggers_as_text && selects == 1 && first_selected_object._class == 'trigger') {\r\n            // TRIGGER GUI PARAMS IN TEXT EDIT MODE\r\n            str += '<div id=\"rparams\">';\r\n            str += '<div style=\"width:220px;white-space:normal;\">This feature should not give you much more freedom, yet you might find it useful to copy/paste/cut trigger actions here.</div><br>';\r\n            str += '<textarea id=\"opcode_field\" class=\"opcode_field\" style=\"display:block;width:100%;height:400px\" autocomplete=\"off\" autocorrect=\"off\" autocapitalize=\"off\" spellcheck=\"false\">';\r\n            var code_lines = '';\r\n            code_lines += 'uid: ' + first_selected_object.pm.uid + '\\n';\r\n            code_lines += 'enabled: ' + first_selected_object.pm.enabled + '\\n';\r\n            code_lines += 'maxcalls: ' + first_selected_object.pm.maxcalls + '\\n';\r\n            code_lines += 'execute: ' + first_selected_object.pm.execute + '\\n';\r\n            code_lines += '\\n';\r\n\r\n            for (let i = 1; i <= 10; i++) {\r\n                if (first_selected_object.pm['actions_' + i + '_type'] == -1) {\r\n                    continue;\r\n                }\r\n\r\n                if (trigger_opcode_aliases[first_selected_object.pm['actions_' + i + '_type']] == undefined)\r\n                    code_lines += 'op' + first_selected_object.pm['actions_' + i + '_type'];\r\n                else\r\n                    code_lines += trigger_opcode_aliases[first_selected_object.pm['actions_' + i + '_type']];\r\n\r\n                code_lines += '( ';\r\n                code_lines += '\"' + first_selected_object.pm['actions_' + i + '_targetA'] + '\"';\r\n                code_lines += ', ';\r\n                code_lines += '\"' + first_selected_object.pm['actions_' + i + '_targetB'] + '\"';\r\n                code_lines += ' );\\n';\r\n            }\r\n\r\n            for(let i = 0; first_selected_object.pm.extended && i + 11 <= first_selected_object.pm[\"totalNumOfActions\"]; ++i){\r\n                if (first_selected_object.pm[\"additionalActions\"][i] == -1) {\r\n                    continue;\r\n                }\r\n\r\n                if (trigger_opcode_aliases[first_selected_object.pm[\"additionalActions\"][i]] == undefined)\r\n                    code_lines += 'op' + first_selected_object.pm[\"additionalActions\"][i];\r\n                else\r\n                    code_lines += trigger_opcode_aliases[first_selected_object.pm[\"additionalActions\"][i]];\r\n\r\n                code_lines += '( ';\r\n                code_lines += '\"' + first_selected_object.pm[\"additionalParamA\"][i] + '\"';\r\n                code_lines += ', ';\r\n                code_lines += '\"' + first_selected_object.pm[\"additionalParamB\"][i] + '\"';\r\n                code_lines += ' );\\n';\r\n            }\r\n\r\n            str += code_lines.split('<').join('&lt;').split('>').join('&gt;');\r\n            str += '</textarea>';\r\n            str += '<a class=\"tool_btn tool_wid\" style=\"width:100%;height:50px;display:block;line-height:50px;\" onmousedown=\"if ( CompileTrigger() ) UpdateGUIParams();\">Apply</a><br>';\r\n        } else {\r\n            // Normal GUI\r\n            var pre_temp = '<div id=\"rparams\"><div class=\"p_i\"><span class=\"pa1 p_u1 r_lt\">';   // Start off with rounded corners\r\n            var post_temp = ':</span><span class=\"pa2 p_u2 r_rt\" onclick=\"letedit(this, \\'';\r\n            var last_i = params_to_display.length - 2;                                          // Index to keep track of last row.\r\n            var value;\r\n\r\n            // Iterate through all the params to display.\r\n            for (i = 0; i < params_to_display.length; i++) {\r\n                if (paramscount_to_display[i] == 1) {\r\n                    value = GenParamVal(param_type[params_to_display[i]][1], paramsvalue_to_display[i]);\r\n                } else\r\n                    value = '<nochange>...</nochange>';\r\n\r\n                current_gui_params.push(param_associated[i]);\r\n\r\n                // Creating the actual row\r\n                str +=\r\n                    pre_temp +\r\n                    param_type[params_to_display[i]][2] +       // Label of the row. Eg: Name\r\n                    post_temp +\r\n                    param_type[params_to_display[i]][1]         // Type of input. Eg: string\r\n                    + '\\')\" onMouseOver=\"letover(this, \\'' +\r\n                    param_type[params_to_display[i]][1]\r\n                    + '\\')\" id=\"' + 'pm_' +\r\n                    param_type[params_to_display[i]][0]         // Name of property. Eg: __z_Index\r\n                    + '\">' +\r\n                    value +                                     // Value of proerty. Eg: 1\r\n                    '</span></div>';\r\n\r\n                // Add a tiny gap to split every trigger action.\r\n                if (first_selected_object._class == 'trigger') {\r\n\r\n                    if (i >= startSeparatorFrom && (i - startSeparatorFrom) % 3 == 0) {\r\n                        str += '<div style=\"height:2px\"></div>';\r\n                    }\r\n                }\r\n\r\n                // Last row will have bottom rounded corners 'r_lb', except for triggers.\r\n                if (first_selected_object._class != 'trigger' && i == last_i) {\r\n                    pre_temp = '<div class=\"p_i\"><span class=\"pa1 p_u0 r_lb\">';\r\n                    post_temp = ':</span><span class=\"pa2 p_u0 r_rb\" onclick=\"letedit(this, \\'';\r\n\r\n                    // First row has top rounded corners, now change it to no rounded corners.\r\n                } else if (i == 0) {\r\n                    pre_temp = '<div class=\"p_i\"><span class=\"pa1 p_u1\">';\r\n                    post_temp = ':</span><span class=\"pa2 p_u2\" onclick=\"letedit(this, \\'';\r\n                }\r\n            }\r\n\r\n            // Display additional trigger actions for extended triggers.\r\n            if (selects == 1 && first_selected_object._class == 'trigger' && first_selected_object.pm[\"extended\"]) {\r\n                //selectingAExtendedTrigger = true;\r\n                for(let i = 10; i < first_selected_object.pm[\"totalNumOfActions\"]; ++i){\r\n                    let triggerAction = first_selected_object.pm[\"additionalActions\"][i - 10] === undefined ? -1 : first_selected_object.pm[\"additionalActions\"][i - 10];\r\n                    let paramA        = first_selected_object.pm[\"additionalParamA\"][i - 10]  === undefined ? 0  : first_selected_object.pm[\"additionalParamA\"][i - 10];\r\n                    let paramB        = first_selected_object.pm[\"additionalParamB\"][i - 10]  === undefined ? 0  : first_selected_object.pm[\"additionalParamB\"][i - 10];\r\n\r\n                    // rowHTML represents all the HTML to display a set of triggers and parameters (3 rows).\r\n                    let rowHtml = `\r\n                        <div class=\"p_i\"><span class=\"pa1 p_u1\">\r\n                        Action '${i + 1}' type:\r\n                        </span><span class=\"pa2 p_u2 r_rt\" onclick=\"letedit(this, 'trigger_type')\" onmouseover=\"letover(this, 'trigger_type')\" id='pm_actions_${i + 1}_type'>\r\n                            <pvalue real='${triggerAction}'>\r\n                            ${special_values_table['trigger_type'][triggerAction]}\r\n                            </pvalue>\r\n                        </span></div>\r\n\r\n                        <div class=\"p_i\"><span class=\"pa1 p_u1\">\r\n                        - parameter A:\r\n                        </span><span class=\"pa2 p_u2 r_rt\" onclick=\"letedit(this, 'no_change')\" onmouseover=\"letover(this, 'no_change')\" id='pm_actions_${i + 1}_targetA'>\r\n                            <pvalue real='${paramA}'>\r\n                            '${paramA}'\r\n                            </pvalue>\r\n                        </span></div>\r\n\r\n                        <div class=\"p_i\"><span class=\"pa1 p_u1\">\r\n                        - parameter B:\r\n                        </span><span class=\"pa2 p_u2 r_rt\" onclick=\"letedit(this, 'no_change')\" onmouseover=\"letover(this, 'no_change')\" id='pm_actions_${i + 1}_targetB'>\r\n                            <pvalue real='${paramB}'>\r\n                            '${paramB}'\r\n                            </pvalue>\r\n                        </span></div>\r\n\r\n                        <div style=\"height:2px\"></div>\r\n                    `\r\n\r\n                    // Creating the actual row\r\n                    str += rowHtml;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Add edit text button.\r\n        if (selects == 1 && first_selected_object._class == 'trigger') {\r\n            if (edit_triggers_as_text)\r\n                str += '<a class=\"tool_btn tool_wid\" style=\"width:100%;display:block;\" onmousedown=\"edit_triggers_as_text=!edit_triggers_as_text;UpdateGUIParams()\">Edit triggers as param list</a>';\r\n            else\r\n                str += '<a class=\"tool_btn tool_wid\" style=\"width:100%;display:block;\" onmousedown=\"edit_triggers_as_text=!edit_triggers_as_text;UpdateGUIParams()\">Edit triggers as text</a>';\r\n        }\r\n        str += '</div>';\r\n        gui_params.innerHTML = str;\r\n\r\n        // Update the GUI to it's original scroll.\r\n        guiHTMLElement = document.getElementById(\"rparams\");\r\n\r\n        if(guiHTMLElement){\r\n            guiHTMLElement.scrollTop = amountToScroll;\r\n        }\r\n\r\n        StreetMagic();\r\n    }\r\n\r\n    /**\r\n     *  This function is invoked whenever someone clicks on an option in the dropdown menu of parameter values.\r\n     *  For example, clicking on \"Force Movable 'A' move to Region 'B'\"\r\n     *\r\n     *  Prompts for further input if required and updates the GUI.\r\n     *\r\n     *  @param {string} val1    The real actual value.\r\n     *  @param {string} val2    Name / Label of the value clicked.\r\n     *  @param {string} defval  Previous real value.\r\n     */\r\n    function setletedit(val1, val2, defval) {\r\n        const skipTriggerActions = [123, 361, 364, 365];\r\n\r\n        // Get the number and trigger type.\r\n        let regex = /actions_(\\d+)_(targetA|targetB|type)/g;\r\n        let match = Array.from(lettarget.id.replace('pm_', '').matchAll(regex))[0];\r\n\r\n        // Disallow skip trigger actions every 9th trigger action for triggers.\r\n        if(\r\n            Number(match && match[1]) % 9 === 0 && match[2] === 'type' && skipTriggerActions.includes(Number(val1))\r\n        ){\r\n            NewNote(\"Due to how extended triggers is implemented, skip trigger actions are disabled every 9th trigger action. Leave a 'Do Nothing' trigger action here instead.\", note_bad);\r\n            return;\r\n        }\r\n\r\n        quick_pick = false;\r\n        quick_pick_ignore_one_click = false;\r\n\r\n        // Clicked on a value that prompts for a number. Like number of trigger calls.\r\n        if (val1.indexOf('[val]') != -1) {\r\n            defval = Math.abs(Number(defval));\r\n            var txt = prompt('Enter value:', defval);\r\n            var gotval;\r\n\r\n            if (txt == null || txt == '') {\r\n                gotval = Math.abs(defval);\r\n            } else {\r\n                gotval = Math.abs(txt);\r\n            }\r\n            val1 = eval(val1.replace('[val]', gotval));\r\n            val2 = val2.replace('#', gotval);\r\n        }\r\n\r\n        // Clicked on a value that prompts for a hex colour code.\r\n        else if (val1.indexOf('[color]') != -1) {\r\n            defval = Math.abs(Number(defval));\r\n            var gotval = prompt('Enter value in format #XXXXXX:', defval);\r\n            if (gotval.charAt(0) != '#') {\r\n                gotval = '#' + gotval;\r\n            }\r\n            if (gotval.length != 7)\r\n                alert('Value ' + gotval + ' is not correct. Valid value must be in format #XXXXXX. Read about \"hex color codes\" for more information.');\r\n            val1 = val1.replace('[color]', gotval);\r\n            val2 = val2.replace('#', gotval);\r\n        }\r\n\r\n        // Updates the GUI with new value.\r\n        ff.value = '<pvalue real=\"' + val1 + '\">' + val2 + '</pvalue>';\r\n\r\n        lettarget.innerHTML = ff.value;\r\n        ff.style.display = 'none';\r\n        ff_drop.style.display = 'none';\r\n        letediting = false;\r\n\r\n        UpdatePhysicalParam((lettarget.id.replace('pm_', '')), val1);\r\n\r\n        var parameter_updated = lettarget.id.replace('pm_', '');\r\n\r\n        if (parameter_updated == 'mark' || (parameter_updated.indexOf('actions_') != -1 && parameter_updated.indexOf('_type') != -1))\r\n            StreetMagic();\r\n    }\r\n\r\n    /**\r\n     * Patches the current implementation of StreetMagic to support the implementation of extended trigger list.\r\n     * StreetMagic allows the parameter to change it's type \"trigger+none to value for an example\".\r\n     */\r\n    function StreetMagic() {\r\n        var mark_obj = document.getElementById('pm_mark');\r\n\r\n        // Finds engine mark.\r\n        if (mark_obj != null) {\r\n            var our_case = mark_pairs['mark_' + innerHTML_to_value(mark_obj.innerHTML)];\r\n            var valobj = document.getElementById(\"pm_forteam\");\r\n            if (our_case == undefined)\r\n                our_case = 'nochange';\r\n            eval('valobj.onclick = function(e){letedit(this, \\'' + our_case + '\\');}');\r\n            eval('valobj.onmouseover = function(e){letover(this, \\'' + our_case + '\\');}');\r\n            valobj.innerHTML = GenParamVal(our_case, innerHTML_to_value(valobj.innerHTML));\r\n\r\n            // Early exit, we are done here with engine mark.\r\n            return;\r\n        }\r\n\r\n        // Get current selection and check if it's an trigger.\r\n        let selected = SelectedObjects;\r\n        let totalNumOfActions = 10;\r\n        let isTrigger = false;\r\n        if(selected.length == 1 && selected[0]._class == \"trigger\"){\r\n            isTrigger = true;\r\n\r\n            // Check if it's an extended trigger.\r\n            if(selected[0].pm[\"extended\"]){\r\n                totalNumOfActions = selected[0].pm[\"totalNumOfActions\"];\r\n            }\r\n        }\r\n\r\n        // Early exit if it's not a trigger.\r\n        if(!isTrigger){\r\n            return;\r\n        }\r\n\r\n        // Iterate through all the trigger actions and modify their parameter type to reflect on the respective trigger actions.\r\n        for (var i = 1; i <= totalNumOfActions; i++) {\r\n            var mark_obj = document.getElementById('pm_actions_' + i + '_type');\r\n            if (mark_obj == null) {\r\n                aleiLog(SWARN, \"Failed to retrieve HTML element of property to dynamically apply property type.\");\r\n                break;\r\n            }\r\n\r\n            var cases = 'A';\r\n            // Alternate through parameter A and B.\r\n            for (var i2 = 0; i2 < 2; i2++) {\r\n                // Retrieve the corresponding parameter type based on trigger action.\r\n                var our_case = mark_pairs['trigger_type_' + cases + innerHTML_to_value(mark_obj.innerHTML)];\r\n\r\n                // Retrieve the corresponding HTML element.\r\n                var valobj = document.getElementById('pm_actions_' + i + '_target' + cases);\r\n\r\n                if (our_case == undefined) {\r\n                    our_case = 'nochange';\r\n                }\r\n\r\n                eval('valobj.onclick = function(e){letedit(this, \\'' + our_case + '\\');}');\r\n                eval('valobj.onmouseover = function(e){letover(this, \\'' + our_case + '\\');}');\r\n\r\n                valobj.innerHTML = GenParamVal(our_case, innerHTML_to_value(valobj.innerHTML));\r\n                cases = 'B';\r\n            }\r\n        }\r\n    }\r\n\r\n    let oldSaveThisMap = window.SaveThisMap;\r\n    /**\r\n     *  This function extends the SaveThisMap functionality by first parsing all instances of extended triggers into a linked list of normal triggers.\r\n     *\r\n     *  [FROM]                       |    [TO]\r\n     *  trigger*1                    |    trigger*1                             trigger*3                             trigger*3\r\n     *  extended:           true     |    extended:           true              *deleted*                             *deleted*\r\n     *  totalNumOfActions:  25       |    totalNumOfActions:  25                *deleted*                             *deleted*\r\n     *  additionalActions:  [..]     |    *deleted*                             *deleted*                             *deleted*\r\n     *  additionalParamA:   [..]     |    *deleted*                             *deleted*                             *deleted*\r\n     *  additionalParamB:   [..]     |    *deleted*                             *deleted*                             *deleted*\r\n     *  actions1-10         [..]     |    actions1-9          [..]              actions1-9   [..]                     actions1-7    [..]\r\n     *                               |    actions10           trigger*2         actions10    trigger*3                actions8-10   Do nothing.\r\n     *\r\n     *\r\n     *  @param {*} temp_to_real_compile_data     Parameters that the old SaveThisMap uses. (no idea what it is tbh)\r\n     *  @param {*} callback                      Parameters that the old SaveThisMap uses. (no idea what it is tbh)\r\n     */\r\n    function SaveThisMap(temp_to_real_compile_data='', callback=null) {\r\n        const gapBetweenTrigger = 40;\r\n        const switchExecutionAction = 363;\r\n\r\n        // Keep a reference to all the newly generated triggers, so we can delete them in the end.\r\n        let allGeneratedTriggers = new Array();\r\n\r\n        // Keep a copy of the properties all extended triggers. We will temporarily delete these additional properties before\r\n        // file save then restore them back to the respective triggers.\r\n        let allAdditionalActions = new Array();\r\n        let allAdditionalParamA = new Array();\r\n        let allAdditionalParamB = new Array();\r\n\r\n        // For every extended trigger..\r\n        for(const entity of es){\r\n            if(!entity.exists)              continue;\r\n            if(entity._class !== \"trigger\") continue;\r\n            if(!entity.pm[\"extended\"])      continue;\r\n\r\n            // The first trigger can only store 9 actions, as the last one is required to execute the next one.\r\n            // Let's push the 10th one to the front of respective arrays.\r\n            entity.pm[\"additionalActions\"].unshift(entity.pm[\"actions_10_type\"]);\r\n            entity.pm[\"additionalParamA\"].unshift(entity.pm[\"actions_10_targetA\"]);\r\n            entity.pm[\"additionalParamB\"].unshift(entity.pm[\"actions_10_targetB\"]);\r\n\r\n            // Calculate and create the number of triggers we need.\r\n            const triggersToCreate = Math.floor((entity.pm[\"totalNumOfActions\"] - 1) / 9);\r\n            let   startX = entity.pm[\"x\"] + gapBetweenTrigger;\r\n            const startY = entity.pm[\"y\"];\r\n\r\n            // Auto generate all the necessary triggers. Space them out evenly.\r\n            for(let i = 0; i < triggersToCreate; i++){\r\n                let name = `${entity.pm[\"uid\"]}'s extended trigger no: ${i}.`\r\n                let newTrigger = new E(\"trigger\");\r\n\r\n                // Set properties.\r\n                newTrigger.pm[\"x\"] = startX;\r\n                newTrigger.pm[\"y\"] = startY;\r\n                newTrigger.pm[\"uid\"] = name;\r\n\r\n                // If it's the first trigger, let the main extended trigger point to this.\r\n                if(i == 0){\r\n                    entity.pm[`actions_10_type`] = switchExecutionAction;\r\n                    entity.pm[`actions_10_targetA`] = name;\r\n                }\r\n\r\n                // If not the last trigger, point to the next trigger.\r\n                if(i < triggersToCreate - 1){\r\n                    name = `${entity.pm[\"uid\"]}'s extended trigger no: ${i + 1}.`\r\n                    newTrigger.pm[`actions_10_type`] = switchExecutionAction;\r\n                    newTrigger.pm[`actions_10_targetA`] = name;\r\n                }\r\n\r\n                // Set trigger action and parameters\r\n                for(let actionNum = 1; actionNum < 10; actionNum++){\r\n                    let index = i * 9 + (actionNum - 1);    // 0-8, 9-17, 18-26, ...\r\n\r\n                    newTrigger.pm[`actions_${actionNum}_type`]    = entity.pm[\"additionalActions\"][index] === undefined ? -1 : entity.pm[\"additionalActions\"][index];\r\n                    newTrigger.pm[`actions_${actionNum}_targetA`] = entity.pm[\"additionalParamA\"][index]  === undefined ? 0 :  entity.pm[\"additionalParamA\"][index];\r\n                    newTrigger.pm[`actions_${actionNum}_targetB`] = entity.pm[\"additionalParamB\"][index]  === undefined ? 0 :  entity.pm[\"additionalParamB\"][index];\r\n                }\r\n\r\n                es.push(newTrigger);\r\n                allGeneratedTriggers.push(newTrigger);\r\n                startX += gapBetweenTrigger;\r\n            }\r\n\r\n            // Delete additional properties, and save a copy to prepare for saving.\r\n            allAdditionalActions.push(JSON.parse(JSON.stringify(entity.pm[\"additionalActions\"])));\r\n            allAdditionalParamA.push(JSON.parse(JSON.stringify(entity.pm[\"additionalParamA\"])));\r\n            allAdditionalParamB.push(JSON.parse(JSON.stringify(entity.pm[\"additionalParamB\"])));\r\n\r\n            delete entity.pm[\"additionalActions\"];\r\n            delete entity.pm[\"additionalParamA\"];\r\n            delete entity.pm[\"additionalParamB\"];\r\n        }\r\n\r\n        // Save this map!\r\n        oldSaveThisMap(temp_to_real_compile_data, callback);\r\n\r\n        let index = 0;\r\n\r\n        // Post clean up.\r\n        for(const entity of es){\r\n            if(!entity.exists)              continue;\r\n            if(entity._class !== \"trigger\") continue;\r\n            if(!entity.pm[\"extended\"])      continue;\r\n\r\n            // Restore deleted additional properties.\r\n            entity.pm[\"additionalActions\"] = allAdditionalActions[index];\r\n            entity.pm[\"additionalParamA\"] = allAdditionalParamA[index];\r\n            entity.pm[\"additionalParamB\"] = allAdditionalParamB[index];\r\n\r\n            // Restore the 10th trigger action from arrays\r\n            entity.pm[`actions_10_type`]    = entity.pm[\"additionalActions\"].shift();\r\n            entity.pm[`actions_10_targetA`] = entity.pm[\"additionalParamA\"].shift();\r\n            entity.pm[\"additionalParamB\"].shift();\r\n            index++;\r\n        }\r\n\r\n        // Delete all generated triggers.\r\n        for(const newTrigger of allGeneratedTriggers){\r\n            newTrigger.exists = false;\r\n        }\r\n\r\n        UpdateGUIObjectsList();\r\n    }\r\n\r\n    /**\r\n     *  This function is responsible for compiling the text portion of the trigger action when saved.\r\n     *  It is further patched to support more than 10 triggers.\r\n     */\r\n    function CompileTrigger() {\r\n        const skipTriggerActions = [123, 361, 364, 365];\r\n        const selection = SelectedObjects;\r\n\r\n        if(selection.length != 1){\r\n            return;\r\n        }\r\n\r\n        const selectedTrigger = selection[0];\r\n\r\n        var opcode_field = document.getElementById('opcode_field');\r\n        var code = opcode_field.value;\r\n        var code_lines = code.split('\\n');\r\n        var new_trigger_actions = [];\r\n        var direct_update_params = [];\r\n        var direct_update_values = [];\r\n\r\n        function ScheduleParamSet(a, b) {\r\n            direct_update_params.push(a);\r\n            direct_update_values.push(b);\r\n        }\r\n\r\n        for (var i = 0; i < code_lines.length; i++) {\r\n            var line = code_lines[i];\r\n\r\n            let paramA_start = line.indexOf('( \"');\r\n            let separator = line.indexOf('\", \"');\r\n            let end = line.indexOf('\" );');\r\n            let semicolon = line.indexOf(':');\r\n\r\n            // Parsing list of trigger actions\r\n            if (paramA_start != -1 && separator != -1 && end != -1) {\r\n                var first_c = line.indexOf('(');\r\n                var opcode = line.substring(0, first_c);\r\n                var action_type = -1;\r\n                if (opcode.substring(0, 2) == 'op' && !isNaN(opcode.slice(2)))\r\n                    action_type = parseInt(opcode.slice(2));\r\n                else {\r\n                    action_type = trigger_opcode_aliases.indexOf(opcode);\r\n                    if (action_type == -1) {\r\n                        NewNote('Error: Changes were not applied because &quot;' + opcode + '&quot; seems to be an unknown operation code.', note_neutral);\r\n                        return;\r\n                    }\r\n                }\r\n                var valueA = '';\r\n                var valueB = '';\r\n                if (action_type != -1) {\r\n                    valueA = line.substring(paramA_start + 3, separator);\r\n                    valueB = line.substring(separator + 4, end);\r\n                }\r\n\r\n                new_trigger_actions.push([action_type, valueA, valueB]);\r\n\r\n            }\r\n            // Parsing the header portion..\r\n            else if (semicolon != -1) {\r\n                var left_part = line.substring(0, semicolon);\r\n                var right_part = line.slice(semicolon + 1);\r\n                while (left_part.charAt(0) == ' ')\r\n                    left_part = left_part.slice(1);\r\n                while (left_part.charAt(left_part.length - 1) == ' ')\r\n                    left_part = left_part.slice(0, -1);\r\n                while (right_part.charAt(0) == ' ')\r\n                    right_part = right_part.slice(1);\r\n                while (right_part.charAt(right_part.length - 1) == ' ')\r\n                    right_part = right_part.slice(0, -1);\r\n                if (left_part == 'uid' || left_part == 'enabled' || left_part == 'maxcalls' || left_part == 'execute')\r\n                    ScheduleParamSet(left_part, right_part);\r\n                else {\r\n                    NewNote('Error: Changes were not applied because &quot;' + left_part + '&quot; seems to be not a default property.', note_neutral);\r\n                    return false;\r\n                }\r\n            } else if (line != '') {\r\n                NewNote('Error: Changes were not applied because line &quot;' + line + '&quot; wasn\\'t recognized or contains unsupported syntax.', note_neutral);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        let hasEncounteredSkipTrigger = false;\r\n        // Retrieve all the trigger action.\r\n        for (let i = 0; i < new_trigger_actions.length; i++) {\r\n            // A skip trigger action for every 9th trigger action. Add a do nothing trigger action.\r\n            if((i + 1) % 9 === 0 && skipTriggerActions.includes(new_trigger_actions[i][0])){\r\n                new_trigger_actions.splice(i, 0, [-1, 0, 0]);\r\n                hasEncounteredSkipTrigger = true;\r\n            }\r\n\r\n            ScheduleParamSet('actions_' + (i + 1) + '_type', new_trigger_actions[i][0]);\r\n            ScheduleParamSet('actions_' + (i + 1) + '_targetA', new_trigger_actions[i][1]);\r\n            ScheduleParamSet('actions_' + (i + 1) + '_targetB', new_trigger_actions[i][2]);\r\n        }\r\n\r\n        // Populate the rest with empty trigger actions if it's lesser than 10.\r\n        for(let i = new_trigger_actions.length + 1; i <= 10; i++){\r\n            ScheduleParamSet('actions_' + i + '_type', -1);\r\n            ScheduleParamSet('actions_' + i + '_targetA', 0);\r\n            ScheduleParamSet('actions_' + i + '_targetB', 0);\r\n        }\r\n\r\n        if(hasEncounteredSkipTrigger){\r\n            NewNote(\"Skip trigger actions encountered in every 9th trigger action. Inserted an 'Do Nothing' trigger action.\", note_neutral);\r\n        }\r\n\r\n        // Convert it back to a normal trigger if it doesnt have more than 10 actions\r\n        if(new_trigger_actions.length <= 10 && selectedTrigger.pm[\"extended\"]){\r\n            addTriggerActionCount(-selectedTrigger.pm[\"totalNumOfActions\"]);\r\n        }\r\n        else{\r\n            // Adjust extended trigger's size\r\n            if(selectedTrigger.pm[\"extended\"]){\r\n                let difference = new_trigger_actions.length - selectedTrigger.pm[\"totalNumOfActions\"] ;\r\n                addTriggerActionCount(difference);\r\n            }\r\n            // Convert normal trigger to extended trigger.\r\n            else{\r\n                let addOn = new_trigger_actions.length - 10;\r\n                addTriggerActionCount(addOn);\r\n            }\r\n        }\r\n\r\n        for(let i = 0; i < direct_update_params.length; ++i){\r\n            UpdatePhysicalParam(direct_update_params[i], direct_update_values[i], false);\r\n        }\r\n\r\n        NewNote(\"Trigger updated successfully.\", note_good);\r\n        return true;\r\n    }\r\n\r\n    window.setletedit = setletedit;\r\n    window.StreetMagic = StreetMagic;\r\n    window.SaveThisMap = SaveThisMap;\r\n    window.CompileTrigger = CompileTrigger;\r\n\r\n    // the current serialisation and unserialisation used is an external library Eric used\r\n    // it is currently used by the Copy and Paste clipboard functions\r\n    // however, it does not work with arrays, turning them into objects instead.\r\n    // therefore, Nyove has decided to overwrite these library\r\n    window.serialize = JSON.stringify;\r\n    window.unserialize = JSON.parse;\r\n    window.UpdateGUIParams = newUpdateGUIParams;\r\n\r\n    // Patch the render function's connection line to work with >10 trigger actions.\r\n    /*let RenderInString = window.Render.toString().replaceAll(\r\n        /es\\[(i2?)\\]\\.pm\\[ property \\];/g,\r\n        `es[$1].pm[ property ];\r\n        let array;\r\n        if(Array.isArray(value)) {\r\n            array = value;\r\n        }\r\n        else {\r\n            array = [value];\r\n        }\r\n\r\n        for(let index = 0, value = array[index]; index < array.length; ++index, value = array[index])\r\n        `\r\n    );\r\n\r\n    // Patch function for strict mode compliance\r\n    RenderInString = RenderInString.toString().replaceAll(\r\n        `for ( property in`,\r\n        `for ( let property in`\r\n    );\r\n\r\n    window.Render = eval(`(${RenderInString})`);*/\r\n}\r\n\r\n/** This function is invoked whenever the map loads.\r\n *\r\n *  It looks for potential triggers configured in a linked list manner and converts it to an extended trigger.\r\n */\r\nfunction parseExtendedTriggers(){\r\n    const maxIteration = 1000;\r\n    const switchExecutionAction = 363;\r\n\r\n    // Find all extended triggers.\r\n    for(const entity of es){\r\n        if(!entity.exists)              continue;\r\n        if(entity._class !== \"trigger\") continue;\r\n        if(!entity.pm[\"extended\"])      continue;\r\n\r\n        let iterationCount = 1;\r\n        let previousTotalNumOfActions = entity.pm[\"totalNumOfActions\"];\r\n\r\n        // Create extended trigger's additional properties.\r\n        entity.pm[\"totalNumOfActions\"] = 9;\r\n        entity.pm[\"additionalActions\"] = new Array();\r\n        entity.pm[\"additionalParamA\"] = new Array();\r\n        entity.pm[\"additionalParamB\"] = new Array();\r\n\r\n        let currentTrigger = entity;\r\n\r\n        // Iterate through the linked list, pointed by the 10th trigger action.\r\n        let nextTriggerIndex = es.findIndex(e => e.pm[\"uid\"] === currentTrigger.pm[\"actions_10_targetA\"] && currentTrigger.pm[\"actions_10_type\"] === switchExecutionAction);\r\n\r\n        while(nextTriggerIndex !== -1){\r\n            let nextTrigger = es[nextTriggerIndex];\r\n\r\n            // Retrieve all trigger actions.\r\n            for(let i = 1; i <= 9; ++i){\r\n                // The very first entry of additional actions and parameters belongs to action 10\r\n                if(i === 1 && iterationCount === 1){\r\n                    entity.pm[\"actions_10_type\"] = nextTrigger.pm[`actions_1_type`];\r\n                    entity.pm[\"actions_10_targetA\"] = nextTrigger.pm[`actions_1_targetA`];\r\n                    entity.pm[\"actions_10_targetB\"] = nextTrigger.pm[`actions_1_targetB`];\r\n                    continue;\r\n                }\r\n\r\n                entity.pm[\"additionalActions\"].push(nextTrigger.pm[`actions_${i}_type`]);\r\n                entity.pm[\"additionalParamA\"].push(nextTrigger.pm[`actions_${i}_targetA`]);\r\n                entity.pm[\"additionalParamB\"].push(nextTrigger.pm[`actions_${i}_targetB`]);\r\n            }\r\n\r\n            entity.pm[\"totalNumOfActions\"] += 9;\r\n\r\n            // Remove those auto generated triggers\r\n            es.splice(nextTriggerIndex, 1);\r\n\r\n            // Continue iterating\r\n            currentTrigger = nextTrigger;\r\n            nextTriggerIndex = es.findIndex(e => e.pm[\"uid\"] === currentTrigger.pm[\"actions_10_targetA\"] && currentTrigger.pm[\"actions_10_type\"] === switchExecutionAction);\r\n\r\n            // Protect users from potential infinite iteration.\r\n            iterationCount++;\r\n            if(iterationCount > maxIteration){\r\n                aleiLog(note_bad, \"When parsing extended triggers, potentially reached an infinite loop.\");\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Shrink extended trigger to previously saved size if the last few trigger actions is empty.\r\n        if(previousTotalNumOfActions){\r\n            const doNothingTriggerAction = -1;\r\n            let isAllEmpty = true;\r\n\r\n            for(let i = previousTotalNumOfActions + 1; i < entity.pm[\"totalNumOfActions\"]; i++){\r\n                if(entity.pm[\"additionalActions\"][i - 11] != doNothingTriggerAction){\r\n                    isAllEmpty = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            // Shrink the trigger action.\r\n            if(isAllEmpty){\r\n                let difference = entity.pm[\"totalNumOfActions\"] - previousTotalNumOfActions;\r\n                entity.pm[\"additionalActions\"].length -= difference;\r\n                entity.pm[\"additionalParamA\"].length -= difference;\r\n                entity.pm[\"additionalParamB\"].length -= difference;\r\n                entity.pm[\"totalNumOfActions\"] = previousTotalNumOfActions;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Function that adds new CSS style to ALE.\r\n * - Add style rule for 2 side by side button\r\n *\r\n * This function is run once in ALE_Start.\r\n */\r\nfunction updateCSSFile() {\r\n    const cssFile = document.styleSheets[0];\r\n\r\n    if(!cssFile){\r\n        aleiLog(WARN, \"Failed to update CSS file.\");\r\n        return;\r\n    }\r\n\r\n    // Creates a new rule for class two-element-grid, useful as a parent div.\r\n    cssFile.insertRule(\".two-element-grid{ display: grid; justify-content: center; grid-template-columns: 50% 50%; }\", 0);\r\n}\r\n\r\n// Creates mapping of object connections so that we don't recreate line mapping everytime.\r\n// This will be used in Render function for when we are drawing object connection lines.\r\nfunction __OCM_AddReference(from, to) {\r\n    let ocm = ObjectConnectionMapping;\r\n    if(ocm[from][\"to\"].indexOf(to) === -1) ocm[from][\"to\"].push(to);\r\n    if(ocm[to][\"by\"].indexOf(from) === -1) ocm[to][\"by\"].push(from);\r\n}\r\nfunction __OCM_RemoveReference(from, to) {\r\n    let ocm = ObjectConnectionMapping;\r\n    if(ocm[from][\"to\"].indexOf(to) !== -1) ocm[from][\"to\"].splice(ocm[from][\"to\"].indexOf(to), 1);\r\n    if(ocm[to][\"by\"].indexOf(from) !== -1) ocm[to][\"by\"].splice(ocm[to][\"by\"].indexOf(from), 1);\r\n}\r\n\r\n/*\r\n * __OCM_HandleObject\r\n * Function responsible for internal registration of object mappings.\r\n *\r\n *@param {E}   element   PB2 object to create connection mapping of.\r\n*/\r\n\r\nfunction __OCM_HandleObject(element) {\r\n    let ocm = ObjectConnectionMapping;\r\n    let utem = uidToElementMap;\r\n\r\n\r\n    if(element.pm.uid === undefined) return;\r\n    if(element.pm.uid === \"#water\") {\r\n        element.pm.uid = RandomizeName(element.pm.uid); // I don't see why not\r\n    };\r\n\r\n    function Trigger_HandleParameter(trigger, parameter) {\r\n        if(typeof(parameter) !== \"string\") return;\r\n\r\n        if(utem[parameter] !== undefined) { // Simple case where parameter is simply reference to object.\r\n            __OCM_AddReference(trigger, parameter);\r\n            return;\r\n        }\r\n        if(parameter.includes(\",\") == false) return;\r\n        // A little complex case where multiple objects are referenced\r\n        // As in Parameter B: #region*1,#region*2\r\n        let splt = parameter.split(\",\");\r\n        for(let value of splt) {\r\n            let val = value.trim();\r\n            if(utem[val] !== undefined) __OCM_AddReference(trigger, val);\r\n        }\r\n    }\r\n\r\n    // Eliminating parameters we don't need to look at.\r\n    for(let key of Object.keys(element.pm)) {\r\n        if(__OCM_CHECKED_KEYS.indexOf(key) === -1) continue;\r\n        let value = element.pm[key];\r\n        if(utem[value] === undefined) continue; // Not valid object, just skip.\r\n\r\n        __OCM_AddReference(element.pm.uid, value);\r\n    }\r\n    // Special case for trigger actions.\r\n    if(element._class !== \"trigger\") return;\r\n    let pm = element.pm;\r\n    // Vanilla trigger case (10 actions, extended triggers will run this too)\r\n    for(let i = 1; i < 11; i++) {\r\n        if(pm[`actions_${i}_type`] == -1) continue;\r\n        if(pm[`actions_${i}_type`] === undefined) continue;\r\n        Trigger_HandleParameter(pm.uid, pm[`actions_${i}_targetA`]);\r\n        Trigger_HandleParameter(pm.uid, pm[`actions_${i}_targetB`]);\r\n    }\r\n    // Extended triggers.\r\n    if(pm.extended === undefined) return;\r\n\r\n    let actions = pm.additionalActions;\r\n    let paramA = pm.additionalParamA;\r\n    let paramB = pm.additionalParamB;\r\n\r\n    for(let i = 0; i < actions.length; i++) {\r\n        if(actions[i] === -1) continue;\r\n        Trigger_HandleParameter(pm.uid, paramA[i]);\r\n        Trigger_HandleParameter(pm.uid, paramB[i]);\r\n    }\r\n}\r\n\r\n/*\r\n * OCM_onObjectDelete\r\n * Function that gets called in DeleteSelection.\r\n * This just keeps Object Connection Map with latest data.\r\n\r\n * @param {E} element   PB2 element that got deleted.\r\n*/\r\nfunction OCM_onObjectDelete(element) {\r\n    if(!(aleiSettings.rematchUID && aleiSettings.ocmEnabled)) return;\r\n    if(element.pm.uid == undefined) return;\r\n    if(!OCM_LOADED) return;\r\n\r\n    let uid = element.pm.uid;\r\n    let ocm = window.ObjectConnectionMapping;\r\n    let utem = window.uidToElementMap;\r\n\r\n    let referredBy = ocm[uid].by;\r\n    let referringTo = ocm[uid].to;\r\n\r\n    // TODO: Make this bit safer? Some hard limit?\r\n    while(ocm[uid].by.length != 0) __OCM_RemoveReference(ocm[uid].by[0], uid);\r\n    while(ocm[uid].to.length != 0) __OCM_RemoveReference(uid, ocm[uid].to[0]);\r\n\r\n    // This cannot happen anymore\r\n    if((ocm[uid].by.length != 0) || (ocm[uid].to.length != 0)) {\r\n        NewNote(`ALEI: Something is wrong with Object Connection Map. Please regenerate map by loading the map again.`, `#FF0000`);\r\n        debugger;\r\n    }\r\n\r\n    delete utem[uid];\r\n    delete ocm[uid];\r\n\r\n}\r\n\r\nfunction CreateConnectionMapping() {\r\n    OCM_LOADED = false;\r\n    window.ObjectConnectionMapping = {};\r\n    window.uidToElementMap = {};\r\n\r\n    if(!aleiSettings.rematchUID) return; // Rematch UID is not necessarily a requirement for OCM but it is requirement if I wanna be lazy\r\n    if(!aleiSettings.ocmEnabled) return;\r\n\r\n    let ocm = ObjectConnectionMapping;\r\n    let utem = uidToElementMap;\r\n\r\n    for(let element of es) {\r\n        if(!element.exists) continue;\r\n        if(element.pm.uid === undefined) continue;\r\n        if(element.pm.uid === \"#water\") continue;\r\n\r\n        if(ocm[element.pm.uid] !== undefined) {\r\n            NewNote(`ALEI: 2+ objects share name ${element.pm.uid}, going to stop constructing object connection map.`, \"#FF0000\");\r\n            window.ObjectConnectionMapping = {};\r\n            return;\r\n        }\r\n\r\n        ocm[element.pm.uid] = {\"by\": [], \"to\": []};\r\n        utem[element.pm.uid] = element;\r\n    }\r\n\r\n    for(let element of es) __OCM_HandleObject(element);\r\n    OCM_LOADED = true;\r\n    aleiLog(DEBUG, \"Built object connection map.\");\r\n}\r\n\r\nfunction patchRender() {\r\n    // This is where Render will be patched.\r\n    // Due to nature of this function, maybe it'll be better to call this function each time a patch is needed.\r\n    // And to support that, this function will strictly work on ALE_Render than current Render\r\n    if(aleiSettings.customRenderer) {\r\n        // Check https://github.com/LisABC/ALEI/blob/main/expRenderer.user.js\r\n        // This is simply minified version of that file.\r\n        // Minified with https://www.toptal.com/developers/javascript-minifier\r\n        \"use strict\";let decorRequestsOnProgress=[],backgroundRequestsOnProgress=[],boxModelImages={},aleiRunning=!1,haveForcedRecalculation=!1,displayFPS=0,fpsAccumulator=0,totalRenderedObjects=0,lastTime=0,draw_rect,draw_rect_edges,draw_gridlines,draw_image,ctx,canvasHeight,canvasWidth,gridOpacity,mClickX,mClickY,mCurrentX,mCurrentY,w2s_x,w2s_y,s2w_x,s2w_y,w2s_h,w2s_w,s2w_h,s2w_w,previewBackground=\"1\";function _readStorage(e,t,o){let r=`ALEI_Renderer_${e}`;return void 0===localStorage[r]?t:o(localStorage[r])}let toggles={cartoonishEdges:_readStorage(\"CartoonishEdges\",!1,e=>\"true\"===e),originalSelectOverlay:_readStorage(\"OriginalSelectOverlay\",!1,e=>\"true\"===e),boxRendering:_readStorage(\"PreviewWalls\",!1,e=>\"true\"===e)},themes={0:{backgroundColor:\"#5880AB\",gridColor:\"#FFFFFF\",selectOutlineColor:\"#A5A500\",selectEdgeOpacityFactor:1,selectTextColor:\"#FF0\",selectionColor:\"#FFF\",selectionCtrlColor:\"#AFA\",selectionAltColor:\"#FAA\",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:window.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:\"#66ff66\",objectConnectionFromColor:\"#ffffff\",objectConnectionOpacityFactor:1},1:{backgroundColor:\"#222222\",gridColor:\"#888888\",selectOutlineColor:\"#FFFF00\",selectEdgeOpacityFactor:1,selectTextColor:\"#FF0\",selectionColor:\"#FFF\",selectionCtrlColor:\"#AFA\",selectionAltColor:\"#FAA\",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:window.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:\"#66ff66\",objectConnectionFromColor:\"#ffffff\",objectConnectionOpacityFactor:1},2:{backgroundColor:\"#222222\",gridColor:\"#FFFFFF\",selectOutlineColor:\"#FFFF00\",selectEdgeOpacityFactor:1,selectTextColor:\"#FF0\",selectionColor:\"#FFF\",selectionCtrlColor:\"#AFA\",selectionAltColor:\"#FAA\",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:window.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:\"#66ff66\",objectConnectionFromColor:\"#ffffff\",objectConnectionOpacityFactor:1},3:{backgroundColor:\"#222222\",gridColor:\"#FFFFFF\",selectOutlineColor:\"#FFFF00\",selectEdgeOpacityFactor:1,selectTextColor:\"#FF0\",selectionColor:\"#FFF\",selectionCtrlColor:\"#AFA\",selectionAltColor:\"#FAA\",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:window.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:\"#66ff66\",objectConnectionFromColor:\"#ffffff\",objectConnectionOpacityFactor:1},4:{backgroundColor:\"#222222\",gridColor:\"#FFFFFF\",selectOutlineColor:\"#FFFF00\",selectEdgeOpacityFactor:1,selectTextColor:\"#FF0\",selectionColor:\"#FFF\",selectionCtrlColor:\"#AFA\",selectionAltColor:\"#FAA\",selectionOpacity:.1,selectionEdgeOpacity:.8,highLightedObjEdgeColor:window.selgrd3,highLightedObjEdgeOpacity:1,objectConnectionDash:[4,4],objectConnectionToColor:\"#66ff66\",objectConnectionFromColor:\"#ffffff\",objectConnectionOpacityFactor:1}},currentTheme;function RenderGrid(){gridOpacity<=0||(ctx.fillStyle=currentTheme.gridColor,draw_gridlines(10,.08*gridOpacity),draw_gridlines(100,.32*gridOpacity),draw_gridlines(300,.64*gridOpacity),ctx.globalAlpha=.7*gridOpacity,draw_rect(0,w2s_y(0),canvasWidth,1),draw_rect(w2s_x(0),0,1,canvasHeight))}let objectColors={box:{col:\"#FFF\",edgeCol:\"#FFF\"},door:{col:\"#000\",edgeCol:\"#000\",invisibleOpacityFactor:.05},water:{col:\"#3592B9\",edgeCol:\"#91EAFF\",opacityFactor:.24,acidCol:\"#BBFB59\",acidEdgeCol:\"#91EAFF\",acidOpacityFactor:.81},pushf:{col:\"#2BFF40\",edgeCol:\"#3CFF4F\"},region:{col:\"#FFD52B\",edgeCol:\"#FFB03C\",edgeOpacityFactor:.5,buttonOpacityFactor:.5},bg:{col:\"#000\",edgeCol:\"#910000\",edgeOpacityFactor:.3,coloredOpacityFactor:.22}},regionImages={1:window.img_region,9:window.img_region_red,10:window.img_region_blue};function _DrawRectangle(e,t,o,r,i,l,c){ctx.globalAlpha=t,c?(toggles.cartoonishEdges?ctx.strokeColor=e:ctx.strokeStyle=e,draw_rect_edges(o,r,i,l)):(ctx.fillStyle=e,draw_rect(o,r,i,l))}function ObjIsHighlighted(e,t){if(!window.m_drag_selection||window.lmd||!window.MatchLayer(e))return;let o=w2s_x(Math.min(mClickX,mCurrentX)),r=w2s_y(Math.min(mClickY,mCurrentY)),i=w2s_w(Math.abs(mCurrentX-mClickX)),l=w2s_h(Math.abs(mCurrentY-mClickY)),c=t.x,n=t.y,s=t.w,a=t.h;return!(c+s<o)&&!(o+i<c)&&!(n+a<r)&&!(r+l<n)}function RenderSingleResizableObject(e,t){let o=e._class,r=objectColors[o];if(void 0===r)return;let i=window.MatchLayer(e)?1:.3,l=e.pm,c=w2s_x(l.x),n=w2s_y(l.y),s=w2s_w(l.w),a=w2s_h(l.h),d=r.col,g=r.edgeCol,h=r.opacityFactor?r.opacityFactor:.2,u=r.edgeOpacityFactor?r.edgeOpacityFactor:1;if(\"bg\"==o&&void 0==window.CACHED_BGS[l.m]&&-1==backgroundRequestsOnProgress.indexOf(l.m)&&(window.ServerRequest(`a=get_images&for_class=bg_model&update_const=${l.m}`,\"request_consts\"),backgroundRequestsOnProgress.push(l.m)),\"door\"==o&&(0===l.vis||!1===l.vis||\"false\"===l.vis))h=r.invisibleOpacityFactor;else if(\"water\"==o&&e.pm.damage>0)d=r.acidCol,g=r.acidEdgeCol,h=r.acidOpacityFactor;else if(\"region\"==o&&-1!==[1,9,10].indexOf(parseInt(l.use_on))){ctx.globalAlpha=i*r.buttonOpacityFactor;draw_image(regionImages[l.use_on],w2s_x(l.x+Math.round((l.w-41)/2)),w2s_y(l.y+Math.round((l.h-51)/2)),w2s_w(41),w2s_h(31))}else\"bg\"==o&&7==l.c.length&&(d=l.c,h=r.coloredOpacityFactor);if(window.SHOW_TEXTURES){if(\"box\"!=o||toggles.boxRendering){if(\"box\"==o&&toggles.boxRendering){let w=boxModelImages[l.m];void 0==w&&(w=new Image,boxModelImages[l.m]=w,w.src=`pic.php?c=3&m=${l.m}`,w.width=16,w.height=16),void 0==w.pattern&&(w.pattern=ctx.createPattern(w,\"repeat-x\")),ctx.globalAlpha=1,ctx.save(),ctx.beginPath(),ctx.rect(c,n,s,a),ctx.closePath(),ctx.clip(),ctx.translate(w2s_x(0),w2s_y(0)),ctx.scale(w2s_x(1)-w2s_x(0),w2s_y(1)-w2s_y(0)),ctx.beginPath(),ctx.fillStyle=w.pattern,ctx.rect(s2w_x(0),s2w_y(0),s2w_w(canvasWidth),s2w_h(canvasHeight)),ctx.fill(),ctx.restore()}else if(\"bg\"==o&&void 0!==window.CACHED_BGS[l.m]&&window.CACHED_BGS[l.m].loaded){-1!==backgroundRequestsOnProgress.indexOf(l.m)&&backgroundRequestsOnProgress.splice(backgroundRequestsOnProgress.indexOf(l.m),1),ctx.globalAlpha=1;let x=window.CACHED_BGS[l.m];if(void 0==x.pattern&&(x.pattern=ctx.createPattern(x,\"repeat\")),ctx.save(),ctx.beginPath(),ctx.rect(c,n,s,a),ctx.closePath(),ctx.clip(),ctx.translate(w2s_x(0),w2s_y(0)),ctx.scale(w2s_x(1)-w2s_x(0),w2s_y(1)-w2s_y(0)),ctx.translate(l.u,l.v),ctx.beginPath(),ctx.fillStyle=x.pattern,ctx.rect(s2w_x(0),s2w_y(0),s2w_w(canvasWidth),s2w_h(canvasHeight)),ctx.fill(),ctx.restore(),7==l.c.length){let m=ctx.globalCompositeOperation;ctx.globalCompositeOperation=\"multiply\",_DrawRectangle(l.c,1,c,n,s,a,!1),ctx.globalCompositeOperation=m}}}else d=\"#000\",h=1,g=\"#333\"}ObjIsHighlighted(e,t)&&(g=currentTheme.highLightedObjEdgeColor,u=currentTheme.highLightedObjEdgeOpacity/i),e.selected&&!toggles.originalSelectOverlay&&(g=currentTheme.selectOutlineColor,u=currentTheme.selectEdgeOpacityFactor),window.SHOW_TEXTURES&&(\"bg\"==o||\"box\"==o&&toggles.boxRendering)||_DrawRectangle(d,i*h,c,n,s,a,!1),window.SHOW_TEXTURES||_DrawRectangle(g,i*u,c,n,s,a,!0)}function RenderNRObjectBox(e,t,o){let r=e.pm,i=r.x,l=r.y,c=window.ThinkOfBBoxClass(e._class,e),n=window.bo_x[c],s=window.bo_y[c],a=window.bo_w[c],d=window.bo_h[c],g,h=w2s_y(l+s),u,w=w2s_h(d);-1!=r.side?(g=w2s_x(i+n),u=w2s_w(a)):(g=w2s_x(i-n),g+=u=w2s_w(-a),u=-u),_DrawRectangle(t,o,g,h,u,w,!0)}function RenderSingleNonResizableObject(e,t){let o=e._class,r=window.MatchLayer(e)?1:.3,i=e.pm,l=i.x,c=i.y,n=\"#000\",s=.1;ObjIsHighlighted(e,t)&&(n=currentTheme.highLightedObjEdgeColor,s=currentTheme.highLightedObjEdgeOpacity/r),e.selected&&!toggles.originalSelectOverlay&&(n=currentTheme.selectOutlineColor,s=currentTheme.selectEdgeOpacityFactor),RenderNRObjectBox(e,n,r*s),ctx.globalAlpha=r;let a=!1;if(\"decor\"==o){let d=i.model;void 0==window.special_values_table.decor_model[d]&&-1==decorRequestsOnProgress.indexOf(d)&&(window.ServerRequest(`a=get_images&for_class=decor_model&update_const=${d}`,\"request_consts\"),decorRequestsOnProgress.push(d)),(0!=i.r||1!=i.sx||1!=i.sy)&&(ctx.save(),ctx.translate(w2s_x(l),w2s_y(c)),ctx.rotate(i.r/180*Math.PI),ctx.scale(i.sx,i.sy),ctx.translate(-w2s_x(l),-w2s_y(c)),a=!0)}let g=window.ThinkOfOffsetClass(o,e),h=-1!=i.side?1:-1,u=w2s_x(l+h*window.lo_x[g]),w=w2s_y(c+window.lo_y[g]),x=w2s_w(h*window.lo_w[g]),m=w2s_h(window.lo_h[g]);if(-1==h&&(ctx.save(),ctx.translate(2*u+x,0),ctx.scale(-1,1)),-1!==[\"player\",\"enemy\"].indexOf(o))draw_image(window.img_chars_full[i.char],w2s_x(i.x-36),w2s_y(i.y-104),w2s_w(110),w2s_h(130));else if(\"decor\"!=o||void 0===window.CACHED_DECORS[i.model]||window.CACHED_DECORS[i.model].native)draw_image(window.img_decide(e),u,w,x,m);else{-1!==decorRequestsOnProgress.indexOf(i.model)&&decorRequestsOnProgress.splice(decorRequestsOnProgress.indexOf(i.model),1);let C=window.CACHED_DECORS[i.model];draw_image(C,w2s_x(i.x+i.u),w2s_y(i.y+i.v),w2s_w(C.width),w2s_h(C.height))}-1==h&&ctx.restore(),a&&ctx.restore()}function GetObjectCoordAndSize(e){let t=e.pm,o,r,i,l;if(e._isresizable)o=w2s_x(t.x),r=w2s_y(t.y),i=w2s_w(t.w),l=w2s_h(t.h);else{let c=window.ThinkOfBBoxClass(e._class,e);r=w2s_y(t.y+window.bo_y[c]),l=w2s_h(window.bo_h[c]),-1!=t.side?(o=w2s_x(t.x+window.bo_x[c]),i=w2s_w(window.bo_w[c])):(o=w2s_x(t.x-window.bo_x[c]),o+=i=w2s_w(-window.bo_w[c]),i=-i)}return{x:o,y:r,w:i,h:l}}function RenderObjectMarkAndName(e,t){if(!window.ENABLE_TEXT||void 0==e.pm.uid||!window.MatchLayer(e))return;void 0==window.last_title_density&&(window.last_title_density=0);let o=t.x+t.w/2,r=t.y+t.h/2,i=e.selected&&e.hit(!1);ctx.font=\"normal 10px Arial\";let l=e.pm.uid,c=ctx.measureText(l);if(c.height=10,i&&(c.height=12),window.mouse_x>o-30&&window.mouse_x<o+30&&window.mouse_y>r-30&&window.mouse_y<r+30&&title_density++,ctx.globalAlpha=1,window.last_title_density>1&&!i){let n=Math.sqrt(Math.pow(window.mouse_x-o,2)+Math.pow(window.mouse_y-r,2));n<60&&(e.selected?ctx.globalAlpha=Math.max(.3,1/window.last_title_density):(o-=(window.mouse_x-o)*Math.pow((60-n)/60,2)*(4+Math.min(6,.1*window.last_title_density)),r-=(window.mouse_y-r)*Math.pow((60-n)/60,2)*(4+Math.min(6,.1*window.last_title_density)),window.last_title_density>1&&(ctx.globalAlpha=Math.max(.4,1-.1*window.last_title_density))))}let s=Math.round(o-c.width/2),a=Math.round(r-c.height/2);window.ENABLE_SHADOWS&&(ctx.fillStyle=\"rgba(0,0,0,0.1)\",ctx.fillRect(s-2,a-2,c.width+4,c.height+4),ctx.fillRect(s-4,a-4,c.width+8,c.height+8)),ctx.fillStyle=\"#FFF\",i&&(ctx.fillStyle=\"#fffb91\"),e.selected&&(ctx.fillStyle=currentTheme.selectTextColor),ctx.fillText(l,s,a+8+(c.height-10)/2),window.last_title_density=window.title_density}function RenderSelectOverlay(e,t){e.selected&&toggles.originalSelectOverlay&&(ctx.globalAlpha=.2,ctx.fillStyle=window.selgrd2,draw_rect(t.x,t.y,t.w,t.h),ctx.globalAlpha=1,ctx.fillStyle=\"#FFF\",window.MyDrawSelection(t.x-2,t.y-2,t.w+4,t.h+4))}function ChangeCursorIfHitsBorder(e,t){if(!e.selected||!e._isresizable||!window.MatchLayer(e))return;t.x,t.y,t.w,t.h;let o=e.pm.x,r=e.pm.y,i=e.pm.w,l=e.pm.h,c=mCurrentX,n=mCurrentY,s=window.borderwidth;if(c<o-s||o+i+s<c||n<r-s||r+l+s<n)return;let a,d,g,h=!1;o-s<=c&&c<=o+s&&(g=!0),o+i-s<=c&&c<=o+i+s&&(h=!0),r-s<=n&&n<=r+s&&(a=!0),r+l-s<=n&&n<=r+l+s&&(d=!0);let u=\"default\";a&&g||d&&h?u=\"nwse-resize\":a&&h||d&&g?u=\"nesw-resize\":a||d?u=\"ns-resize\":(g||h)&&(u=\"ew-resize\"),window.canv.style.cursor!=u&&(window.canv.style.cursor=u)}function RenderQuickPick(e,t){if(!(window.quick_pick&&-1!=window.lqpc.indexOf(e._class))||!window.MatchLayer(e))return;let o=t.x,r=t.y,i=t.w,l=t.h,c=o+i/2,n=r+l/2,s=Math.sin(new Date().getTime()/100);ctx.globalAlpha=.75-s/4;let a=27+5*s,d=!1;window.es[window.quick_pick_fake_over]==e?d=!0:window.Dist2D(c,n,window.mouse_x,window.mouse_y)<20*window.quick_pick_hit_scale&&(d=!0),draw_image(d?window.img_quickpick2:window.img_quickpick,c-a,n-a,2*a,2*a)}function RenderConnectionLines(e,t){if(!window.SHOW_CONNECTIONS||!e.selected||!aleiRunning)return;let o=window.MatchLayer(e)?1:.3,r=window.ObjectConnectionMapping,i=window.uidToElementMap,l=e.pm.uid;if(void 0==l||0==r.length||void 0==r[l]||0==r[l].by.length&&0==r[l].to.length)return;let c=r[l].by,n=r[l].to,s,a,d,g;for(let h of(s=t.x+t.w/2,d=t.y+t.h/2,ctx.globalAlpha=o*currentTheme.objectConnectionOpacityFactor,ctx.lineWidth=1,ctx.strokeStyle=currentTheme.objectConnectionToColor,ctx.setLineDash(currentTheme.objectConnectionDash),n)){let u=GetObjectCoordAndSize(i[h]);a=u.x+u.w/2,g=u.y+u.h/2,ctx.beginPath(),ctx.moveTo(s,d),ctx.lineTo(a,g),ctx.stroke()}for(let w of(ctx.strokeStyle=currentTheme.objectConnectionFromColor,a=s,g=d,c)){let x=GetObjectCoordAndSize(i[w]);s=x.x+x.w/2,d=x.y+x.h/2,ctx.beginPath(),ctx.moveTo(s,d),ctx.lineTo(a,g),ctx.stroke()}ctx.setLineDash([])}function RenderSingleObject(e,t){e._isresizable?RenderSingleResizableObject(e,t):RenderSingleNonResizableObject(e,t),RenderSelectOverlay(e,t),RenderQuickPick(e,t),RenderObjectMarkAndName(e,t),RenderConnectionLines(e,t),ChangeCursorIfHitsBorder(e,t)}function RenderAllObjects(){totalRenderedObjects=0;let e=window.left_panel.getBoundingClientRect(),t=window.right_panel.getBoundingClientRect(),o=window.top_panel.getBoundingClientRect(),r=Math.round(s2w_x(e.width+e.x)),i=Math.round(s2w_y(o.height+o.y)),l=Math.round(s2w_w(t.x-(e.width+e.x))),c=Math.round(s2w_h(canvasHeight-(o.height+o.y)));for(let n of window.es){let s=n.pm,a=s.x,d=s.y,g=s.w?s.w:0,h=s.h?s.h:0;if(!n.exists||!n._isphysical)continue;let u;n.selected&&(u=GetObjectCoordAndSize(n),RenderConnectionLines(n,u)),!(a+g<r)&&!(d+h<i)&&!(r+l<a)&&!(i+c<d)&&(void 0==u&&(u=GetObjectCoordAndSize(n)),RenderSingleObject(n,u),totalRenderedObjects++)}}function RenderSelectionBox(){if(!window.m_drag_selection||window.lmd)return;let e=w2s_x(mClickX),t=w2s_y(mClickY),o=w2s_w(mCurrentX-mClickX),r=w2s_h(mCurrentY-mClickY),i=currentTheme.selectionColor;window.ctrl?i=currentTheme.selectionCtrlColor:window.alt&&(i=currentTheme.selectionAltColor),_DrawRectangle(i,currentTheme.selectionOpacity,e,t,o,r),_DrawRectangle(i,currentTheme.selectionEdgeOpacity,e,t,o,r,!0)}function RenderBackground(){window.SHOW_TEXTURES?draw_image(window.CACHED_SKY[previewBackground],0,0,canvasWidth,canvasHeight):(ctx.fillStyle=currentTheme.backgroundColor,draw_rect(0,0,canvasWidth,canvasHeight))}function SnapToGrid(e){return Math.round(e/window.GRID_SNAPPING)*window.GRID_SNAPPING}function RenderCrossCursor(){\"edit\"!=window.active_tool&&(ctx.globalAlpha=1,draw_image(window.img_put,w2s_x(SnapToGrid(mCurrentX))-15,w2s_y(SnapToGrid(mCurrentY))-15,31,31))}function RenderFrame(){window.need_redraw&&(canvasWidth=window.lsu,canvasHeight=window.lsv,currentTheme=themes[window.THEME],gridOpacity=window.GRID_ALPHA,mClickX=window.lmdrwa,mClickY=window.lmdrwb,mCurrentX=window.lmwa,mCurrentY=window.lmwb,window.canv.style.cursor=\"default\",ctx.globalAlpha=1,RenderBackground(),RenderGrid(),RenderAllObjects(),RenderSelectionBox(),RenderCrossCursor())}function DisplayStatistics(){let e=document.getElementById(\"gui_renderInfo\");void 0==e&&((e=document.createElement(\"div\")).id=\"gui_renderInfo\",e.innerHTML=\"Waiting for data...\",window.right_panel.childNodes[0].insertBefore(e,document.getElementById(\"gui_params\")));let t=\" \";t+=`Renderer FPS: ${displayFPS} <br>`,t+=`Rendered Object: ${totalRenderedObjects} / ${window.es.length}`,e.innerHTML=t.slice(1).replaceAll(\"\\n\",\"<br>\")}function getTimeMs(){return new Date().getTime()}function RequestRedrawIfGridMoved(){let e=window.k_shift?5:1,t=!1;if(0!==window.speed_x){let o=10*window.zoom*e*window.speed_x;window.dis_from_x+=o,window.dis_to_x+=o,t=!0}if(0!==window.speed_y){let r=10*window.zoom*e*window.speed_y;window.dis_from_y+=r,window.dis_to_y+=r,t=!0}t&&(window.zoom_validate(),window.need_redraw=!0,window.lmd=!1,window.lmwa=s2w_x(window.mouse_x),window.lmwb=s2w_x(window.mouse_y))}function HandleSingleFrame(){window.requestAnimationFrame(HandleSingleFrame),RequestRedrawIfGridMoved(),RenderFrame(),window.need_GUIParams_update&&(window.need_GUIParams_update=!1,window.UpdateGUIParams(),window.UpdateGUIObjectsList()),fpsAccumulator++,getTimeMs()-lastTime>=1e3&&(lastTime=getTimeMs(),displayFPS=fpsAccumulator,fpsAccumulator=0),DisplayStatistics(),aleiRunning&&!haveForcedRecalculation&&void 0!=document.getElementById(\"rparams\")&&(window.ShowHideObjectBox(),window.ShowHideObjectBox(),haveForcedRecalculation=!0)}function PreviewModeUpdateVariables(e){if(e)for(let t of window.es){if(\"inf\"!=t._class)continue;let o=t.pm;if(\"sky\"==o.mark){previewBackground=o.forteam;return}}}function RegisterSettingsToALEI(){if(!window.ALEI_Active)return;aleiRunning=!0;let e=window.ALEIAPI.settings;e.addText(\"[R] Cartoonish Edges:\",!1),e.createButtons(\"ALEI_Renderer_CartoonishEdges\",toggles,\"cartoonishEdges\",[[\"Yes\",!0],[\"No\",!1]]),e.addText(\"[R] Original Select:\",!1),e.createButtons(\"ALEI_Renderer_OriginalSelectOverlay\",toggles,\"originalSelectOverlay\",[[\"Yes\",!0],[\"No\",!1]]),e.addText(\"[R] Preview walls:\",!1),e.createButtons(\"ALEI_Renderer_PreviewWalls\",toggles,\"boxRendering\",[[\"Yes\",!0],[\"No\",!1]]),window.ALEI_settingUpdateButtons()}!function(){ctx=window.ctx,draw_rect_edges=(e,t,o,r)=>ctx.strokeRect(e,t,o,r),draw_rect=window.lmfr,draw_gridlines=window.lg,draw_image=(e,t,o,r,i)=>window.MyDrawImage(e,t,o,r,i),w2s_x=window.w2s_x,w2s_y=window.w2s_y,s2w_x=window.s2w_x,s2w_y=window.s2w_y,w2s_h=window.w2s_h,w2s_w=window.w2s_w,s2w_h=window.s2w_h,s2w_w=window.s2w_w;let e=window.ShowTexturesSet;window.ShowTexturesSet=t=>{PreviewModeUpdateVariables(t),e(t)},window.Render=()=>{},window.ani=()=>{},window.requestAnimationFrame(HandleSingleFrame),lastTime=getTimeMs(),RegisterSettingsToALEI(),aleiRunning||window.NewNote(\"ALEI Renderer: You are not running with ALEI. Don't expect feature completeness as renderer depends on ALEI giving some informations.\",\"#FFFF00\"),console.log(\"[ALEI Renderer]: Active.\")}();\r\n        return;\r\n    };\r\n    if(!aleiSettings.blackTheme) return;\r\n    // We should only patch for black theme, because setting render makes things lag for no apparent reason.\r\n\r\n    let fn = ALE_Render.toString();\r\n    fn = fn.replaceAll(\"for ( property\", \"for ( let property\");\r\n\r\n    // Noname & Xeden's black theme\r\n    let GridColor = \"#222222\";\r\n    let GridLineColor = \"#FFFFFF50\";\r\n\r\n    fn = fn.replace(\"if ( THEME === THEME_BLUE )\", `if (THEME === 4) ctx.fillStyle = '${GridColor}';\\n else if (THEME === THEME_BLUE)`);\r\n    fn = fn.replace(\"if ( THEME !== THEME_DARK )\", `if (THEME === 4) ctx.fillStyle = '${GridLineColor}';\\n else if (THEME !== THEME_DARK)`);\r\n\r\n    window.Render = eval(`(${fn})`);\r\n}\r\n\r\nfunction patchDeleteSelection() {\r\n    let og = window.DeleteSelection;\r\n    window.DeleteSelection = () => {\r\n        for(let selected of SelectedObjects) OCM_onObjectDelete(selected);\r\n        og();\r\n    };\r\n}\r\n\r\nlet ALE_start = (async function() {\r\n    'use strict';\r\n\r\n    window.ALEIAPI = {};\r\n\r\n    VAL_TABLE = special_values_table;\r\n    ROOT_ELEMENT = document.documentElement;\r\n    stylesheets = document.styleSheets;\r\n    ALE_Render = Render;\r\n    window.ObjectConnectionMapping = {};\r\n    window.uidToElementMap = {};\r\n\r\n    // Updates the current CSS stylesheet.\r\n    updateCSSFile();\r\n\r\n    // Handling rest of things\r\n    addPropertyPanelResize();\r\n    addObjBoxResize();\r\n\r\n    _loadcss_js__WEBPACK_IMPORTED_MODULE_0__.fixWebpackStyleSheets();\r\n    _loadcss_js__WEBPACK_IMPORTED_MODULE_0__.patchThemeSet();\r\n\r\n    updateStyles();\r\n    updateSkins();\r\n    updateSounds();\r\n    updateVoicePresets();\r\n    updateParameters();\r\n    updateOffsets();\r\n    updateObjects();\r\n    updateButtons();\r\n    patch_m_down();\r\n    addSessionSync();\r\n    addTriggerIDs();\r\n    patchShowHideButton();\r\n    optimize();\r\n    patchUpdateTools();\r\n    patchDecorUpload();\r\n    patchEntityClass();\r\n    patchNewNote();\r\n    patchEvalSet();\r\n    // Allowing for spaces in parameters.\r\n    window.UpdatePhysicalParam = UpdatePhysicalParam;\r\n    window.PasteFromClipBoard = PasteFromClipBoard;\r\n    patchANI();\r\n    // Tooltip.\r\n    if(aleiSettings.enableTooltips) {\r\n        doTooltip();\r\n    }\r\n    patchServerRequest();\r\n    if (aleiSettings.extendedTriggers) {\r\n        extendTriggerList();\r\n        ExtendedTriggersLoaded = true;\r\n    }\r\n    patchUpdateGUIParams();\r\n    patchTeamList();\r\n    if(aleiSettings.orderedNaming) patchRandomizeName();\r\n    patchAllowedCharacters();\r\n    if (aleiSettings.blackTheme) {\r\n        blackTheme();\r\n    }\r\n    addProjectileModels();\r\n    patchSpecialValue();\r\n    UpdateTools();\r\n    patchPercentageTool();\r\n    patchCompileTrigger();\r\n    createClipboardDiv();\r\n    addPasteFromPermanentClipboard();\r\n\r\n    if (!aleiSettings.extendedTriggers) {\r\n        registerClipboardItemAction();\r\n        patchClipboardFunctions();\r\n    }\r\n\r\n    patchDrawGrid();\r\n    addFunctionToWindow();\r\n    createALEISettingsMenu();\r\n    patchDeleteSelection();\r\n\r\n    if(isNative) {\r\n        checkForUpdates();\r\n    } else {\r\n        // load this map twice to parse extended triggers.\r\n        if(mapid !== \"\" && aleiSettings.extendedTriggers) LoadThisMap();\r\n    }\r\n    changeTopRightText();\r\n\r\n    aleiLog(DEBUG2, \"Settings: \" + JSON.stringify(aleiSettings));\r\n    ALEI_UpdateNameRenderSetting(aleiSettings.renderObjectNames);\r\n\r\n    let ALE_PreviewQualitySet = window.PreviewQualitySet;\r\n    window.PreviewQualitySet = (val) => {\r\n        ALE_PreviewQualitySet(val);\r\n        writeStorage(\"ALEI_PreviewQualitySet\", val);\r\n    };\r\n\r\n    window.PreviewQualitySet(\r\n        readStorage(\r\n            \"ALEI_PreviewQualitySet\",\r\n            false,\r\n            (val) => val === \"true\")\r\n    );\r\n\r\n    patchRender();\r\n\r\n    NewNote(\"ALEI: Welcome!\", \"#7777FF\");\r\n    NewNote(`Don't forget to join discord server! discord.gg/K5jcNEvZ85`, \"#7777FF\");\r\n    aleiLog(INFO, `Welcome!`);\r\n    if(isNative) {\r\n        aleiLog(INFO, `TamperMonkey Version: ${GM_info.version} ALEI Version: ${GM_info.script.version}`);\r\n    } else {\r\n        let message = \"You are running ALEI not under tampermonkey, this is not native ALEI, please load ALEI by tampermonkey when possible.\";\r\n        NewNote(`ALEI: ${message}`, \"#FFFF00\");\r\n        NewNote(`ALEI: Check https://github.com/LisABC/ALEI for more details.`, \"#FFFF00\");\r\n        aleiLog(INFO, message);\r\n    }\r\n});\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => ALE_start());\n\n//# sourceURL=webpack://alei/./src/main.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/main.js");
/******/ 	
/******/ })()
;